{
  "version": 3,
  "sources": ["../src/utils.ts", "../src/storage.ts", "../src/game.ts", "../src/editor.ts", "../src/app.ts"],
  "sourcesContent": ["export function escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n\nexport function sanitizeImageUrl(url: string): string {\n  try {\n    const parsed = new URL(url);\n    if (parsed.protocol === 'http:' || parsed.protocol === 'https:') return url;\n  } catch { /* ignore */ }\n  return '';\n}\n\nexport function showModal(message: string, onConfirm?: () => void): void {\n  document.getElementById('modal-overlay')?.remove();\n\n  const overlay = document.createElement('div');\n  overlay.id = 'modal-overlay';\n  overlay.className =\n    'fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50';\n\n  const box = document.createElement('div');\n  box.className =\n    'bg-gray-800 border border-gray-700 rounded-2xl p-6 max-w-sm w-full mx-4 shadow-2xl';\n\n  const msg = document.createElement('p');\n  msg.className = 'text-white text-center mb-6 text-base leading-relaxed';\n  msg.textContent = message;\n  box.appendChild(msg);\n\n  const btns = document.createElement('div');\n  btns.className = 'flex gap-3 justify-center';\n\n  if (onConfirm) {\n    const cancel = document.createElement('button');\n    cancel.className =\n      'flex-1 py-2.5 rounded-xl bg-gray-600 hover:bg-gray-500 text-white font-semibold transition';\n    cancel.textContent = '\u041E\u0442\u043C\u0435\u043D\u0430';\n    cancel.onclick = () => overlay.remove();\n    btns.appendChild(cancel);\n\n    const confirm = document.createElement('button');\n    confirm.className =\n      'flex-1 py-2.5 rounded-xl bg-red-600 hover:bg-red-500 text-white font-semibold transition';\n    confirm.textContent = '\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044C';\n    confirm.onclick = () => { overlay.remove(); onConfirm(); };\n    btns.appendChild(confirm);\n  } else {\n    const ok = document.createElement('button');\n    ok.className =\n      'px-10 py-2.5 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white font-semibold transition';\n    ok.textContent = 'OK';\n    ok.onclick = () => overlay.remove();\n    btns.appendChild(ok);\n  }\n\n  box.appendChild(btns);\n  overlay.appendChild(box);\n  overlay.addEventListener('click', e => { if (e.target === overlay) overlay.remove(); });\n  document.body.appendChild(overlay);\n}\n\nexport function formatTime(timestamp: number): string {\n  const mins = Math.floor((Date.now() - timestamp) / 60000);\n  if (mins < 1)  return '\u0442\u043E\u043B\u044C\u043A\u043E \u0447\u0442\u043E';\n  if (mins < 60) return `${mins} \u043C\u0438\u043D. \u043D\u0430\u0437\u0430\u0434`;\n  const hours = Math.floor(mins / 60);\n  if (hours < 24) return `${hours} \u0447. \u043D\u0430\u0437\u0430\u0434`;\n  return `${Math.floor(hours / 24)} \u0434. \u043D\u0430\u0437\u0430\u0434`;\n}\n\nexport function downloadJson(data: unknown, filename: string): void {\n  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  a.click();\n  URL.revokeObjectURL(url);\n}\n", "import type { QuestionPack, CharacterSet, GameState, SaveSlot } from './types';\n\nconst PACKS_KEY     = 'clu_packs';\nconst CHAR_SETS_KEY = 'clu_character_sets';\nconst SAVES_KEY     = 'clu_saves';\n\n// \u2500\u2500 Question Packs \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport function loadPacks(): QuestionPack[] {\n  try { return JSON.parse(localStorage.getItem(PACKS_KEY) ?? '[]'); }\n  catch { return []; }\n}\n\nexport function savePacks(packs: QuestionPack[]): void {\n  localStorage.setItem(PACKS_KEY, JSON.stringify(packs));\n}\n\n// \u2500\u2500 Character Sets \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport function loadCharacterSets(): CharacterSet[] {\n  try { return JSON.parse(localStorage.getItem(CHAR_SETS_KEY) ?? '[]'); }\n  catch { return []; }\n}\n\nexport function saveCharacterSets(sets: CharacterSet[]): void {\n  localStorage.setItem(CHAR_SETS_KEY, JSON.stringify(sets));\n}\n\n// \u2500\u2500 Save Slots \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport function loadSaves(): SaveSlot[] {\n  try { return JSON.parse(localStorage.getItem(SAVES_KEY) ?? '[]'); }\n  catch { return []; }\n}\n\nexport function upsertSave(state: GameState): void {\n  const saves   = loadSaves();\n  const idx     = saves.findIndex(s => s.id === state.id);\n  const charName = state.unlockedUpTo >= 0\n    ? (state.characterSet.characters[state.unlockedUpTo]?.name ?? '')\n    : '';\n\n  const slot: SaveSlot = {\n    id:               state.id,\n    playerName:       state.playerName,\n    packTitle:        state.pack.title,\n    charName,\n    questionProgress: `${state.currentIndex + 1} / ${state.shuffledQuestions.length}`,\n    totalStars:       state.totalStars,\n    savedAt:          Date.now(),\n    state,\n  };\n\n  if (idx >= 0) saves[idx] = slot;\n  else saves.unshift(slot);\n\n  localStorage.setItem(SAVES_KEY, JSON.stringify(saves));\n}\n\nexport function deleteSave(id: string): void {\n  const filtered = loadSaves().filter(s => s.id !== id);\n  localStorage.setItem(SAVES_KEY, JSON.stringify(filtered));\n}\n\n// \u2500\u2500 Builtin Data \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport async function loadBuiltinPacks(): Promise<QuestionPack[]> {\n  try {\n    const res = await fetch('packs/index.json');\n    const files: string[] = await res.json();\n    return Promise.all(files.map(f => fetch(`packs/${f}`).then(r => r.json())));\n  } catch { return []; }\n}\n\nexport async function loadBuiltinCharacterSets(): Promise<CharacterSet[]> {\n  try {\n    const res = await fetch('characters/index.json');\n    const files: string[] = await res.json();\n    return Promise.all(files.map(f => fetch(`characters/${f}`).then(r => r.json())));\n  } catch { return []; }\n}\n", "import type { GameState, QuestionPack, CharacterSet, Character, Screen } from './types';\nimport { escapeHtml, sanitizeImageUrl, showModal } from './utils';\nimport {\n  loadPacks, loadCharacterSets,\n  loadBuiltinPacks, loadBuiltinCharacterSets,\n  upsertSave, deleteSave, loadSaves,\n} from './storage';\n\n// \u2500\u2500 State \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nlet game: GameState | null = null;\nlet timerInterval: number | null = null;\nlet timerRemaining = 0;\nlet _nav: (s: Screen) => void = () => { /* no-op until app sets it */ };\n\nlet builtinPacks: QuestionPack[] = [];\nlet builtinSets: CharacterSet[] = [];\n\n// \u2500\u2500 Init \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport function setNav(fn: (s: Screen) => void): void {\n  _nav = fn;\n}\n\nexport async function preload(): Promise<void> {\n  [builtinPacks, builtinSets] = await Promise.all([\n    loadBuiltinPacks(),\n    loadBuiltinCharacterSets(),\n  ]);\n}\n\nexport function hasActiveSave(): boolean {\n  return loadSaves().length > 0;\n}\n\nfunction allPacks(): QuestionPack[] {\n  return [...builtinPacks, ...loadPacks()];\n}\n\nfunction allSets(): CharacterSet[] {\n  return [...builtinSets, ...loadCharacterSets()];\n}\n\n// \u2500\u2500 Setup Screen \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport function renderSetup(el: HTMLElement): void {\n  const packs = allPacks();\n  const sets = allSets();\n  const canStart = packs.length > 0 && sets.length > 0;\n\n  el.innerHTML = `\n    <div class=\"min-h-screen flex flex-col items-center justify-center p-6 bg-gray-950\">\n      <h1 class=\"text-3xl font-bold mb-8\">\u041D\u043E\u0432\u0430\u044F \u0438\u0433\u0440\u0430</h1>\n\n      <div class=\"w-full max-w-md space-y-5\">\n\n        <div>\n          <label class=\"block text-xs text-gray-400 uppercase tracking-wider mb-1.5\">\u0418\u043C\u044F \u0438\u0433\u0440\u043E\u043A\u0430</label>\n          <input id=\"inp-name\" type=\"text\" maxlength=\"40\" placeholder=\"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043C\u044F...\"\n            class=\"w-full bg-gray-800 text-white rounded-xl px-4 py-3 border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n        </div>\n\n        <div>\n          <label class=\"block text-xs text-gray-400 uppercase tracking-wider mb-1.5\">\u041F\u0430\u043A\u0435\u0442 \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432</label>\n          ${packs.length > 0\n            ? `<select id=\"sel-pack\" class=\"w-full bg-gray-800 text-white rounded-xl px-4 py-3 border border-gray-700 focus:outline-none focus:border-indigo-500\">\n                ${packs.map((p, i) =>\n                  `<option value=\"${i}\">${escapeHtml(p.title)} (${p.questions.length} \u0432\u043E\u043F\u0440. \u00B7 ${p.starsPerCorrect}\u2605)</option>`\n                ).join('')}\n               </select>`\n            : `<div class=\"bg-gray-800 text-red-400 rounded-xl px-4 py-3 text-sm\">\u041D\u0435\u0442 \u043F\u0430\u043A\u0435\u0442\u043E\u0432. \u0421\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u0432 \u00AB\u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440\u0435 \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432\u00BB.</div>`}\n        </div>\n\n        <div>\n          <label class=\"block text-xs text-gray-400 uppercase tracking-wider mb-1.5\">\u041D\u0430\u0431\u043E\u0440 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0435\u0439</label>\n          ${sets.length > 0\n            ? `<select id=\"sel-chars\" class=\"w-full bg-gray-800 text-white rounded-xl px-4 py-3 border border-gray-700 focus:outline-none focus:border-indigo-500\">\n                ${sets.map((s, i) =>\n                  `<option value=\"${i}\">${escapeHtml(s.title)} (${s.characters.length} \u043F\u0435\u0440\u0441.)</option>`\n                ).join('')}\n               </select>`\n            : `<div class=\"bg-gray-800 text-red-400 rounded-xl px-4 py-3 text-sm\">\u041D\u0435\u0442 \u043D\u0430\u0431\u043E\u0440\u043E\u0432. \u0421\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u0432 \u00AB\u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440\u0435 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0435\u0439\u00BB.</div>`}\n          <div id=\"compat-warning\"></div>\n        </div>\n\n        <div>\n          <label class=\"block text-xs text-gray-400 uppercase tracking-wider mb-1.5\">\u0422\u0430\u0439\u043C\u0435\u0440 \u043D\u0430 \u0432\u043E\u043F\u0440\u043E\u0441 (\u0441\u0435\u043A, 0 = \u0431\u0435\u0437 \u0442\u0430\u0439\u043C\u0435\u0440\u0430)</label>\n          <input id=\"inp-timer\" type=\"number\" min=\"0\" max=\"300\" value=\"0\"\n            class=\"w-full bg-gray-800 text-white rounded-xl px-4 py-3 border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n        </div>\n\n        <button id=\"btn-start\"\n          class=\"w-full py-4 rounded-xl font-bold text-lg transition\n            ${canStart\n              ? 'bg-indigo-600 hover:bg-indigo-500 text-white'\n              : 'bg-gray-700 text-gray-500 cursor-not-allowed'}\"\n          ${canStart ? '' : 'disabled'}>\n          \u041D\u0430\u0447\u0430\u0442\u044C \u0438\u0433\u0440\u0443\n        </button>\n\n        <button id=\"btn-back\"\n          class=\"w-full py-3 bg-gray-800 hover:bg-gray-700 text-white rounded-xl font-semibold transition\">\n          \u041D\u0430\u0437\u0430\u0434\n        </button>\n\n      </div>\n    </div>\n  `;\n\n  if (canStart) {\n    const selPack  = el.querySelector('#sel-pack')  as HTMLSelectElement;\n    const selChars = el.querySelector('#sel-chars') as HTMLSelectElement;\n\n    const updateCompat = () => {\n      const p       = packs[parseInt(selPack.value)];\n      const s       = sets[parseInt(selChars.value)];\n      const warning = el.querySelector('#compat-warning')!;\n      if (!p || !s) { warning.innerHTML = ''; return; }\n\n      const maxStars   = p.questions.length * p.starsPerCorrect;\n      const sorted     = [...s.characters].sort((a, b) => a.cost - b.cost);\n      const maxNeeded  = sorted[sorted.length - 1]?.cost ?? 0;\n      const unlockable = sorted.filter(c => c.cost <= maxStars).length;\n\n      if (unlockable === 0) {\n        warning.innerHTML = `<div class=\"mt-2 px-3 py-2 bg-red-950 border border-red-800 rounded-xl text-red-300 text-xs\">\n          \u26D4 \u041D\u0435\u043B\u044C\u0437\u044F \u043E\u0442\u043A\u0440\u044B\u0442\u044C \u043D\u0438 \u043E\u0434\u043D\u043E\u0433\u043E \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0430 \u2014 \u043C\u0430\u043A\u0441. ${maxStars}\u2605, \u0430 \u0441\u0430\u043C\u044B\u0439 \u0434\u0435\u0448\u0451\u0432\u044B\u0439 \u0441\u0442\u043E\u0438\u0442 ${sorted[0]?.cost ?? 0}\u2605\n        </div>`;\n      } else if (maxStars < maxNeeded) {\n        warning.innerHTML = `<div class=\"mt-2 px-3 py-2 bg-yellow-950 border border-yellow-800 rounded-xl text-yellow-300 text-xs\">\n          \u26A0 \u041C\u043E\u0436\u043D\u043E \u043E\u0442\u043A\u0440\u044B\u0442\u044C ${unlockable} \u0438\u0437 ${sorted.length} \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0435\u0439 (\u043C\u0430\u043A\u0441. ${maxStars}\u2605, \u043D\u0443\u0436\u043D\u043E ${maxNeeded}\u2605)\n        </div>`;\n      } else {\n        warning.innerHTML = `<div class=\"mt-2 px-3 py-2 bg-green-950 border border-green-800 rounded-xl text-green-400 text-xs\">\n          \u2713 \u0412\u0441\u0435 ${sorted.length} \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0430 \u043E\u0442\u043A\u0440\u044B\u0432\u0430\u0435\u043C\u044B (\u043C\u0430\u043A\u0441. ${maxStars}\u2605 \u043F\u0440\u0438 \u043D\u0443\u0436\u043D\u044B\u0445 ${maxNeeded}\u2605)\n        </div>`;\n      }\n    };\n\n    selPack.addEventListener('change', updateCompat);\n    selChars.addEventListener('change', updateCompat);\n    updateCompat();\n\n    el.querySelector('#btn-start')?.addEventListener('click', () => {\n      const playerName = ((el.querySelector('#inp-name') as HTMLInputElement).value).trim();\n      const packIdx    = parseInt(selPack.value);\n      const setIdx     = parseInt(selChars.value);\n      const timer      = Math.max(0, parseInt((el.querySelector('#inp-timer') as HTMLInputElement).value) || 0);\n      startGame(packs[packIdx]!, sets[setIdx]!, timer, playerName);\n    });\n  }\n\n  el.querySelector('#btn-back')?.addEventListener('click', () => _nav('home'));\n}\n\n// \u2500\u2500 Game Init \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction shuffle<T>(arr: T[]): T[] {\n  const a = [...arr];\n  for (let i = a.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [a[i], a[j]] = [a[j]!, a[i]!];\n  }\n  return a;\n}\n\nfunction startGame(pack: QuestionPack, characterSet: CharacterSet, timerSeconds: number, playerName: string): void {\n  const sortedChars = [...characterSet.characters].sort((a, b) => a.cost - b.cost);\n  game = {\n    id: Date.now().toString(36) + Math.random().toString(36).slice(2, 6),\n    playerName,\n    pack,\n    characterSet: { ...characterSet, characters: sortedChars },\n    shuffledQuestions: shuffle(pack.questions),\n    currentIndex: 0,\n    totalStars: 0,\n    timerSeconds,\n    unlockedUpTo: -1,\n  };\n  upsertSave(game);\n  _nav('game');\n  renderGameScreen();\n}\n\nexport function resumeGame(id: string): void {\n  const slot = loadSaves().find(s => s.id === id);\n  if (!slot) return;\n  game = slot.state;\n  _nav('game');\n  renderGameScreen();\n}\n\n// \u2500\u2500 Game Screen \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction renderGameScreen(): void {\n  if (!game) return;\n\n  stopTimer();\n\n  const el    = document.getElementById('screen-game')!;\n  const chars = game.characterSet.characters;\n  const cur   = game.unlockedUpTo >= 0 ? (chars[game.unlockedUpTo] ?? null) : null;\n  const next  = chars[game.unlockedUpTo + 1] ?? null;\n  const q     = game.shuffledQuestions[game.currentIndex]!;\n\n  const prevCost = cur?.cost ?? 0;\n  const nextCost = next?.cost ?? prevCost;\n  const progressPct = next\n    ? Math.min(100, Math.max(0, ((game.totalStars - prevCost) / (nextCost - prevCost)) * 100))\n    : 100;\n  const starsToNext = next ? Math.max(0, next.cost - game.totalStars) : 0;\n\n  const img = (url?: string, cls = '') => {\n    const safe = url ? sanitizeImageUrl(url) : '';\n    return safe ? `<img src=\"${safe}\" alt=\"\" class=\"${cls}\" />` : null;\n  };\n\n  el.innerHTML = `\n    <div class=\"h-screen flex flex-col bg-gray-950\">\n\n      <!-- Main -->\n      <div class=\"flex flex-1 min-h-0\">\n\n        <!-- Center: question -->\n        <div class=\"flex-1 flex flex-col items-center justify-center gap-5 p-8 overflow-y-auto\">\n\n          ${game.timerSeconds > 0\n            ? `<div id=\"timer-display\" class=\"text-6xl font-black text-white leading-none\">${game.timerSeconds}</div>`\n            : ''}\n\n          ${img(q.imageUrl, 'max-h-[55vh] max-w-full w-full object-contain rounded-2xl') ?? ''}\n\n          <div class=\"text-2xl font-semibold text-center max-w-2xl leading-relaxed\">\n            ${escapeHtml(q.text)}\n          </div>\n\n          <button id=\"btn-show-answer\"\n            class=\"py-3 px-10 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold text-lg transition\">\n            \u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u043E\u0442\u0432\u0435\u0442\n          </button>\n\n          <div id=\"answer-block\" class=\"hidden w-full max-w-xl flex flex-col gap-4\">\n            <div class=\"bg-gray-800 border border-gray-700 rounded-xl p-4 text-center\">\n              <div class=\"text-xs text-gray-400 uppercase tracking-wider mb-1\">\u041E\u0442\u0432\u0435\u0442</div>\n              <div class=\"text-xl font-bold text-green-400\">${escapeHtml(q.answer)}</div>\n            </div>\n            <div class=\"flex gap-3\">\n              <button id=\"btn-wrong\"\n                class=\"flex-1 py-4 bg-red-700 hover:bg-red-600 text-white rounded-2xl font-bold text-lg transition shadow-lg shadow-red-950/50 flex flex-col items-center gap-0.5\">\n                <span class=\"text-2xl\">\u2715</span>\n                <span>\u041D\u0435\u0432\u0435\u0440\u043D\u043E</span>\n              </button>\n              <button id=\"btn-correct\"\n                class=\"flex-1 py-4 bg-green-700 hover:bg-green-600 text-white rounded-2xl font-bold text-lg transition shadow-lg shadow-green-950/50 flex flex-col items-center gap-0.5\">\n                <span class=\"text-2xl\">\u2713</span>\n                <span>\u041F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u043E +${game.pack.starsPerCorrect}\u2605</span>\n              </button>\n            </div>\n          </div>\n\n        </div>\n\n        <!-- Right panel: character progression -->\n        <div class=\"w-[27%] flex-shrink-0 bg-gray-900 border-l border-gray-800 flex flex-col\">\n\n          <!-- Stars -->\n          <div class=\"px-4 py-3 border-b border-gray-800 text-center flex-shrink-0\">\n            <div class=\"text-xs text-gray-500 uppercase tracking-widest mb-1\">\u0417\u0432\u0451\u0437\u0434\u044B</div>\n            <div class=\"text-yellow-400 font-black text-4xl\">\u2605 ${game.totalStars}</div>\n          </div>\n\n          <!-- Current character -->\n          <div class=\"flex-1 flex flex-col items-center px-4 pt-3 pb-2 min-h-0\">\n            <div class=\"text-xs text-gray-500 uppercase tracking-widest mb-2 flex-shrink-0\">\u0422\u0435\u043A\u0443\u0449\u0438\u0439</div>\n            <div class=\"flex-1 w-full min-h-0 flex items-center justify-center\">\n              ${cur\n                ? (() => { const s = cur.imageUrl ? sanitizeImageUrl(cur.imageUrl) : '';\n                    return s\n                      ? `<img src=\"${s}\" alt=\"\" class=\"max-h-full max-w-full object-contain rounded-3xl\" />`\n                      : `<div class=\"w-full h-full bg-gray-700 rounded-3xl flex items-center justify-center text-7xl\">\u265F</div>`; })()\n                : `<div class=\"w-full h-full bg-gray-800 rounded-3xl flex items-center justify-center text-6xl opacity-40\">\uD83D\uDD12</div>`}\n            </div>\n            ${cur\n              ? `<div class=\"font-black text-xl text-center mt-2 flex-shrink-0\">${escapeHtml(cur.name)}</div>\n                 <div class=\"text-yellow-400 text-sm mt-0.5 flex-shrink-0\">\u2605 ${cur.cost}</div>`\n              : `<div class=\"text-gray-600 text-sm mt-2 flex-shrink-0\">\u0415\u0449\u0451 \u043D\u0435 \u043E\u0442\u043A\u0440\u044B\u0442\u043E</div>`}\n          </div>\n\n          <!-- Progress bar -->\n          <div class=\"px-4 py-2 flex-shrink-0\">\n            ${next\n              ? `<div class=\"text-xs text-gray-500 text-center mb-1.5\">\u0414\u043E ${escapeHtml(next.name)}: ${starsToNext}\u2605</div>\n                 <div class=\"w-full bg-gray-700 rounded-full h-3 overflow-hidden\">\n                   <div class=\"bg-yellow-400 h-3 rounded-full transition-all duration-500\" style=\"width:${progressPct}%\"></div>\n                 </div>`\n              : `<div class=\"text-center text-yellow-400 font-bold text-sm\">\u2726 \u041C\u0430\u043A\u0441\u0438\u043C\u0443\u043C \u0434\u043E\u0441\u0442\u0438\u0433\u043D\u0443\u0442! \u2726</div>`}\n          </div>\n\n          <!-- Next character -->\n          <div class=\"flex-1 flex flex-col items-center px-4 pt-2 pb-3 border-t border-gray-800 min-h-0\">\n            <div class=\"text-xs text-gray-500 uppercase tracking-widest mb-2 flex-shrink-0\">\u0421\u043B\u0435\u0434\u0443\u044E\u0449\u0438\u0439</div>\n            <div class=\"flex-1 w-full min-h-0 flex items-center justify-center\">\n              ${next\n                ? (() => { const s = next.imageUrl ? sanitizeImageUrl(next.imageUrl) : '';\n                    return s\n                      ? `<img src=\"${s}\" alt=\"\" class=\"max-h-full max-w-full object-contain rounded-3xl opacity-35 grayscale\" />`\n                      : `<div class=\"w-full h-full bg-gray-800 rounded-3xl flex items-center justify-center text-7xl opacity-35\">\uD83D\uDD12</div>`; })()\n                : `<div class=\"w-full h-full bg-gray-800 rounded-3xl flex items-center justify-center text-8xl\">\uD83C\uDFC6</div>`}\n            </div>\n            ${next\n              ? `<div class=\"font-bold text-lg text-center mt-2 text-gray-400 flex-shrink-0\">${escapeHtml(next.name)}</div>\n                 <div class=\"text-yellow-400 text-sm mt-0.5 opacity-50 flex-shrink-0\">\u2605 ${next.cost}</div>`\n              : `<div class=\"font-bold text-lg text-center mt-2 text-gray-500 flex-shrink-0\">\u0424\u0438\u043D\u0430\u043B!</div>`}\n          </div>\n\n          <!-- Bottom controls -->\n          <div class=\"px-4 pb-4 flex-shrink-0 border-t border-gray-800 pt-3 space-y-2\">\n            <button id=\"btn-all-chars\"\n              class=\"w-full h-11 bg-gray-800 hover:bg-gray-700 text-white rounded-xl font-semibold transition border border-gray-700 hover:border-gray-500 flex items-center justify-center gap-2\">\n              <span class=\"text-lg\">\uD83C\uDFC5</span> \u0412\u0441\u0435 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0438\n            </button>\n\n            <div class=\"flex gap-2\">\n              <!-- Question progress -->\n              <div class=\"relative flex-1 h-11 rounded-xl overflow-hidden bg-gray-800 border border-gray-700\">\n                <div class=\"absolute inset-0 bg-gradient-to-r from-indigo-600 to-violet-600 transition-all duration-500\"\n                  style=\"width:${Math.round(((game.currentIndex + 1) / game.shuffledQuestions.length) * 100)}%\"></div>\n                <span class=\"absolute inset-0 flex items-center justify-center text-sm font-semibold text-white drop-shadow\">\n                  ${game.currentIndex + 1} / ${game.shuffledQuestions.length}\n                </span>\n              </div>\n\n              <!-- Exit -->\n              <button id=\"btn-exit\"\n                class=\"h-11 px-4 bg-gray-800 hover:bg-red-950 text-gray-300 hover:text-red-300 rounded-xl font-semibold text-sm transition border border-gray-700 hover:border-red-800 flex-shrink-0\">\n                \u0412\u044B\u0445\u043E\u0434\n              </button>\n            </div>\n          </div>\n\n        </div>\n\n      </div>\n    </div>\n  `;\n\n  // Events\n  el.querySelector('#btn-show-answer')?.addEventListener('click', () => {\n    el.querySelector('#btn-show-answer')?.classList.add('hidden');\n    el.querySelector('#answer-block')?.classList.remove('hidden');\n    stopTimer();\n  });\n\n  el.querySelector('#btn-correct')?.addEventListener('click', () => handleAnswer(true));\n  el.querySelector('#btn-wrong')?.addEventListener('click', () => handleAnswer(false));\n\n  el.querySelector('#btn-all-chars')?.addEventListener('click', () => showAllCharactersOverlay());\n\n  el.querySelector('#btn-exit')?.addEventListener('click', () => {\n    showModal('\u0412\u044B\u0439\u0442\u0438 \u0438\u0437 \u0438\u0433\u0440\u044B? \u041F\u0440\u043E\u0433\u0440\u0435\u0441\u0441 \u0441\u043E\u0445\u0440\u0430\u043D\u0451\u043D.', () => {\n      stopTimer();\n      _nav('home');\n    });\n  });\n\n  if (game.timerSeconds > 0) startTimer(game.timerSeconds);\n}\n\n// \u2500\u2500 All Characters Overlay \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction showAllCharactersOverlay(): void {\n  if (!game) return;\n\n  document.getElementById('all-chars-overlay')?.remove();\n\n  // Pause timer while overlay is open; resume on close if it was ticking\n  const wasTimerRunning = timerInterval !== null;\n  const savedRemaining  = timerRemaining;\n  stopTimer();\n\n  const chars   = game.characterSet.characters;\n  const maxCost = chars[chars.length - 1]?.cost ?? 0;\n\n  const overlay = document.createElement('div');\n  overlay.id = 'all-chars-overlay';\n  overlay.className =\n    'fixed inset-0 bg-black/75 backdrop-blur-sm flex items-center justify-center z-50 p-4';\n\n  const imgTag = (url: string | undefined, unlocked: boolean) => {\n    const safe = url ? sanitizeImageUrl(url) : '';\n    const cls  = `w-24 h-24 object-contain rounded-xl mb-2 ${unlocked ? '' : 'grayscale opacity-30'}`;\n    const fallbackCls = `w-24 h-24 rounded-xl mb-2 flex items-center justify-center text-4xl\n      ${unlocked ? 'bg-gray-700' : 'bg-gray-800 opacity-30'}`;\n    return safe\n      ? `<img src=\"${safe}\" alt=\"\" class=\"${cls}\" />`\n      : `<div class=\"${fallbackCls}\">${unlocked ? '\u265F' : '\uD83D\uDD12'}</div>`;\n  };\n\n  overlay.innerHTML = `\n    <div class=\"bg-gray-900 border border-gray-800 rounded-2xl w-full max-w-4xl shadow-2xl flex flex-col max-h-[85vh]\">\n\n      <!-- Header -->\n      <div class=\"flex items-center justify-between px-5 py-4 border-b border-gray-800\">\n        <div>\n          <div class=\"font-bold text-lg\">\u0412\u0441\u0435 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0438</div>\n          <div class=\"text-xs text-gray-400 mt-0.5\">\n            \u041D\u0430\u0431\u0440\u0430\u043D\u043E: <span class=\"text-yellow-400 font-bold\">\u2605 ${game.totalStars}</span>\n            &nbsp;\u00B7&nbsp;\n            \u0414\u043B\u044F \u0432\u0441\u0435\u0445: <span class=\"text-gray-300 font-semibold\">\u2605 ${maxCost}</span>\n          </div>\n        </div>\n        <button id=\"btn-close-overlay\"\n          class=\"text-gray-400 hover:text-white text-2xl leading-none transition w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-800\">\n          \u00D7\n        </button>\n      </div>\n\n      <!-- Overall progress bar -->\n      <div class=\"px-5 py-3 border-b border-gray-800\">\n        <div class=\"flex justify-between text-xs text-gray-500 mb-1.5\">\n          <span>\u041E\u0431\u0449\u0438\u0439 \u043F\u0440\u043E\u0433\u0440\u0435\u0441\u0441</span>\n          <span>${Math.round(Math.min(100, (game.totalStars / (maxCost || 1)) * 100))}%</span>\n        </div>\n        <div class=\"w-full bg-gray-700 rounded-full h-2.5 overflow-hidden\">\n          <div class=\"bg-yellow-400 h-2.5 rounded-full transition-all\"\n            style=\"width:${Math.min(100, (game.totalStars / (maxCost || 1)) * 100)}%\"></div>\n        </div>\n      </div>\n\n      <!-- Characters grid -->\n      <div class=\"grid grid-cols-4 gap-4 p-5 overflow-y-auto flex-1\">\n        ${chars.map((c, i) => {\n          const unlocked = i <= game!.unlockedUpTo;\n          return `\n            <div class=\"flex flex-col items-center rounded-xl p-3\n              ${unlocked\n                ? 'bg-gray-800 border border-gray-700'\n                : 'bg-gray-900 border border-gray-800'}\">\n              ${imgTag(c.imageUrl, unlocked)}\n              <div class=\"text-xs font-semibold text-center leading-tight\n                ${unlocked ? 'text-white' : 'text-gray-600'}\">\n                ${escapeHtml(c.name)}\n              </div>\n              <div class=\"text-xs mt-1 ${unlocked ? 'text-yellow-400' : 'text-gray-700'}\">\n                ${unlocked ? '\u2713' : '\uD83D\uDD12'} \u2605 ${c.cost}\n              </div>\n            </div>\n          `;\n        }).join('')}\n      </div>\n\n    </div>\n  `;\n\n  document.body.appendChild(overlay);\n\n  const closeOverlay = () => {\n    overlay.remove();\n    if (wasTimerRunning && savedRemaining > 0) startTimer(savedRemaining);\n  };\n  overlay.querySelector('#btn-close-overlay')?.addEventListener('click', closeOverlay);\n  overlay.addEventListener('click', e => { if (e.target === overlay) closeOverlay(); });\n}\n\n// \u2500\u2500 Timer \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction startTimer(seconds: number): void {\n  stopTimer();\n  timerRemaining = seconds;\n  updateTimerDisplay();\n  timerInterval = window.setInterval(() => {\n    timerRemaining--;\n    updateTimerDisplay();\n    if (timerRemaining <= 0) {\n      stopTimer();\n      document.getElementById('btn-show-answer')?.classList.add('hidden');\n      document.getElementById('answer-block')?.classList.remove('hidden');\n    }\n  }, 1000);\n}\n\nfunction stopTimer(): void {\n  if (timerInterval !== null) {\n    clearInterval(timerInterval);\n    timerInterval = null;\n  }\n}\n\nfunction updateTimerDisplay(): void {\n  const el = document.getElementById('timer-display');\n  if (!el) return;\n  el.textContent = String(timerRemaining);\n  if      (timerRemaining <= 5)  el.className = 'text-6xl font-black text-red-500 leading-none';\n  else if (timerRemaining <= 10) el.className = 'text-6xl font-black text-yellow-400 leading-none';\n  else                           el.className = 'text-6xl font-black text-white leading-none';\n}\n\n// \u2500\u2500 Answer Handling \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction handleAnswer(correct: boolean): void {\n  if (!game) return;\n  stopTimer();\n\n  if (correct) {\n    game.totalStars += game.pack.starsPerCorrect;\n\n    const chars = game.characterSet.characters;\n    let justUnlocked: Character | null = null;\n    while (\n      game.unlockedUpTo + 1 < chars.length &&\n      game.totalStars >= chars[game.unlockedUpTo + 1]!.cost\n    ) {\n      game.unlockedUpTo++;\n      justUnlocked = chars[game.unlockedUpTo]!;\n    }\n\n    upsertSave(game);\n\n    if (justUnlocked) {\n      showUnlockOverlay(justUnlocked, () => advanceQuestion());\n      return;\n    }\n  }\n\n  upsertSave(game);\n  advanceQuestion();\n}\n\nfunction showUnlockOverlay(char: Character, onContinue: () => void): void {\n  const overlay = document.createElement('div');\n  overlay.className =\n    'fixed inset-0 bg-black/85 backdrop-blur-md flex items-center justify-center z-50';\n\n  const safeUrl = char.imageUrl ? sanitizeImageUrl(char.imageUrl) : '';\n\n  overlay.innerHTML = `\n    <div class=\"text-center px-6\">\n      <div class=\"text-6xl mb-4\">\uD83C\uDF89</div>\n      <div class=\"text-yellow-400 text-3xl font-black mb-4\">\u041D\u043E\u0432\u044B\u0439 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436!</div>\n      ${safeUrl\n        ? `<img src=\"${safeUrl}\" alt=\"${escapeHtml(char.name)}\"\n             class=\"w-36 h-36 object-contain mx-auto mb-4 rounded-2xl\" />`\n        : `<div class=\"w-36 h-36 bg-gray-700 rounded-2xl mx-auto mb-4 flex items-center justify-center text-6xl\">\u2B50</div>`}\n      <div class=\"text-3xl font-bold text-white mb-1\">${escapeHtml(char.name)}</div>\n      <div class=\"text-gray-400 text-sm mb-8\">\u041E\u0442\u043A\u0440\u044B\u0442 \u0437\u0430 ${char.cost} \u0437\u0432\u0451\u0437\u0434</div>\n      <button id=\"btn-unlock-ok\"\n        class=\"py-3 px-12 bg-yellow-500 hover:bg-yellow-400 text-black font-bold rounded-2xl text-lg transition\">\n        \u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C\n      </button>\n    </div>\n  `;\n\n  document.body.appendChild(overlay);\n  overlay.querySelector('#btn-unlock-ok')?.addEventListener('click', () => {\n    overlay.remove();\n    onContinue();\n  });\n}\n\nfunction advanceQuestion(): void {\n  if (!game) return;\n  game.currentIndex++;\n\n  if (game.currentIndex >= game.shuffledQuestions.length) {\n    deleteSave(game.id);\n    renderResults();\n    _nav('results');\n    return;\n  }\n\n  upsertSave(game);\n  renderGameScreen();\n}\n\n// \u2500\u2500 Results Screen \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction renderResults(): void {\n  if (!game) return;\n\n  const el        = document.getElementById('screen-results')!;\n  const chars     = game.characterSet.characters;\n  const unlocked  = game.unlockedUpTo >= 0 ? chars.slice(0, game.unlockedUpTo + 1) : [];\n  const finalChar = game.unlockedUpTo >= 0 ? (chars[game.unlockedUpTo] ?? null) : null;\n\n  const imgTag = (url: string | undefined, cls: string) => {\n    const safe = url ? sanitizeImageUrl(url) : '';\n    return safe\n      ? `<img src=\"${safe}\" alt=\"\" class=\"${cls}\" />`\n      : `<div class=\"${cls} bg-gray-700 flex items-center justify-center text-4xl\">\u2B50</div>`;\n  };\n\n  el.innerHTML = `\n    <div class=\"min-h-screen flex flex-col items-center justify-center p-6 bg-gray-950\">\n      <div class=\"text-6xl mb-3\">\uD83C\uDFC6</div>\n      <h1 class=\"text-3xl font-black text-yellow-400 mb-1\">\u0418\u0433\u0440\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0430!</h1>\n      <div class=\"text-gray-400 mb-8 text-sm\">\n        ${game.shuffledQuestions.length} \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432 \u00B7 ${game.totalStars} \u0437\u0432\u0451\u0437\u0434 \u043D\u0430\u0431\u0440\u0430\u043D\u043E\n      </div>\n\n      <div class=\"bg-gray-900 border border-gray-800 rounded-2xl p-6 text-center w-full max-w-xs mb-6\">\n        <div class=\"text-xs text-gray-400 uppercase tracking-wider mb-3\">\u0424\u0438\u043D\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436</div>\n        ${finalChar\n          ? `${imgTag(finalChar.imageUrl, 'w-32 h-32 object-contain mx-auto mb-3 rounded-xl')}\n             <div class=\"text-2xl font-bold\">${escapeHtml(finalChar.name)}</div>`\n          : `<div class=\"w-32 h-32 bg-gray-800 rounded-xl mx-auto mb-3 flex items-center justify-center text-5xl\">\uD83D\uDE14</div>\n             <div class=\"text-xl font-bold text-gray-500\">\u041D\u0438 \u043E\u0434\u043D\u043E\u0433\u043E \u043D\u0435 \u043E\u0442\u043A\u0440\u044B\u0442\u043E</div>`}\n        <div class=\"text-yellow-400 mt-1 text-sm\">\u2605 ${game.totalStars}</div>\n      </div>\n\n      ${unlocked.length > 1 ? `\n        <div class=\"w-full max-w-md mb-8\">\n          <div class=\"text-xs text-gray-500 uppercase tracking-wider text-center mb-3\">\n            \u041E\u0442\u043A\u0440\u044B\u0442\u043E: ${unlocked.length} / ${chars.length}\n          </div>\n          <div class=\"flex flex-wrap gap-2 justify-center\">\n            ${unlocked.map(c => `\n              <div class=\"flex flex-col items-center bg-gray-900 border border-gray-800 rounded-xl p-2 w-20\">\n                ${imgTag(c.imageUrl, 'w-12 h-12 object-contain rounded-lg')}\n                <div class=\"text-xs text-center text-gray-300 mt-1 leading-tight\">${escapeHtml(c.name)}</div>\n              </div>\n            `).join('')}\n          </div>\n        </div>\n      ` : ''}\n\n      <button id=\"btn-home\"\n        class=\"py-3 px-10 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold text-lg transition\">\n        \u041D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E\n      </button>\n    </div>\n  `;\n\n  el.querySelector('#btn-home')?.addEventListener('click', () => {\n    game = null;\n    _nav('home');\n  });\n}\n", "import type { QuestionPack, Question, CharacterSet, Character, Screen } from './types';\nimport { escapeHtml, sanitizeImageUrl, showModal, downloadJson } from './utils';\nimport { loadPacks, savePacks, loadCharacterSets, saveCharacterSets } from './storage';\n\nlet _nav: (s: Screen) => void = () => { /* no-op */ };\n\nexport function setNav(fn: (s: Screen) => void): void {\n  _nav = fn;\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// PACK EDITOR\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\ninterface PackState {\n  packs: QuestionPack[];\n  view: 'list' | 'edit';\n  editIdx: number;       // -1 = new\n  pack: QuestionPack;\n  expandedQ: number;     // -1 = none\n}\n\nlet ps: PackState = newPackState();\n\nfunction newPackState(): PackState {\n  return {\n    packs: [],\n    view: 'list',\n    editIdx: -1,\n    pack: { title: '', questions: [], starsPerCorrect: 3 },\n    expandedQ: -1,\n  };\n}\n\nexport function renderPackEditor(el: HTMLElement): void {\n  ps = newPackState();\n  ps.packs = loadPacks();\n  drawPack(el);\n}\n\nfunction drawPack(el: HTMLElement): void {\n  if (ps.view === 'list') drawPackList(el);\n  else drawPackEdit(el);\n}\n\n// \u2500\u2500 Pack List \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction drawPackList(el: HTMLElement): void {\n  el.innerHTML = `\n    <div class=\"min-h-screen flex flex-col bg-gray-950\">\n\n      <div class=\"flex items-center gap-3 px-5 py-4 bg-gray-900 border-b border-gray-800\">\n        <button id=\"pe-back\" class=\"text-gray-400 hover:text-white transition text-sm\">\u2190 \u041D\u0430\u0437\u0430\u0434</button>\n        <h1 class=\"text-xl font-bold flex-1\">\u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432</h1>\n        <label class=\"cursor-pointer text-sm text-indigo-400 hover:text-indigo-300 transition\">\n          \u0418\u043C\u043F\u043E\u0440\u0442\n          <input id=\"pe-import\" type=\"file\" accept=\".json\" class=\"hidden\" />\n        </label>\n        <button id=\"pe-new\" class=\"py-2 px-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl text-sm font-semibold transition\">\n          + \u041D\u043E\u0432\u044B\u0439 \u043F\u0430\u043A\u0435\u0442\n        </button>\n      </div>\n\n      <div class=\"flex-1 p-4 max-w-2xl mx-auto w-full\">\n        ${ps.packs.length === 0\n          ? `<div class=\"text-gray-500 text-center mt-20 text-sm\">\u041D\u0435\u0442 \u043F\u0430\u043A\u0435\u0442\u043E\u0432. \u0421\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u043F\u0435\u0440\u0432\u044B\u0439!</div>`\n          : ps.packs.map((p, i) => `\n            <div class=\"bg-gray-900 border border-gray-800 rounded-xl px-4 py-3 flex items-center gap-3 mb-2\">\n              <div class=\"flex-1 min-w-0\">\n                <div class=\"font-semibold truncate\">${escapeHtml(p.title)}</div>\n                <div class=\"text-xs text-gray-400\">${p.questions.length} \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432 \u00B7 ${p.starsPerCorrect}\u2605 \u0437\u0430 \u043E\u0442\u0432\u0435\u0442</div>\n              </div>\n              <button data-edit=\"${i}\" class=\"text-sm text-indigo-400 hover:text-indigo-300 transition\">\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C</button>\n              <button data-export=\"${i}\" class=\"text-sm text-gray-400 hover:text-gray-300 transition\">\u042D\u043A\u0441\u043F\u043E\u0440\u0442</button>\n              <button data-del=\"${i}\" class=\"text-sm text-red-400 hover:text-red-300 transition\">\u0423\u0434\u0430\u043B\u0438\u0442\u044C</button>\n            </div>\n          `).join('')}\n      </div>\n\n    </div>\n  `;\n\n  el.querySelector('#pe-back')?.addEventListener('click', () => _nav('home'));\n\n  el.querySelector('#pe-new')?.addEventListener('click', () => {\n    ps.editIdx = -1;\n    ps.pack = { title: '', questions: [], starsPerCorrect: 3 };\n    ps.view = 'edit';\n    ps.expandedQ = -1;\n    drawPack(el);\n  });\n\n  el.querySelector('#pe-import')?.addEventListener('change', e => {\n    const file = (e.target as HTMLInputElement).files?.[0];\n    if (!file) return;\n    const reader = new FileReader();\n    reader.onload = ev => {\n      try {\n        const data = JSON.parse(ev.target?.result as string);\n        if (!data.title || !Array.isArray(data.questions)) throw new Error();\n        ps.packs.push(data as QuestionPack);\n        savePacks(ps.packs);\n        drawPackList(el);\n      } catch {\n        showModal('\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0444\u043E\u0440\u043C\u0430\u0442 \u0444\u0430\u0439\u043B\u0430');\n      }\n    };\n    reader.readAsText(file);\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-edit]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const i = parseInt(btn.dataset['edit']!);\n      ps.editIdx = i;\n      ps.pack = JSON.parse(JSON.stringify(ps.packs[i]));\n      ps.view = 'edit';\n      ps.expandedQ = -1;\n      drawPack(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-export]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const i = parseInt(btn.dataset['export']!);\n      downloadJson(ps.packs[i]!, `${ps.packs[i]!.title || 'pack'}.json`);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-del]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const i = parseInt(btn.dataset['del']!);\n      showModal(`\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0430\u043A\u0435\u0442 \u00AB${ps.packs[i]!.title}\u00BB?`, () => {\n        ps.packs.splice(i, 1);\n        savePacks(ps.packs);\n        drawPackList(el);\n      });\n    });\n  });\n}\n\n// \u2500\u2500 Pack Edit \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction drawPackEdit(el: HTMLElement): void {\n  const p = ps.pack;\n  el.innerHTML = `\n    <div class=\"min-h-screen flex flex-col bg-gray-950\">\n\n      <div class=\"flex items-center gap-3 px-5 py-4 bg-gray-900 border-b border-gray-800\">\n        <button id=\"pe-edit-back\" class=\"text-gray-400 hover:text-white transition text-sm\">\u2190 \u041D\u0430\u0437\u0430\u0434</button>\n        <h1 class=\"text-xl font-bold flex-1\">${ps.editIdx === -1 ? '\u041D\u043E\u0432\u044B\u0439 \u043F\u0430\u043A\u0435\u0442' : '\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043F\u0430\u043A\u0435\u0442'}</h1>\n        <button id=\"pe-save\" class=\"py-2 px-4 bg-green-700 hover:bg-green-600 text-white rounded-xl text-sm font-semibold transition\">\n          \u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C\n        </button>\n      </div>\n\n      <div class=\"flex-1 p-4 max-w-2xl mx-auto w-full space-y-4\">\n\n        <div class=\"bg-gray-900 border border-gray-800 rounded-xl p-4 space-y-3\">\n          <div>\n            <label class=\"text-xs text-gray-400 uppercase tracking-wider\">\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0430\u043A\u0435\u0442\u0430</label>\n            <input id=\"pe-title\" type=\"text\" value=\"${escapeHtml(p.title)}\" placeholder=\"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435...\"\n              class=\"w-full bg-gray-800 text-white rounded-xl px-4 py-2 mt-1 border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n          </div>\n          <div>\n            <label class=\"text-xs text-gray-400 uppercase tracking-wider\">\u0417\u0432\u0451\u0437\u0434 \u0437\u0430 \u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u044B\u0439 \u043E\u0442\u0432\u0435\u0442</label>\n            <input id=\"pe-stars\" type=\"number\" min=\"1\" max=\"100\" value=\"${p.starsPerCorrect}\"\n              class=\"w-full bg-gray-800 text-white rounded-xl px-4 py-2 mt-1 border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n          </div>\n        </div>\n\n        <div class=\"flex items-center justify-between\">\n          <div class=\"text-sm text-gray-400 uppercase tracking-wider font-semibold\">\u0412\u043E\u043F\u0440\u043E\u0441\u044B (${p.questions.length})</div>\n          <button id=\"pe-add-q\" class=\"py-1.5 px-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-sm font-semibold transition\">\n            + \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C\n          </button>\n        </div>\n\n        <div id=\"pe-qlist\">${renderQList(p.questions)}</div>\n\n        ${ps.editIdx !== -1 ? `\n          <button id=\"pe-del-pack\"\n            class=\"w-full py-3 rounded-xl font-semibold transition text-red-400 hover:text-red-300 border border-red-900 hover:bg-red-900/20\">\n            \u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0430\u043A\u0435\u0442\n          </button>\n        ` : ''}\n\n      </div>\n    </div>\n  `;\n\n  const titleEl = el.querySelector('#pe-title') as HTMLInputElement;\n  const starsEl = el.querySelector('#pe-stars') as HTMLInputElement;\n  titleEl.addEventListener('input', () => { ps.pack.title = titleEl.value; });\n  starsEl.addEventListener('input', () => { ps.pack.starsPerCorrect = Math.max(1, parseInt(starsEl.value) || 1); });\n\n  el.querySelector('#pe-edit-back')?.addEventListener('click', () => {\n    ps.view = 'list';\n    ps.packs = loadPacks();\n    drawPack(el);\n  });\n\n  el.querySelector('#pe-save')?.addEventListener('click', () => {\n    if (!ps.pack.title.trim()) { showModal('\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0430\u043A\u0435\u0442\u0430'); return; }\n    if (ps.editIdx === -1) ps.packs.push(ps.pack);\n    else ps.packs[ps.editIdx] = ps.pack;\n    savePacks(ps.packs);\n    ps.view = 'list';\n    drawPack(el);\n  });\n\n  el.querySelector('#pe-del-pack')?.addEventListener('click', () => {\n    showModal(`\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0430\u043A\u0435\u0442 \u00AB${ps.pack.title}\u00BB?`, () => {\n      ps.packs.splice(ps.editIdx, 1);\n      savePacks(ps.packs);\n      ps.view = 'list';\n      drawPack(el);\n    });\n  });\n\n  el.querySelector('#pe-add-q')?.addEventListener('click', () => {\n    ps.pack.questions.push({ text: '', answer: '', imageUrl: '' });\n    ps.expandedQ = ps.pack.questions.length - 1;\n    refreshQList(el);\n    setTimeout(() => {\n      el.querySelector(`[data-qrow=\"${ps.expandedQ}\"]`)?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n    }, 50);\n  });\n\n  bindQEvents(el);\n}\n\nfunction renderQList(questions: Question[]): string {\n  if (questions.length === 0)\n    return `<div class=\"text-gray-500 text-center py-8 text-sm\">\u041D\u0435\u0442 \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432. \u041D\u0430\u0436\u043C\u0438\u0442\u0435 \u00AB+ \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C\u00BB.</div>`;\n\n  return questions.map((q, i) => {\n    const open = ps.expandedQ === i;\n    return `\n      <div data-qrow=\"${i}\" class=\"bg-gray-900 border border-gray-800 rounded-xl mb-2 overflow-hidden\">\n        <div class=\"flex items-center gap-3 px-4 py-3 cursor-pointer select-none\" data-qtoggle=\"${i}\">\n          <div class=\"flex-1 min-w-0\">\n            <div class=\"text-sm font-medium truncate ${q.text ? 'text-white' : 'text-gray-500 italic'}\">\n              ${q.text ? escapeHtml(q.text) : '\u0411\u0435\u0437 \u0442\u0435\u043A\u0441\u0442\u0430'}\n            </div>\n            <div class=\"text-xs text-gray-400 truncate\">${q.answer ? escapeHtml(q.answer) : '\u0411\u0435\u0437 \u043E\u0442\u0432\u0435\u0442\u0430'}</div>\n          </div>\n          <button data-qdel=\"${i}\" class=\"text-red-400 hover:text-red-300 text-sm transition px-2 flex-shrink-0\">\u2715</button>\n          <span class=\"text-gray-600 text-sm flex-shrink-0\">${open ? '\u25B2' : '\u25BC'}</span>\n        </div>\n        ${open ? `\n          <div class=\"px-4 pb-4 pt-3 space-y-2 border-t border-gray-800\">\n            <div>\n              <label class=\"text-xs text-gray-400\">\u0412\u043E\u043F\u0440\u043E\u0441</label>\n              <textarea data-qtext=\"${i}\" rows=\"2\" placeholder=\"\u0422\u0435\u043A\u0441\u0442 \u0432\u043E\u043F\u0440\u043E\u0441\u0430...\"\n                class=\"w-full bg-gray-800 text-white rounded-lg px-3 py-2 mt-1 text-sm border border-gray-700 focus:outline-none focus:border-indigo-500 resize-none\">${escapeHtml(q.text)}</textarea>\n            </div>\n            <div>\n              <label class=\"text-xs text-gray-400\">\u041E\u0442\u0432\u0435\u0442</label>\n              <input data-qans=\"${i}\" type=\"text\" value=\"${escapeHtml(q.answer)}\" placeholder=\"\u041F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u044B\u0439 \u043E\u0442\u0432\u0435\u0442...\"\n                class=\"w-full bg-gray-800 text-white rounded-lg px-3 py-2 mt-1 text-sm border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n            </div>\n            <div>\n              <label class=\"text-xs text-gray-400\">\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 (URL, \u043D\u0435\u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E)</label>\n              <input data-qimg=\"${i}\" type=\"text\" value=\"${escapeHtml(q.imageUrl ?? '')}\" placeholder=\"https://...\"\n                class=\"w-full bg-gray-800 text-white rounded-lg px-3 py-2 mt-1 text-sm border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n            </div>\n          </div>\n        ` : ''}\n      </div>\n    `;\n  }).join('');\n}\n\nfunction refreshQList(el: HTMLElement): void {\n  const list = el.querySelector('#pe-qlist');\n  if (list) list.innerHTML = renderQList(ps.pack.questions);\n  bindQEvents(el);\n}\n\nfunction bindQEvents(el: HTMLElement): void {\n  el.querySelectorAll<HTMLElement>('[data-qtoggle]').forEach(row => {\n    row.addEventListener('click', e => {\n      if ((e.target as HTMLElement).hasAttribute('data-qdel')) return;\n      const i = parseInt(row.dataset['qtoggle']!);\n      ps.expandedQ = ps.expandedQ === i ? -1 : i;\n      refreshQList(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-qdel]').forEach(btn => {\n    btn.addEventListener('click', e => {\n      e.stopPropagation();\n      const i = parseInt(btn.dataset['qdel']!);\n      ps.pack.questions.splice(i, 1);\n      if (ps.expandedQ === i) ps.expandedQ = -1;\n      else if (ps.expandedQ > i) ps.expandedQ--;\n      refreshQList(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLTextAreaElement>('[data-qtext]').forEach(ta => {\n    ta.addEventListener('input', () => {\n      ps.pack.questions[parseInt(ta.dataset['qtext']!)]!.text = ta.value;\n    });\n  });\n\n  el.querySelectorAll<HTMLInputElement>('[data-qans]').forEach(inp => {\n    inp.addEventListener('input', () => {\n      ps.pack.questions[parseInt(inp.dataset['qans']!)]!.answer = inp.value;\n    });\n  });\n\n  el.querySelectorAll<HTMLInputElement>('[data-qimg]').forEach(inp => {\n    inp.addEventListener('input', () => {\n      ps.pack.questions[parseInt(inp.dataset['qimg']!)]!.imageUrl = inp.value;\n    });\n  });\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// CHARACTER EDITOR\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\ninterface CharState {\n  sets: CharacterSet[];\n  view: 'list' | 'edit';\n  editIdx: number;\n  set: CharacterSet;\n  expandedC: number;\n}\n\nlet cs: CharState = newCharState();\n\nfunction newCharState(): CharState {\n  return {\n    sets: [],\n    view: 'list',\n    editIdx: -1,\n    set: { title: '', characters: [] },\n    expandedC: -1,\n  };\n}\n\nexport function renderCharacterEditor(el: HTMLElement): void {\n  cs = newCharState();\n  cs.sets = loadCharacterSets();\n  drawChar(el);\n}\n\nfunction drawChar(el: HTMLElement): void {\n  if (cs.view === 'list') drawCharList(el);\n  else drawCharEdit(el);\n}\n\n// \u2500\u2500 Character Set List \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction drawCharList(el: HTMLElement): void {\n  el.innerHTML = `\n    <div class=\"min-h-screen flex flex-col bg-gray-950\">\n\n      <div class=\"flex items-center gap-3 px-5 py-4 bg-gray-900 border-b border-gray-800\">\n        <button id=\"ce-back\" class=\"text-gray-400 hover:text-white transition text-sm\">\u2190 \u041D\u0430\u0437\u0430\u0434</button>\n        <h1 class=\"text-xl font-bold flex-1\">\u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0435\u0439</h1>\n        <label class=\"cursor-pointer text-sm text-indigo-400 hover:text-indigo-300 transition\">\n          \u0418\u043C\u043F\u043E\u0440\u0442\n          <input id=\"ce-import\" type=\"file\" accept=\".json\" class=\"hidden\" />\n        </label>\n        <button id=\"ce-new\" class=\"py-2 px-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl text-sm font-semibold transition\">\n          + \u041D\u043E\u0432\u044B\u0439 \u043D\u0430\u0431\u043E\u0440\n        </button>\n      </div>\n\n      <div class=\"flex-1 p-4 max-w-2xl mx-auto w-full\">\n        ${cs.sets.length === 0\n          ? `<div class=\"text-gray-500 text-center mt-20 text-sm\">\u041D\u0435\u0442 \u043D\u0430\u0431\u043E\u0440\u043E\u0432. \u0421\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u043F\u0435\u0440\u0432\u044B\u0439!</div>`\n          : cs.sets.map((s, i) => `\n            <div class=\"bg-gray-900 border border-gray-800 rounded-xl px-4 py-3 flex items-center gap-3 mb-2\">\n              <div class=\"flex-1 min-w-0\">\n                <div class=\"font-semibold truncate\">${escapeHtml(s.title)}</div>\n                <div class=\"text-xs text-gray-400\">${s.characters.length} \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0435\u0439</div>\n              </div>\n              <button data-edit=\"${i}\" class=\"text-sm text-indigo-400 hover:text-indigo-300 transition\">\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C</button>\n              <button data-export=\"${i}\" class=\"text-sm text-gray-400 hover:text-gray-300 transition\">\u042D\u043A\u0441\u043F\u043E\u0440\u0442</button>\n              <button data-del=\"${i}\" class=\"text-sm text-red-400 hover:text-red-300 transition\">\u0423\u0434\u0430\u043B\u0438\u0442\u044C</button>\n            </div>\n          `).join('')}\n      </div>\n\n    </div>\n  `;\n\n  el.querySelector('#ce-back')?.addEventListener('click', () => _nav('home'));\n\n  el.querySelector('#ce-new')?.addEventListener('click', () => {\n    cs.editIdx = -1;\n    cs.set = { title: '', characters: [] };\n    cs.view = 'edit';\n    cs.expandedC = -1;\n    drawChar(el);\n  });\n\n  el.querySelector('#ce-import')?.addEventListener('change', e => {\n    const file = (e.target as HTMLInputElement).files?.[0];\n    if (!file) return;\n    const reader = new FileReader();\n    reader.onload = ev => {\n      try {\n        const data = JSON.parse(ev.target?.result as string);\n        if (!data.title || !Array.isArray(data.characters)) throw new Error();\n        cs.sets.push(data as CharacterSet);\n        saveCharacterSets(cs.sets);\n        drawCharList(el);\n      } catch {\n        showModal('\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0444\u043E\u0440\u043C\u0430\u0442 \u0444\u0430\u0439\u043B\u0430');\n      }\n    };\n    reader.readAsText(file);\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-edit]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const i = parseInt(btn.dataset['edit']!);\n      cs.editIdx = i;\n      cs.set = JSON.parse(JSON.stringify(cs.sets[i]));\n      cs.view = 'edit';\n      cs.expandedC = -1;\n      drawChar(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-export]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const i = parseInt(btn.dataset['export']!);\n      downloadJson(cs.sets[i]!, `${cs.sets[i]!.title || 'characters'}.json`);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-del]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const i = parseInt(btn.dataset['del']!);\n      showModal(`\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043D\u0430\u0431\u043E\u0440 \u00AB${cs.sets[i]!.title}\u00BB?`, () => {\n        cs.sets.splice(i, 1);\n        saveCharacterSets(cs.sets);\n        drawCharList(el);\n      });\n    });\n  });\n}\n\n// \u2500\u2500 Character Set Edit \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction drawCharEdit(el: HTMLElement): void {\n  const s = cs.set;\n  el.innerHTML = `\n    <div class=\"min-h-screen flex flex-col bg-gray-950\">\n\n      <div class=\"flex items-center gap-3 px-5 py-4 bg-gray-900 border-b border-gray-800\">\n        <button id=\"ce-edit-back\" class=\"text-gray-400 hover:text-white transition text-sm\">\u2190 \u041D\u0430\u0437\u0430\u0434</button>\n        <h1 class=\"text-xl font-bold flex-1\">${cs.editIdx === -1 ? '\u041D\u043E\u0432\u044B\u0439 \u043D\u0430\u0431\u043E\u0440' : '\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043D\u0430\u0431\u043E\u0440'}</h1>\n        <button id=\"ce-save\" class=\"py-2 px-4 bg-green-700 hover:bg-green-600 text-white rounded-xl text-sm font-semibold transition\">\n          \u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C\n        </button>\n      </div>\n\n      <div class=\"flex-1 p-4 max-w-2xl mx-auto w-full space-y-4\">\n\n        <div class=\"bg-gray-900 border border-gray-800 rounded-xl p-4\">\n          <label class=\"text-xs text-gray-400 uppercase tracking-wider\">\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043D\u0430\u0431\u043E\u0440\u0430</label>\n          <input id=\"ce-title\" type=\"text\" value=\"${escapeHtml(s.title)}\" placeholder=\"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435...\"\n            class=\"w-full bg-gray-800 text-white rounded-xl px-4 py-2 mt-1 border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n        </div>\n\n        <div class=\"text-xs text-gray-500 px-1\">\n          \uD83D\uDCA1 \u041F\u0435\u0440\u0432\u044B\u0439 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436 (\u0441\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C 0) \u043E\u0442\u043A\u0440\u044B\u0442 \u0441 \u0441\u0430\u043C\u043E\u0433\u043E \u043D\u0430\u0447\u0430\u043B\u0430.\n          \u041F\u0440\u0438 \u0441\u0442\u0430\u0440\u0442\u0435 \u0438\u0433\u0440\u044B \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0438 \u0441\u043E\u0440\u0442\u0438\u0440\u0443\u044E\u0442\u0441\u044F \u043F\u043E \u0441\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u0438 \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438.\n        </div>\n\n        <div class=\"flex items-center justify-between\">\n          <div class=\"text-sm text-gray-400 uppercase tracking-wider font-semibold\">\u041F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0438 (${s.characters.length})</div>\n          <button id=\"ce-add-c\" class=\"py-1.5 px-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-sm font-semibold transition\">\n            + \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C\n          </button>\n        </div>\n\n        <div id=\"ce-clist\">${renderCList(s.characters)}</div>\n\n        ${cs.editIdx !== -1 ? `\n          <button id=\"ce-del-set\"\n            class=\"w-full py-3 rounded-xl font-semibold transition text-red-400 hover:text-red-300 border border-red-900 hover:bg-red-900/20\">\n            \u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043D\u0430\u0431\u043E\u0440\n          </button>\n        ` : ''}\n\n      </div>\n    </div>\n  `;\n\n  const titleEl = el.querySelector('#ce-title') as HTMLInputElement;\n  titleEl.addEventListener('input', () => { cs.set.title = titleEl.value; });\n\n  el.querySelector('#ce-edit-back')?.addEventListener('click', () => {\n    cs.view = 'list';\n    cs.sets = loadCharacterSets();\n    drawChar(el);\n  });\n\n  el.querySelector('#ce-save')?.addEventListener('click', () => {\n    if (!cs.set.title.trim()) { showModal('\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043D\u0430\u0431\u043E\u0440\u0430'); return; }\n    if (cs.editIdx === -1) cs.sets.push(cs.set);\n    else cs.sets[cs.editIdx] = cs.set;\n    saveCharacterSets(cs.sets);\n    cs.view = 'list';\n    drawChar(el);\n  });\n\n  el.querySelector('#ce-del-set')?.addEventListener('click', () => {\n    showModal(`\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043D\u0430\u0431\u043E\u0440 \u00AB${cs.set.title}\u00BB?`, () => {\n      cs.sets.splice(cs.editIdx, 1);\n      saveCharacterSets(cs.sets);\n      cs.view = 'list';\n      drawChar(el);\n    });\n  });\n\n  el.querySelector('#ce-add-c')?.addEventListener('click', () => {\n    cs.set.characters.push({ name: '', cost: 0, imageUrl: '' });\n    cs.expandedC = cs.set.characters.length - 1;\n    refreshCList(el);\n    setTimeout(() => {\n      el.querySelector(`[data-crow=\"${cs.expandedC}\"]`)?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n    }, 50);\n  });\n\n  bindCEvents(el);\n}\n\nfunction renderCList(chars: Character[]): string {\n  if (chars.length === 0)\n    return `<div class=\"text-gray-500 text-center py-8 text-sm\">\u041D\u0435\u0442 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0435\u0439. \u041D\u0430\u0436\u043C\u0438\u0442\u0435 \u00AB+ \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C\u00BB.</div>`;\n\n  return chars.map((c, i) => {\n    const open    = cs.expandedC === i;\n    const safeImg = c.imageUrl ? sanitizeImageUrl(c.imageUrl) : '';\n    return `\n      <div data-crow=\"${i}\" class=\"bg-gray-900 border border-gray-800 rounded-xl mb-2 overflow-hidden\">\n        <div class=\"flex items-center gap-3 px-4 py-3 cursor-pointer select-none\" data-ctoggle=\"${i}\">\n          ${safeImg\n            ? `<img src=\"${safeImg}\" class=\"w-8 h-8 object-contain rounded flex-shrink-0\" />`\n            : `<div class=\"w-8 h-8 bg-gray-700 rounded flex-shrink-0 flex items-center justify-center text-sm\">\u265F</div>`}\n          <div class=\"flex-1 min-w-0\">\n            <div class=\"text-sm font-medium ${c.name ? 'text-white' : 'text-gray-500 italic'}\">\n              ${c.name ? escapeHtml(c.name) : '\u0411\u0435\u0437 \u0438\u043C\u0435\u043D\u0438'}\n            </div>\n            <div class=\"text-xs text-yellow-400\">\u2605 ${c.cost}</div>\n          </div>\n          <div class=\"flex gap-0.5 flex-shrink-0\">\n            <button data-cup=\"${i}\" class=\"text-gray-400 hover:text-white transition px-2 py-1 text-sm\" title=\"\u0412\u0432\u0435\u0440\u0445\">\u2191</button>\n            <button data-cdn=\"${i}\" class=\"text-gray-400 hover:text-white transition px-2 py-1 text-sm\" title=\"\u0412\u043D\u0438\u0437\">\u2193</button>\n            <button data-cdel=\"${i}\" class=\"text-red-400 hover:text-red-300 text-sm transition px-2 py-1\">\u2715</button>\n          </div>\n          <span class=\"text-gray-600 text-sm flex-shrink-0\">${open ? '\u25B2' : '\u25BC'}</span>\n        </div>\n        ${open ? `\n          <div class=\"px-4 pb-4 pt-3 space-y-2 border-t border-gray-800\">\n            <div>\n              <label class=\"text-xs text-gray-400\">\u0418\u043C\u044F \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0430</label>\n              <input data-cname=\"${i}\" type=\"text\" value=\"${escapeHtml(c.name)}\" placeholder=\"\u0418\u043C\u044F...\"\n                class=\"w-full bg-gray-800 text-white rounded-lg px-3 py-2 mt-1 text-sm border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n            </div>\n            <div>\n              <label class=\"text-xs text-gray-400\">\u0421\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C (\u2605 \u0434\u043B\u044F \u043E\u0442\u043A\u0440\u044B\u0442\u0438\u044F)</label>\n              <input data-ccost=\"${i}\" type=\"number\" min=\"0\" value=\"${c.cost}\"\n                class=\"w-full bg-gray-800 text-white rounded-lg px-3 py-2 mt-1 text-sm border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n            </div>\n            <div>\n              <label class=\"text-xs text-gray-400\">\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 (URL, \u043D\u0435\u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E)</label>\n              <input data-cimg=\"${i}\" type=\"text\" value=\"${escapeHtml(c.imageUrl ?? '')}\" placeholder=\"https://...\"\n                class=\"w-full bg-gray-800 text-white rounded-lg px-3 py-2 mt-1 text-sm border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n            </div>\n            ${safeImg ? `\n              <div>\n                <div class=\"text-xs text-gray-400 mb-1\">\u041F\u0440\u0435\u0434\u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440</div>\n                <img src=\"${safeImg}\" class=\"h-16 object-contain rounded\" onerror=\"this.style.display='none'\" />\n              </div>\n            ` : ''}\n          </div>\n        ` : ''}\n      </div>\n    `;\n  }).join('');\n}\n\nfunction refreshCList(el: HTMLElement): void {\n  const list = el.querySelector('#ce-clist');\n  if (list) list.innerHTML = renderCList(cs.set.characters);\n  bindCEvents(el);\n}\n\nfunction bindCEvents(el: HTMLElement): void {\n  el.querySelectorAll<HTMLElement>('[data-ctoggle]').forEach(row => {\n    row.addEventListener('click', e => {\n      const t = e.target as HTMLElement;\n      if (t.hasAttribute('data-cup') || t.hasAttribute('data-cdn') || t.hasAttribute('data-cdel')) return;\n      const i = parseInt(row.dataset['ctoggle']!);\n      cs.expandedC = cs.expandedC === i ? -1 : i;\n      refreshCList(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-cdel]').forEach(btn => {\n    btn.addEventListener('click', e => {\n      e.stopPropagation();\n      const i = parseInt(btn.dataset['cdel']!);\n      cs.set.characters.splice(i, 1);\n      if (cs.expandedC === i) cs.expandedC = -1;\n      else if (cs.expandedC > i) cs.expandedC--;\n      refreshCList(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-cup]').forEach(btn => {\n    btn.addEventListener('click', e => {\n      e.stopPropagation();\n      const i = parseInt(btn.dataset['cup']!);\n      if (i === 0) return;\n      [cs.set.characters[i - 1], cs.set.characters[i]] = [cs.set.characters[i]!, cs.set.characters[i - 1]!];\n      if      (cs.expandedC === i)     cs.expandedC = i - 1;\n      else if (cs.expandedC === i - 1) cs.expandedC = i;\n      refreshCList(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-cdn]').forEach(btn => {\n    btn.addEventListener('click', e => {\n      e.stopPropagation();\n      const i = parseInt(btn.dataset['cdn']!);\n      if (i >= cs.set.characters.length - 1) return;\n      [cs.set.characters[i + 1], cs.set.characters[i]] = [cs.set.characters[i]!, cs.set.characters[i + 1]!];\n      if      (cs.expandedC === i)     cs.expandedC = i + 1;\n      else if (cs.expandedC === i + 1) cs.expandedC = i;\n      refreshCList(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLInputElement>('[data-cname]').forEach(inp => {\n    inp.addEventListener('input', () => {\n      cs.set.characters[parseInt(inp.dataset['cname']!)]!.name = inp.value;\n    });\n  });\n\n  el.querySelectorAll<HTMLInputElement>('[data-ccost]').forEach(inp => {\n    inp.addEventListener('input', () => {\n      cs.set.characters[parseInt(inp.dataset['ccost']!)]!.cost = Math.max(0, parseInt(inp.value) || 0);\n    });\n  });\n\n  el.querySelectorAll<HTMLInputElement>('[data-cimg]').forEach(inp => {\n    inp.addEventListener('input', () => {\n      cs.set.characters[parseInt(inp.dataset['cimg']!)]!.imageUrl = inp.value;\n      // Refresh to show/hide preview\n      refreshCList(el);\n    });\n  });\n}\n", "import type { Screen } from './types';\nimport {\n  setNav as gameSetNav,\n  renderSetup, resumeGame, hasActiveSave, preload,\n} from './game';\nimport {\n  setNav as editorSetNav,\n  renderPackEditor, renderCharacterEditor,\n} from './editor';\nimport { loadSaves, deleteSave } from './storage';\nimport { escapeHtml, formatTime, showModal } from './utils';\n\n// \u2500\u2500 Navigation \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nconst ALL_SCREENS: Screen[] = [\n  'home', 'setup', 'game', 'results', 'pack-editor', 'character-editor',\n];\n\nfunction getEl(screen: Screen): HTMLElement {\n  return document.getElementById(`screen-${screen}`)!;\n}\n\nfunction navigateTo(screen: Screen): void {\n  ALL_SCREENS.forEach(s => getEl(s).classList.add('hidden'));\n  getEl(screen).classList.remove('hidden');\n\n  if      (screen === 'home')             renderHome();\n  else if (screen === 'setup')            renderSetup(getEl('setup'));\n  else if (screen === 'pack-editor')      renderPackEditor(getEl('pack-editor'));\n  else if (screen === 'character-editor') renderCharacterEditor(getEl('character-editor'));\n}\n\n// \u2500\u2500 Home Screen \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction renderHome(): void {\n  const el      = getEl('home');\n  const hasSave = hasActiveSave();\n\n  el.innerHTML = `\n    <div class=\"min-h-screen flex flex-col items-center justify-center p-6 bg-gray-950\">\n\n      <div class=\"text-8xl mb-4 select-none\">\u265F</div>\n      <h1 class=\"text-5xl font-black tracking-tight mb-2\">Chess Level Up</h1>\n      <p class=\"text-gray-400 mb-12 text-center text-sm\">\n        \u041E\u0442\u0432\u0435\u0447\u0430\u0439 \u043D\u0430 \u0432\u043E\u043F\u0440\u043E\u0441\u044B \u2014 \u043E\u0442\u043A\u0440\u044B\u0432\u0430\u0439 \u043D\u043E\u0432\u044B\u0445 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0435\u0439!\n      </p>\n\n      <div class=\"w-full max-w-xs space-y-3\">\n\n        <button id=\"btn-new\"\n          class=\"w-full py-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-2xl font-bold text-xl transition shadow-lg shadow-indigo-900/30\">\n          \u041D\u043E\u0432\u0430\u044F \u0438\u0433\u0440\u0430\n        </button>\n\n        ${hasSave ? `\n          <button id=\"btn-continue\"\n            class=\"w-full py-4 bg-yellow-500 hover:bg-yellow-400 text-black rounded-2xl font-bold text-xl transition shadow-lg shadow-yellow-900/30\">\n            \u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C\n          </button>\n        ` : ''}\n\n        <button id=\"btn-pack-ed\"\n          class=\"w-full py-3 bg-gray-800 hover:bg-gray-700 text-white rounded-2xl font-semibold transition\">\n          \u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432\n        </button>\n\n        <button id=\"btn-char-ed\"\n          class=\"w-full py-3 bg-gray-800 hover:bg-gray-700 text-white rounded-2xl font-semibold transition\">\n          \u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0435\u0439\n        </button>\n\n      </div>\n    </div>\n  `;\n\n  el.querySelector('#btn-new')?.addEventListener('click', () => navigateTo('setup'));\n  el.querySelector('#btn-continue')?.addEventListener('click', () => showSavePicker());\n  el.querySelector('#btn-pack-ed')?.addEventListener('click', () => navigateTo('pack-editor'));\n  el.querySelector('#btn-char-ed')?.addEventListener('click', () => navigateTo('character-editor'));\n}\n\n// \u2500\u2500 Save Picker \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction showSavePicker(): void {\n  document.getElementById('save-picker-overlay')?.remove();\n\n  const saves = loadSaves();\n  if (saves.length === 0) { renderHome(); return; }\n\n  const overlay = document.createElement('div');\n  overlay.id = 'save-picker-overlay';\n  overlay.className =\n    'fixed inset-0 bg-black/75 backdrop-blur-sm flex items-center justify-center z-50 p-4';\n\n  const renderList = () => {\n    const current = loadSaves();\n    return current.length === 0\n      ? `<div class=\"text-gray-500 text-center py-8 text-sm\">\u041D\u0435\u0442 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0439</div>`\n      : current.map(s => `\n          <div class=\"bg-gray-800 border border-gray-700 rounded-xl p-4 flex items-start gap-4\">\n            <div class=\"flex-1 min-w-0\">\n              <div class=\"font-semibold text-white truncate\">${escapeHtml(s.playerName || '\u0411\u0435\u0437 \u0438\u043C\u0435\u043D\u0438')}</div>\n              <div class=\"text-sm text-gray-400 mt-0.5\">${escapeHtml(s.packTitle)}</div>\n              <div class=\"text-xs text-gray-500 mt-0.5\">\n                ${s.charName ? escapeHtml(s.charName) + ' \u00B7 ' : ''}\u0412\u043E\u043F\u0440\u043E\u0441 ${escapeHtml(s.questionProgress)}\n              </div>\n              <div class=\"flex items-center gap-3 mt-1.5 text-xs text-gray-500\">\n                <span class=\"text-yellow-400\">\u2605 ${s.totalStars}</span>\n                <span>${formatTime(s.savedAt)}</span>\n              </div>\n            </div>\n            <div class=\"flex flex-col gap-2 flex-shrink-0\">\n              <button data-resume=\"${s.id}\"\n                class=\"py-1.5 px-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-sm font-semibold transition\">\n                \u25B6 \u0418\u0433\u0440\u0430\u0442\u044C\n              </button>\n              <button data-delete=\"${s.id}\"\n                class=\"py-1.5 px-4 bg-gray-700 hover:bg-red-800 text-gray-300 hover:text-white rounded-lg text-sm transition\">\n                \u0423\u0434\u0430\u043B\u0438\u0442\u044C\n              </button>\n            </div>\n          </div>\n        `).join('');\n  };\n\n  overlay.innerHTML = `\n    <div class=\"bg-gray-900 border border-gray-800 rounded-2xl w-full max-w-md shadow-2xl overflow-hidden\">\n      <div class=\"flex items-center justify-between px-5 py-4 border-b border-gray-800\">\n        <h2 class=\"text-lg font-bold\">\u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C \u0438\u0433\u0440\u0443</h2>\n        <button id=\"sp-close\"\n          class=\"text-gray-400 hover:text-white text-2xl w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-800 transition\">\n          \u00D7\n        </button>\n      </div>\n      <div id=\"sp-list\" class=\"p-4 space-y-3 max-h-96 overflow-y-auto\">\n        ${renderList()}\n      </div>\n    </div>\n  `;\n\n  const bindEvents = () => {\n    overlay.querySelectorAll<HTMLElement>('[data-resume]').forEach(btn => {\n      btn.addEventListener('click', () => {\n        overlay.remove();\n        resumeGame(btn.dataset['resume']!);\n      });\n    });\n\n    overlay.querySelectorAll<HTMLElement>('[data-delete]').forEach(btn => {\n      btn.addEventListener('click', () => {\n        showModal('\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u044D\u0442\u043E \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0435?', () => {\n          deleteSave(btn.dataset['delete']!);\n          const list = overlay.querySelector('#sp-list');\n          if (list) list.innerHTML = renderList();\n          bindEvents();\n          if (loadSaves().length === 0) { overlay.remove(); renderHome(); }\n        });\n      });\n    });\n  };\n\n  bindEvents();\n\n  overlay.querySelector('#sp-close')?.addEventListener('click', () => overlay.remove());\n  overlay.addEventListener('click', e => { if (e.target === overlay) overlay.remove(); });\n\n  document.body.appendChild(overlay);\n}\n\n// \u2500\u2500 Init \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nasync function init(): Promise<void> {\n  gameSetNav(navigateTo);\n  editorSetNav(navigateTo);\n  await preload();\n  navigateTo('home');\n}\n\ndocument.addEventListener('DOMContentLoaded', () => { void init(); });\n"],
  "mappings": "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",
  "names": ["escapeHtml", "str", "sanitizeImageUrl", "url", "parsed", "showModal", "message", "onConfirm", "overlay", "box", "msg", "btns", "cancel", "confirm", "ok", "e", "formatTime", "timestamp", "mins", "hours", "downloadJson", "data", "filename", "blob", "a", "PACKS_KEY", "CHAR_SETS_KEY", "SAVES_KEY", "loadPacks", "savePacks", "packs", "loadCharacterSets", "saveCharacterSets", "sets", "loadSaves", "upsertSave", "state", "saves", "idx", "s", "charName", "slot", "deleteSave", "id", "filtered", "loadBuiltinPacks", "files", "f", "r", "loadBuiltinCharacterSets", "game", "timerInterval", "timerRemaining", "_nav", "builtinPacks", "builtinSets", "setNav", "fn", "preload", "loadBuiltinPacks", "loadBuiltinCharacterSets", "hasActiveSave", "loadSaves", "allPacks", "loadPacks", "allSets", "loadCharacterSets", "renderSetup", "el", "packs", "sets", "canStart", "p", "i", "escapeHtml", "s", "selPack", "selChars", "updateCompat", "warning", "maxStars", "sorted", "a", "b", "maxNeeded", "unlockable", "c", "playerName", "packIdx", "setIdx", "timer", "startGame", "shuffle", "arr", "j", "pack", "characterSet", "timerSeconds", "sortedChars", "upsertSave", "renderGameScreen", "resumeGame", "id", "slot", "stopTimer", "chars", "cur", "next", "q", "prevCost", "nextCost", "progressPct", "starsToNext", "img", "url", "cls", "safe", "sanitizeImageUrl", "handleAnswer", "showAllCharactersOverlay", "showModal", "startTimer", "wasTimerRunning", "savedRemaining", "maxCost", "overlay", "imgTag", "unlocked", "closeOverlay", "e", "seconds", "updateTimerDisplay", "correct", "justUnlocked", "showUnlockOverlay", "advanceQuestion", "char", "onContinue", "safeUrl", "deleteSave", "renderResults", "finalChar", "_nav", "setNav", "fn", "ps", "newPackState", "renderPackEditor", "el", "loadPacks", "drawPack", "drawPackList", "drawPackEdit", "p", "i", "escapeHtml", "e", "file", "reader", "ev", "data", "savePacks", "showModal", "btn", "downloadJson", "renderQList", "titleEl", "starsEl", "refreshQList", "bindQEvents", "questions", "q", "open", "list", "row", "ta", "inp", "cs", "newCharState", "renderCharacterEditor", "loadCharacterSets", "drawChar", "drawCharList", "drawCharEdit", "s", "saveCharacterSets", "renderCList", "refreshCList", "bindCEvents", "chars", "c", "safeImg", "sanitizeImageUrl", "t", "ALL_SCREENS", "getEl", "screen", "navigateTo", "s", "renderHome", "renderSetup", "renderPackEditor", "renderCharacterEditor", "el", "hasSave", "hasActiveSave", "showSavePicker", "loadSaves", "overlay", "renderList", "current", "escapeHtml", "formatTime", "bindEvents", "btn", "resumeGame", "showModal", "deleteSave", "list", "e", "init", "setNav", "preload"]
}
