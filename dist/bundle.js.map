{
  "version": 3,
  "sources": ["../src/utils.ts", "../node_modules/@lichess-org/chessground/src/types.ts", "../node_modules/@lichess-org/chessground/src/util.ts", "../node_modules/@lichess-org/chessground/src/premove.ts", "../node_modules/@lichess-org/chessground/src/board.ts", "../node_modules/@lichess-org/chessground/src/fen.ts", "../node_modules/@lichess-org/chessground/src/config.ts", "../node_modules/@lichess-org/chessground/src/anim.ts", "../node_modules/@lichess-org/chessground/src/draw.ts", "../node_modules/@lichess-org/chessground/src/drag.ts", "../node_modules/@lichess-org/chessground/src/explosion.ts", "../node_modules/@lichess-org/chessground/src/api.ts", "../node_modules/@lichess-org/chessground/src/state.ts", "../node_modules/@lichess-org/chessground/src/svg.ts", "../node_modules/@lichess-org/chessground/src/wrap.ts", "../node_modules/@lichess-org/chessground/src/drop.ts", "../node_modules/@lichess-org/chessground/src/events.ts", "../node_modules/@lichess-org/chessground/src/render.ts", "../node_modules/@lichess-org/chessground/src/sync.ts", "../node_modules/@lichess-org/chessground/src/autoPieces.ts", "../node_modules/@lichess-org/chessground/src/chessground.ts", "../src/board.ts", "../node_modules/chess.js/src/pgn.js", "../node_modules/src/chess.ts", "../src/storage.ts", "../src/game.ts", "../src/editor.ts", "../src/app.ts"],
  "sourcesContent": ["export function escapeHtml(str: string): string {\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n\nexport function sanitizeImageUrl(url: string): string {\n  try {\n    const parsed = new URL(url);\n    if (parsed.protocol === 'http:' || parsed.protocol === 'https:') return url;\n  } catch { /* ignore */ }\n  return '';\n}\n\nexport function showModal(message: string, onConfirm?: () => void): void {\n  document.getElementById('modal-overlay')?.remove();\n\n  const overlay = document.createElement('div');\n  overlay.id = 'modal-overlay';\n  overlay.className =\n    'fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50';\n\n  const box = document.createElement('div');\n  box.className =\n    'bg-gray-800 border border-gray-700 rounded-2xl p-6 max-w-sm w-full mx-4 shadow-2xl';\n\n  const msg = document.createElement('p');\n  msg.className = 'text-white text-center mb-6 text-base leading-relaxed';\n  msg.textContent = message;\n  box.appendChild(msg);\n\n  const btns = document.createElement('div');\n  btns.className = 'flex gap-3 justify-center';\n\n  if (onConfirm) {\n    const cancel = document.createElement('button');\n    cancel.className =\n      'flex-1 py-2.5 rounded-xl bg-gray-600 hover:bg-gray-500 text-white font-semibold transition';\n    cancel.textContent = '\u041E\u0442\u043C\u0435\u043D\u0430';\n    cancel.onclick = () => overlay.remove();\n    btns.appendChild(cancel);\n\n    const confirm = document.createElement('button');\n    confirm.className =\n      'flex-1 py-2.5 rounded-xl bg-red-600 hover:bg-red-500 text-white font-semibold transition';\n    confirm.textContent = '\u041F\u043E\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044C';\n    confirm.onclick = () => { overlay.remove(); onConfirm(); };\n    btns.appendChild(confirm);\n  } else {\n    const ok = document.createElement('button');\n    ok.className =\n      'px-10 py-2.5 rounded-xl bg-indigo-600 hover:bg-indigo-500 text-white font-semibold transition';\n    ok.textContent = 'OK';\n    ok.onclick = () => overlay.remove();\n    btns.appendChild(ok);\n  }\n\n  box.appendChild(btns);\n  overlay.appendChild(box);\n  overlay.addEventListener('click', e => { if (e.target === overlay) overlay.remove(); });\n  document.body.appendChild(overlay);\n}\n\nexport function formatTime(timestamp: number): string {\n  const mins = Math.floor((Date.now() - timestamp) / 60000);\n  if (mins < 1)  return '\u0442\u043E\u043B\u044C\u043A\u043E \u0447\u0442\u043E';\n  if (mins < 60) return `${mins} \u043C\u0438\u043D. \u043D\u0430\u0437\u0430\u0434`;\n  const hours = Math.floor(mins / 60);\n  if (hours < 24) return `${hours} \u0447. \u043D\u0430\u0437\u0430\u0434`;\n  return `${Math.floor(hours / 24)} \u0434. \u043D\u0430\u0437\u0430\u0434`;\n}\n\nexport function downloadJson(data: unknown, filename: string): void {\n  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  a.click();\n  URL.revokeObjectURL(url);\n}\n", "export type Color = (typeof colors)[number];\nexport type Role = (typeof roles)[number];\nexport type File = (typeof files)[number];\nexport type Rank = (typeof ranks)[number];\nexport type Key = 'a0' | `${File}${Rank}`;\nexport type FEN = string;\nexport type Pos = [number, number];\nexport interface PosAndKey {\n  pos: Pos;\n  key: Key;\n}\nexport interface Piece {\n  role: Role;\n  color: Color;\n  promoted?: boolean;\n}\nexport interface Drop {\n  role: Role;\n  key: Key;\n}\nexport type Pieces = Map<Key, Piece>;\nexport type PiecesDiff = Map<Key, Piece | undefined>;\n\nexport type KeyPair = [Key, Key];\n\nexport type NumberPair = [number, number];\n\nexport type NumberQuad = [number, number, number, number];\n\nexport interface Rect {\n  left: number;\n  top: number;\n  width: number;\n  height: number;\n}\n\nexport type Dests = Map<Key, Key[]>;\n\nexport interface Elements {\n  board: HTMLElement;\n  wrap: HTMLElement;\n  container: HTMLElement;\n  ghost?: HTMLElement;\n  shapes?: SVGElement;\n  custom?: SVGElement;\n  shapesBelow?: SVGElement;\n  customBelow?: SVGElement;\n  autoPieces?: HTMLElement;\n}\nexport interface Dom {\n  elements: Elements;\n  bounds: Memo<DOMRectReadOnly>;\n  redraw: () => void;\n  redrawNow: (skipSvg?: boolean) => void;\n  unbind?: Unbind;\n  destroyed?: boolean;\n}\nexport interface Exploding {\n  stage: number;\n  keys: readonly Key[];\n}\n\nexport interface MoveMetadata {\n  premove: boolean;\n  ctrlKey?: boolean;\n  holdTime?: number;\n  captured?: Piece;\n  predrop?: boolean;\n}\nexport interface SetPremoveMetadata {\n  ctrlKey?: boolean;\n}\n\nexport type MouchEvent = Event & Partial<MouseEvent & TouchEvent>;\n\nexport interface KeyedNode extends HTMLElement {\n  cgKey: Key;\n}\nexport interface PieceNode extends KeyedNode {\n  tagName: 'PIECE';\n  cgPiece: string;\n  cgAnimating?: boolean;\n  cgFading?: boolean;\n  cgDragging?: boolean;\n  cgScale?: number;\n}\nexport interface SquareNode extends KeyedNode {\n  tagName: 'SQUARE';\n}\n\nexport interface Memo<A> {\n  (): A;\n  clear: () => void;\n}\n\nexport interface Timer {\n  start: () => void;\n  cancel: () => void;\n  stop: () => number;\n}\n\nexport type Redraw = () => void;\nexport type Unbind = () => void;\nexport type Milliseconds = number;\nexport type KHz = number;\n\nexport const colors = ['white', 'black'] as const;\nexport const roles = ['pawn', 'knight', 'bishop', 'rook', 'queen', 'king'] as const;\nexport const files = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'] as const;\nexport const ranks = ['1', '2', '3', '4', '5', '6', '7', '8'] as const;\n\nexport type RanksPosition = 'left' | 'right';\n\nexport type BrushColor = 'green' | 'red' | 'blue' | 'yellow';\n\nexport type SquareClasses = Map<Key, string>;\n\nexport type DirectionalCheck = (x1: number, y1: number, x2: number, y2: number) => boolean;\n\nexport type MobilityContext = {\n  orig: PosAndKey;\n  dest: PosAndKey;\n  role: Role;\n  allPieces: Pieces;\n  friendlies: Pieces;\n  enemies: Pieces;\n  color: Color;\n  rookFilesFriendlies: number[];\n  lastMove: Key[] | undefined;\n};\n\nexport type Mobility = (ctx: MobilityContext) => boolean;\n", "import * as cg from './types.js';\n\nexport const invRanks: readonly cg.Rank[] = [...cg.ranks].reverse();\n\nexport const allKeys: readonly cg.Key[] = cg.files.flatMap(f => cg.ranks.map(r => (f + r) as cg.Key));\n\nexport const pos2key = (pos: cg.Pos): cg.Key | undefined =>\n  pos.every(x => x >= 0 && x <= 7) ? allKeys[8 * pos[0] + pos[1]] : undefined;\n\nexport const pos2keyUnsafe = (pos: cg.Pos): cg.Key => pos2key(pos)!;\n\nexport const key2pos = (k: cg.Key): cg.Pos => [k.charCodeAt(0) - 97, k.charCodeAt(1) - 49];\n\nexport const uciToMove = (uci: string | undefined): cg.Key[] | undefined => {\n  if (!uci) return undefined;\n  if (uci[1] === '@') return [uci.slice(2, 4) as cg.Key];\n  return [uci.slice(0, 2), uci.slice(2, 4)] as cg.Key[];\n};\n\nexport const allPos: readonly cg.Pos[] = allKeys.map(key2pos);\n\nexport const allPosAndKey: readonly cg.PosAndKey[] = allKeys.map((key, i) => ({ key, pos: allPos[i] }));\n\nexport function memo<A>(f: () => A): cg.Memo<A> {\n  let v: A | undefined;\n  const ret = (): A => {\n    if (v === undefined) v = f();\n    return v;\n  };\n  ret.clear = () => {\n    v = undefined;\n  };\n  return ret;\n}\n\nexport const timer = (): cg.Timer => {\n  let startAt: number | undefined;\n  return {\n    start() {\n      startAt = performance.now();\n    },\n    cancel() {\n      startAt = undefined;\n    },\n    stop() {\n      if (!startAt) return 0;\n      const time = performance.now() - startAt;\n      startAt = undefined;\n      return time;\n    },\n  };\n};\n\nexport const opposite = (c: cg.Color): cg.Color => (c === 'white' ? 'black' : 'white');\n\nexport const distanceSq = (pos1: cg.Pos, pos2: cg.Pos): number =>\n  (pos1[0] - pos2[0]) ** 2 + (pos1[1] - pos2[1]) ** 2;\n\nexport const samePiece = (p1: cg.Piece, p2: cg.Piece): boolean =>\n  p1.role === p2.role && p1.color === p2.color;\n\nexport const samePos = (p1: cg.Pos, p2: cg.Pos): boolean => p1[0] === p2[0] && p1[1] === p2[1];\n\nexport const posToTranslate =\n  (bounds: DOMRectReadOnly): ((pos: cg.Pos, asWhite: boolean) => cg.NumberPair) =>\n  (pos, asWhite) => [\n    ((asWhite ? pos[0] : 7 - pos[0]) * bounds.width) / 8,\n    ((asWhite ? 7 - pos[1] : pos[1]) * bounds.height) / 8,\n  ];\n\nexport const translate = (el: HTMLElement, pos: cg.NumberPair): void => {\n  el.style.transform = `translate(${pos[0]}px,${pos[1]}px)`;\n};\n\nexport const translateAndScale = (el: HTMLElement, pos: cg.NumberPair, scale = 1): void => {\n  el.style.transform = `translate(${pos[0]}px,${pos[1]}px) scale(${scale})`;\n};\n\nexport const setVisible = (el: HTMLElement, v: boolean): void => {\n  el.style.visibility = v ? 'visible' : 'hidden';\n};\n\nexport const eventPosition = (e: cg.MouchEvent): cg.NumberPair | undefined => {\n  if (e.clientX || e.clientX === 0) return [e.clientX, e.clientY!];\n  if (e.targetTouches?.[0]) return [e.targetTouches[0].clientX, e.targetTouches[0].clientY];\n  return; // touchend has no position!\n};\n\nconst isFireMac = memo(\n  () =>\n    !('ontouchstart' in window) &&\n    ['macintosh', 'firefox'].every(x => navigator.userAgent.toLowerCase().includes(x)),\n);\n\nexport const isRightButton = (e: cg.MouchEvent): boolean => e.button === 2 && !(e.ctrlKey && isFireMac());\n\nexport const createEl = (tagName: string, className?: string): HTMLElement => {\n  const el = document.createElement(tagName);\n  if (className) el.className = className;\n  return el;\n};\n\nexport function computeSquareCenter(key: cg.Key, asWhite: boolean, bounds: DOMRectReadOnly): cg.NumberPair {\n  const pos = key2pos(key);\n  if (!asWhite) {\n    pos[0] = 7 - pos[0];\n    pos[1] = 7 - pos[1];\n  }\n  return [\n    bounds.left + (bounds.width * pos[0]) / 8 + bounds.width / 16,\n    bounds.top + (bounds.height * (7 - pos[1])) / 8 + bounds.height / 16,\n  ];\n}\n\nexport const diff = (a: number, b: number): number => Math.abs(a - b);\n\nexport const knightDir: cg.DirectionalCheck = (x1, y1, x2, y2) => diff(x1, x2) * diff(y1, y2) === 2;\n\nexport const rookDir: cg.DirectionalCheck = (x1, y1, x2, y2) => (x1 === x2) !== (y1 === y2);\n\nexport const bishopDir: cg.DirectionalCheck = (x1, y1, x2, y2) => diff(x1, x2) === diff(y1, y2) && x1 !== x2;\n\nexport const queenDir: cg.DirectionalCheck = (x1, y1, x2, y2) =>\n  rookDir(x1, y1, x2, y2) || bishopDir(x1, y1, x2, y2);\n\nexport const kingDirNonCastling: cg.DirectionalCheck = (x1, y1, x2, y2) =>\n  Math.max(diff(x1, x2), diff(y1, y2)) === 1;\n\nexport const pawnDirCapture = (x1: number, y1: number, x2: number, y2: number, isDirectionUp: boolean) =>\n  diff(x1, x2) === 1 && y2 === y1 + (isDirectionUp ? 1 : -1);\n\nexport const pawnDirAdvance = (x1: number, y1: number, x2: number, y2: number, isDirectionUp: boolean) => {\n  const step = isDirectionUp ? 1 : -1;\n  return (\n    x1 === x2 &&\n    (y2 === y1 + step ||\n      // allow 2 squares from first two ranks, for horde\n      (y2 === y1 + 2 * step && (isDirectionUp ? y1 <= 1 : y1 >= 6)))\n  );\n};\n\n/** Returns all board squares between (x1, y1) and (x2, y2) exclusive,\n *  along a straight line (rook or bishop path). Returns [] if not aligned, or none between.\n */\nexport const squaresBetween = (x1: number, y1: number, x2: number, y2: number): cg.Key[] => {\n  const dx = x2 - x1;\n  const dy = y2 - y1;\n\n  // Must be a straight or diagonal line\n  if (dx && dy && Math.abs(dx) !== Math.abs(dy)) return [];\n\n  const stepX = Math.sign(dx),\n    stepY = Math.sign(dy);\n  const squares: cg.Pos[] = [];\n  let x = x1 + stepX,\n    y = y1 + stepY;\n  while (x !== x2 || y !== y2) {\n    squares.push([x, y]);\n    x += stepX;\n    y += stepY;\n  }\n  return squares.map(pos2key).filter(k => k !== undefined);\n};\n\nexport const adjacentSquares = (square: cg.Key): cg.Key[] => {\n  const pos = key2pos(square);\n  const adjacentSquares: cg.Pos[] = [];\n  if (pos[0] > 0) adjacentSquares.push([pos[0] - 1, pos[1]]);\n  if (pos[0] < 7) adjacentSquares.push([pos[0] + 1, pos[1]]);\n  return adjacentSquares.map(pos2key).filter(k => k !== undefined);\n};\n\nexport const squareShiftedVertically = (square: cg.Key, delta: number): cg.Key | undefined => {\n  const pos = key2pos(square);\n  pos[1] += delta;\n  return pos2key(pos);\n};\n", "import * as util from './util.js';\nimport * as cg from './types.js';\nimport { HeadlessState } from './state.js';\nimport { Mobility, MobilityContext } from './types.js';\n\nconst pawn: Mobility = (ctx: MobilityContext) =>\n  util.diff(ctx.orig.pos[0], ctx.dest.pos[0]) <= 1 &&\n  (util.diff(ctx.orig.pos[0], ctx.dest.pos[0]) === 1\n    ? ctx.dest.pos[1] === ctx.orig.pos[1] + (ctx.color === 'white' ? 1 : -1)\n    : util.pawnDirAdvance(...ctx.orig.pos, ...ctx.dest.pos, ctx.color === 'white'));\n\nconst knight: Mobility = (ctx: MobilityContext) => util.knightDir(...ctx.orig.pos, ...ctx.dest.pos);\n\nconst bishop: Mobility = (ctx: MobilityContext) => util.bishopDir(...ctx.orig.pos, ...ctx.dest.pos);\n\nconst rook: Mobility = (ctx: MobilityContext) => util.rookDir(...ctx.orig.pos, ...ctx.dest.pos);\n\nconst queen: Mobility = (ctx: MobilityContext) => bishop(ctx) || rook(ctx);\n\nconst king: Mobility = (ctx: MobilityContext) =>\n  util.kingDirNonCastling(...ctx.orig.pos, ...ctx.dest.pos) ||\n  (ctx.orig.pos[1] === ctx.dest.pos[1] &&\n    ctx.orig.pos[1] === (ctx.color === 'white' ? 0 : 7) &&\n    ((ctx.orig.pos[0] === 4 &&\n      ((ctx.dest.pos[0] === 2 && ctx.rookFilesFriendlies.includes(0)) ||\n        (ctx.dest.pos[0] === 6 && ctx.rookFilesFriendlies.includes(7)))) ||\n      ctx.rookFilesFriendlies.includes(ctx.dest.pos[0])));\n\nconst mobilityByRole = { pawn, knight, bishop, rook, queen, king };\n\nexport function premove(state: HeadlessState, key: cg.Key): cg.Key[] {\n  const pieces = state.pieces;\n  const piece = pieces.get(key);\n  if (!piece || piece.color === state.turnColor) return [];\n  const color = piece.color,\n    friendlies = new Map([...pieces].filter(([_, p]) => p.color === color)),\n    enemies = new Map([...pieces].filter(([_, p]) => p.color === util.opposite(color))),\n    orig = { key, pos: util.key2pos(key) },\n    mobility: Mobility = (ctx: MobilityContext) =>\n      mobilityByRole[piece.role](ctx) && state.premovable.additionalPremoveRequirements(ctx),\n    partialCtx = {\n      orig,\n      role: piece.role,\n      allPieces: pieces,\n      friendlies: friendlies,\n      enemies: enemies,\n      color: color,\n      rookFilesFriendlies: Array.from(pieces)\n        .filter(\n          ([k, p]) => k[1] === (color === 'white' ? '1' : '8') && p.color === color && p.role === 'rook',\n        )\n        .map(([k]) => util.key2pos(k)[0]),\n      lastMove: state.lastMove,\n    };\n  // todo - remove more properties from MobilityContext that aren't used in this file, and adjust as needed in lila.\n  return util.allPosAndKey.filter(dest => mobility({ ...partialCtx, dest })).map(pk => pk.key);\n}\n", "import { HeadlessState } from './state.js';\nimport {\n  pos2key,\n  key2pos,\n  opposite,\n  distanceSq,\n  allPos,\n  computeSquareCenter,\n  queenDir,\n  knightDir,\n  samePos,\n  pos2keyUnsafe,\n} from './util.js';\nimport { premove } from './premove.js';\nimport * as cg from './types.js';\n\nexport function callUserFunction<T extends (...args: any[]) => void>(\n  f: T | undefined,\n  ...args: Parameters<T>\n): void {\n  if (f) setTimeout(() => f(...args), 1);\n}\n\nexport function toggleOrientation(state: HeadlessState): void {\n  state.orientation = opposite(state.orientation);\n  state.animation.current = state.draggable.current = state.selected = undefined;\n}\n\nexport function reset(state: HeadlessState): void {\n  state.lastMove = undefined;\n  unselect(state);\n  unsetPremove(state);\n  unsetPredrop(state);\n}\n\nexport function setPieces(state: HeadlessState, pieces: cg.PiecesDiff): void {\n  for (const [key, piece] of pieces) {\n    if (piece) state.pieces.set(key, piece);\n    else state.pieces.delete(key);\n  }\n}\n\nexport function setCheck(state: HeadlessState, color: cg.Color | boolean): void {\n  state.check = undefined;\n  if (color === true) color = state.turnColor;\n  if (color)\n    for (const [k, p] of state.pieces) {\n      if (p.role === 'king' && p.color === color) {\n        state.check = k;\n      }\n    }\n}\n\nfunction setPremove(state: HeadlessState, orig: cg.Key, dest: cg.Key, meta: cg.SetPremoveMetadata): void {\n  unsetPredrop(state);\n  state.premovable.current = [orig, dest];\n  callUserFunction(state.premovable.events.set, orig, dest, meta);\n}\n\nexport function unsetPremove(state: HeadlessState): void {\n  if (state.premovable.current) {\n    state.premovable.current = undefined;\n    callUserFunction(state.premovable.events.unset);\n  }\n}\n\nfunction setPredrop(state: HeadlessState, role: cg.Role, key: cg.Key): void {\n  unsetPremove(state);\n  state.predroppable.current = { role, key };\n  callUserFunction(state.predroppable.events.set, role, key);\n}\n\nexport function unsetPredrop(state: HeadlessState): void {\n  const pd = state.predroppable;\n  if (pd.current) {\n    pd.current = undefined;\n    callUserFunction(pd.events.unset);\n  }\n}\n\nfunction tryAutoCastle(state: HeadlessState, orig: cg.Key, dest: cg.Key): boolean {\n  if (!state.autoCastle) return false;\n\n  const king = state.pieces.get(orig);\n  if (!king || king.role !== 'king') return false;\n\n  const origPos = key2pos(orig);\n  const destPos = key2pos(dest);\n  if ((origPos[1] !== 0 && origPos[1] !== 7) || origPos[1] !== destPos[1]) return false;\n  if (origPos[0] === 4 && !state.pieces.has(dest)) {\n    if (destPos[0] === 6) dest = pos2keyUnsafe([7, destPos[1]]);\n    else if (destPos[0] === 2) dest = pos2keyUnsafe([0, destPos[1]]);\n  }\n  const rook = state.pieces.get(dest);\n  if (!rook || rook.color !== king.color || rook.role !== 'rook') return false;\n\n  state.pieces.delete(orig);\n  state.pieces.delete(dest);\n\n  if (origPos[0] < destPos[0]) {\n    state.pieces.set(pos2keyUnsafe([6, destPos[1]]), king);\n    state.pieces.set(pos2keyUnsafe([5, destPos[1]]), rook);\n  } else {\n    state.pieces.set(pos2keyUnsafe([2, destPos[1]]), king);\n    state.pieces.set(pos2keyUnsafe([3, destPos[1]]), rook);\n  }\n  return true;\n}\n\nexport function baseMove(state: HeadlessState, orig: cg.Key, dest: cg.Key): cg.Piece | boolean {\n  const origPiece = state.pieces.get(orig),\n    destPiece = state.pieces.get(dest);\n  if (orig === dest || !origPiece) return false;\n  const captured = destPiece && destPiece.color !== origPiece.color ? destPiece : undefined;\n  if (dest === state.selected) unselect(state);\n  callUserFunction(state.events.move, orig, dest, captured);\n  if (!tryAutoCastle(state, orig, dest)) {\n    state.pieces.set(dest, origPiece);\n    state.pieces.delete(orig);\n  }\n  state.lastMove = [orig, dest];\n  state.check = undefined;\n  callUserFunction(state.events.change);\n  return captured || true;\n}\n\nexport function baseNewPiece(state: HeadlessState, piece: cg.Piece, key: cg.Key, force?: boolean): boolean {\n  if (state.pieces.has(key)) {\n    if (force) state.pieces.delete(key);\n    else return false;\n  }\n  callUserFunction(state.events.dropNewPiece, piece, key);\n  state.pieces.set(key, piece);\n  state.lastMove = [key];\n  state.check = undefined;\n  callUserFunction(state.events.change);\n  state.movable.dests = undefined;\n  state.turnColor = opposite(state.turnColor);\n  return true;\n}\n\nfunction baseUserMove(state: HeadlessState, orig: cg.Key, dest: cg.Key): cg.Piece | boolean {\n  const result = baseMove(state, orig, dest);\n  if (result) {\n    state.movable.dests = undefined;\n    state.turnColor = opposite(state.turnColor);\n    state.animation.current = undefined;\n  }\n  return result;\n}\n\nexport function userMove(state: HeadlessState, orig: cg.Key, dest: cg.Key): boolean {\n  if (canMove(state, orig, dest)) {\n    const result = baseUserMove(state, orig, dest);\n    if (result) {\n      const holdTime = state.hold.stop();\n      unselect(state);\n      const metadata: cg.MoveMetadata = {\n        premove: false,\n        ctrlKey: state.stats.ctrlKey,\n        holdTime,\n      };\n      if (result !== true) metadata.captured = result;\n      callUserFunction(state.movable.events.after, orig, dest, metadata);\n      return true;\n    }\n  } else if (canPremove(state, orig, dest)) {\n    setPremove(state, orig, dest, {\n      ctrlKey: state.stats.ctrlKey,\n    });\n    unselect(state);\n    return true;\n  }\n  unselect(state);\n  return false;\n}\n\nexport function dropNewPiece(state: HeadlessState, orig: cg.Key, dest: cg.Key, force?: boolean): void {\n  const piece = state.pieces.get(orig);\n  if (piece && (canDrop(state, orig, dest) || force)) {\n    state.pieces.delete(orig);\n    baseNewPiece(state, piece, dest, force);\n    callUserFunction(state.movable.events.afterNewPiece, piece.role, dest, {\n      premove: false,\n      predrop: false,\n    });\n  } else if (piece && canPredrop(state, orig, dest)) {\n    setPredrop(state, piece.role, dest);\n  } else {\n    unsetPremove(state);\n    unsetPredrop(state);\n  }\n  state.pieces.delete(orig);\n  unselect(state);\n}\n\nexport function selectSquare(state: HeadlessState, key: cg.Key, force?: boolean): void {\n  callUserFunction(state.events.select, key);\n  if (state.selected) {\n    if (state.selected === key && !state.draggable.enabled) {\n      unselect(state);\n      state.hold.cancel();\n      return;\n    } else if ((state.selectable.enabled || force) && state.selected !== key) {\n      if (userMove(state, state.selected, key)) {\n        state.stats.dragged = false;\n        return;\n      }\n    }\n  }\n  if (\n    (state.selectable.enabled || state.draggable.enabled) &&\n    (isMovable(state, key) || isPremovable(state, key))\n  ) {\n    setSelected(state, key);\n    state.hold.start();\n  }\n}\n\nexport function setSelected(state: HeadlessState, key: cg.Key): void {\n  state.selected = key;\n  if (!isPremovable(state, key)) state.premovable.dests = undefined;\n  else if (!state.premovable.customDests) state.premovable.dests = premove(state, key);\n  // calculate chess premoves if custom premoves are not passed\n}\n\nexport function unselect(state: HeadlessState): void {\n  state.selected = undefined;\n  state.premovable.dests = undefined;\n  state.hold.cancel();\n}\n\nfunction isMovable(state: HeadlessState, orig: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  return (\n    !!piece &&\n    (state.movable.color === 'both' ||\n      (state.movable.color === piece.color && state.turnColor === piece.color))\n  );\n}\n\nexport const canMove = (state: HeadlessState, orig: cg.Key, dest: cg.Key): boolean =>\n  orig !== dest &&\n  isMovable(state, orig) &&\n  (state.movable.free || !!state.movable.dests?.get(orig)?.includes(dest));\n\nfunction canDrop(state: HeadlessState, orig: cg.Key, dest: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  return (\n    !!piece &&\n    (orig === dest || !state.pieces.has(dest)) &&\n    (state.movable.color === 'both' ||\n      (state.movable.color === piece.color && state.turnColor === piece.color))\n  );\n}\n\nfunction isPremovable(state: HeadlessState, orig: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  return (\n    !!piece &&\n    state.premovable.enabled &&\n    state.movable.color === piece.color &&\n    state.turnColor !== piece.color\n  );\n}\n\nconst canPremove = (state: HeadlessState, orig: cg.Key, dest: cg.Key): boolean =>\n  orig !== dest &&\n  isPremovable(state, orig) &&\n  (state.premovable.customDests?.get(orig) ?? premove(state, orig)).includes(dest);\n\nfunction canPredrop(state: HeadlessState, orig: cg.Key, dest: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  const destPiece = state.pieces.get(dest);\n  return (\n    !!piece &&\n    (!destPiece || destPiece.color !== state.movable.color) &&\n    state.predroppable.enabled &&\n    (piece.role !== 'pawn' || (dest[1] !== '1' && dest[1] !== '8')) &&\n    state.movable.color === piece.color &&\n    state.turnColor !== piece.color\n  );\n}\n\nexport function isDraggable(state: HeadlessState, orig: cg.Key): boolean {\n  const piece = state.pieces.get(orig);\n  return (\n    !!piece &&\n    state.draggable.enabled &&\n    (state.movable.color === 'both' ||\n      (state.movable.color === piece.color && (state.turnColor === piece.color || state.premovable.enabled)))\n  );\n}\n\nexport function playPremove(state: HeadlessState): boolean {\n  const move = state.premovable.current;\n  if (!move) return false;\n  const orig = move[0],\n    dest = move[1];\n  let success = false;\n  if (canMove(state, orig, dest)) {\n    const result = baseUserMove(state, orig, dest);\n    if (result) {\n      const metadata: cg.MoveMetadata = { premove: true };\n      if (result !== true) metadata.captured = result;\n      callUserFunction(state.movable.events.after, orig, dest, metadata);\n      success = true;\n    }\n  }\n  unsetPremove(state);\n  return success;\n}\n\nexport function playPredrop(state: HeadlessState, validate: (drop: cg.Drop) => boolean): boolean {\n  const drop = state.predroppable.current;\n  let success = false;\n  if (!drop) return false;\n  if (validate(drop)) {\n    const piece = {\n      role: drop.role,\n      color: state.movable.color,\n    } as cg.Piece;\n    if (baseNewPiece(state, piece, drop.key)) {\n      callUserFunction(state.movable.events.afterNewPiece, drop.role, drop.key, {\n        premove: false,\n        predrop: true,\n      });\n      success = true;\n    }\n  }\n  unsetPredrop(state);\n  return success;\n}\n\nexport function cancelMove(state: HeadlessState): void {\n  unsetPremove(state);\n  unsetPredrop(state);\n  unselect(state);\n}\n\nexport function stop(state: HeadlessState): void {\n  state.movable.color = state.movable.dests = state.animation.current = undefined;\n  cancelMove(state);\n}\n\nexport function getKeyAtDomPos(\n  pos: cg.NumberPair,\n  asWhite: boolean,\n  bounds: DOMRectReadOnly,\n): cg.Key | undefined {\n  let file = Math.floor((8 * (pos[0] - bounds.left)) / bounds.width);\n  if (!asWhite) file = 7 - file;\n  let rank = 7 - Math.floor((8 * (pos[1] - bounds.top)) / bounds.height);\n  if (!asWhite) rank = 7 - rank;\n  return file >= 0 && file < 8 && rank >= 0 && rank < 8 ? pos2key([file, rank]) : undefined;\n}\n\nexport function getSnappedKeyAtDomPos(\n  orig: cg.Key,\n  pos: cg.NumberPair,\n  asWhite: boolean,\n  bounds: DOMRectReadOnly,\n): cg.Key | undefined {\n  const origPos = key2pos(orig);\n  const validSnapPos = allPos.filter(\n    pos2 =>\n      samePos(origPos, pos2) ||\n      queenDir(origPos[0], origPos[1], pos2[0], pos2[1]) ||\n      knightDir(origPos[0], origPos[1], pos2[0], pos2[1]),\n  );\n  const validSnapCenters = validSnapPos.map(pos2 =>\n    computeSquareCenter(pos2keyUnsafe(pos2), asWhite, bounds),\n  );\n  const validSnapDistances = validSnapCenters.map(pos2 => distanceSq(pos, pos2));\n  const [, closestSnapIndex] = validSnapDistances.reduce(\n    (a, b, index) => (a[0] < b ? a : [b, index]),\n    [validSnapDistances[0], 0],\n  );\n  return pos2key(validSnapPos[closestSnapIndex]);\n}\n\nexport const whitePov = (s: HeadlessState): boolean => s.orientation === 'white';\n", "import { pos2key, invRanks } from './util.js';\nimport * as cg from './types.js';\n\nexport const initial: cg.FEN = 'rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR';\n\nconst roles: { [letter: string]: cg.Role } = {\n  p: 'pawn',\n  r: 'rook',\n  n: 'knight',\n  b: 'bishop',\n  q: 'queen',\n  k: 'king',\n};\n\nconst letters = {\n  pawn: 'p',\n  rook: 'r',\n  knight: 'n',\n  bishop: 'b',\n  queen: 'q',\n  king: 'k',\n};\n\nexport function read(fen: cg.FEN): cg.Pieces {\n  if (fen === 'start') fen = initial;\n  const pieces: cg.Pieces = new Map();\n  let row = 7,\n    col = 0;\n  for (const c of fen) {\n    switch (c) {\n      case ' ':\n      case '[':\n        return pieces;\n      case '/':\n        --row;\n        if (row < 0) return pieces;\n        col = 0;\n        break;\n      case '~': {\n        const k = pos2key([col - 1, row]);\n        const piece = k && pieces.get(k);\n        if (piece) piece.promoted = true;\n        break;\n      }\n      default: {\n        const nb = c.charCodeAt(0);\n        if (nb < 57) col += nb - 48;\n        else {\n          const role = c.toLowerCase();\n          const key = pos2key([col, row]);\n          if (key)\n            pieces.set(key, {\n              role: roles[role],\n              color: c === role ? 'black' : 'white',\n            });\n          ++col;\n        }\n      }\n    }\n  }\n  return pieces;\n}\n\nexport function write(pieces: cg.Pieces): cg.FEN {\n  return invRanks\n    .map(y =>\n      cg.files\n        .map(x => {\n          const piece = pieces.get((x + y) as cg.Key);\n          if (piece) {\n            let p = letters[piece.role];\n            if (piece.color === 'white') p = p.toUpperCase();\n            if (piece.promoted) p += '~';\n            return p;\n          } else return '1';\n        })\n        .join(''),\n    )\n    .join('/')\n    .replace(/1{2,}/g, s => s.length.toString());\n}\n", "import { HeadlessState } from './state.js';\nimport { setCheck, setSelected } from './board.js';\nimport { read as fenRead } from './fen.js';\nimport { DrawShape, DrawBrushes } from './draw.js';\nimport * as cg from './types.js';\n\nexport interface Config {\n  fen?: cg.FEN; // chess position in Forsyth notation\n  orientation?: cg.Color; // board orientation. white | black\n  turnColor?: cg.Color; // turn to play. white | black\n  check?: cg.Color | boolean; // true for current color, false to unset\n  lastMove?: cg.Key[]; // squares part of the last move [\"c3\", \"c4\"]\n  selected?: cg.Key; // square currently selected \"a1\"\n  coordinates?: boolean; // include coords attributes\n  coordinatesOnSquares?: boolean; // include coords attributes on every square\n  ranksPosition?: cg.RanksPosition; // render rank coords on the right (default) or the left\n  autoCastle?: boolean; // immediately complete the castle by moving the rook after king move\n  viewOnly?: boolean; // don't bind events: the user will never be able to move pieces around\n  disableContextMenu?: boolean; // because who needs a context menu on a chessboard\n  addPieceZIndex?: boolean; // adds z-index values to pieces (for 3D)\n  addDimensionsCssVarsTo?: HTMLElement; // add ---cg-width and ---cg-height CSS vars containing the board's dimensions to this element\n  blockTouchScroll?: boolean; // block scrolling via touch dragging on the board, e.g. for coordinate training\n  touchIgnoreRadius?: number; // ignore touches within a radius of an occupied square, in units of its circumradius\n  trustAllEvents?: boolean; // disable checking for human only input (e.isTrusted)\n  highlight?: {\n    lastMove?: boolean; // add last-move class to squares\n    check?: boolean; // add check class to squares\n    custom?: cg.SquareClasses; // add custom classes to custom squares\n  };\n  animation?: {\n    enabled?: boolean;\n    duration?: number;\n  };\n  movable?: {\n    free?: boolean; // all moves are valid - board editor\n    color?: cg.Color | 'both'; // color that can move. white | black | both | undefined\n    dests?: cg.Dests; // valid moves. {\"a2\" [\"a3\" \"a4\"] \"b1\" [\"a3\" \"c3\"]}\n    showDests?: boolean; // whether to add the move-dest class on squares\n    events?: {\n      after?: (orig: cg.Key, dest: cg.Key, metadata: cg.MoveMetadata) => void; // called after the move has been played\n      afterNewPiece?: (role: cg.Role, key: cg.Key, metadata: cg.MoveMetadata) => void; // called after a new piece is dropped on the board\n    };\n    rookCastle?: boolean; // castle by moving the king to the rook\n  };\n  premovable?: {\n    enabled?: boolean; // allow premoves for color that can not move\n    showDests?: boolean; // whether to add the premove-dest class on squares\n    castle?: boolean; // whether to allow king castle premoves\n    dests?: cg.Key[]; // premove destinations for the current selection\n    customDests?: cg.Dests; // use custom valid premoves. {\"a2\" [\"a3\" \"a4\"] \"b1\" [\"a3\" \"c3\"]}\n    additionalPremoveRequirements?: cg.Mobility;\n    events?: {\n      set?: (orig: cg.Key, dest: cg.Key, metadata?: cg.SetPremoveMetadata) => void; // called after the premove has been set\n      unset?: () => void; // called after the premove has been unset\n    };\n  };\n  predroppable?: {\n    enabled?: boolean; // allow predrops for color that can not move\n    events?: {\n      set?: (role: cg.Role, key: cg.Key) => void; // called after the predrop has been set\n      unset?: () => void; // called after the predrop has been unset\n    };\n  };\n  draggable?: {\n    enabled?: boolean; // allow moves & premoves to use drag'n drop\n    distance?: number; // minimum distance to initiate a drag; in pixels\n    autoDistance?: boolean; // lets chessground set distance to zero when user drags pieces\n    showGhost?: boolean; // show ghost of piece being dragged\n    deleteOnDropOff?: boolean; // delete a piece when it is dropped off the board\n  };\n  selectable?: {\n    // disable to enforce dragging over click-click move\n    enabled?: boolean;\n  };\n  events?: {\n    change?: () => void; // called after the situation changes on the board\n    // called after a piece has been moved.\n    // capturedPiece is undefined or like {color: 'white'; 'role': 'queen'}\n    move?: (orig: cg.Key, dest: cg.Key, capturedPiece?: cg.Piece) => void;\n    dropNewPiece?: (piece: cg.Piece, key: cg.Key) => void;\n    select?: (key: cg.Key) => void; // called when a square is selected\n    insert?: (elements: cg.Elements) => void; // when the board DOM has been (re)inserted\n  };\n  drawable?: {\n    enabled?: boolean; // can draw\n    visible?: boolean; // can view\n    defaultSnapToValidMove?: boolean;\n    // Clicking an empty square or immovable piece will clear the drawing regardless, but when this property is true,\n    // clicking on a (currently unselected) movable piece will also clear the drawing.\n    eraseOnMovablePieceClick?: boolean;\n    shapes?: DrawShape[];\n    autoShapes?: DrawShape[];\n    brushes?: DrawBrushes;\n    onChange?: (shapes: DrawShape[]) => void; // called after drawable shapes change\n  };\n}\n\nexport function applyAnimation(state: HeadlessState, config: Config): void {\n  if (config.animation) {\n    deepMerge(state.animation, config.animation);\n    // no need for such short animations\n    if ((state.animation.duration || 0) < 70) state.animation.enabled = false;\n  }\n}\n\nexport function configure(state: HeadlessState, config: Config): void {\n  // don't merge destinations and autoShapes. Just override.\n  if (config.movable?.dests) state.movable.dests = undefined;\n  if (config.drawable?.autoShapes) state.drawable.autoShapes = [];\n\n  deepMerge(state, config);\n\n  // if a fen was provided, replace the pieces\n  if (config.fen) {\n    state.pieces = fenRead(config.fen);\n    state.drawable.shapes = config.drawable?.shapes || [];\n  }\n\n  // apply config values that could be undefined yet meaningful\n  if ('check' in config) setCheck(state, config.check || false);\n  if ('lastMove' in config && !config.lastMove) state.lastMove = undefined;\n  // in case of ZH drop last move, there's a single square.\n  // if the previous last move had two squares,\n  // the merge algorithm will incorrectly keep the second square.\n  else if (config.lastMove) state.lastMove = config.lastMove;\n\n  // fix move/premove dests\n  if (state.selected) setSelected(state, state.selected);\n\n  applyAnimation(state, config);\n\n  if (!state.movable.rookCastle && state.movable.dests) {\n    const rank = state.movable.color === 'white' ? '1' : '8',\n      kingStartPos = ('e' + rank) as cg.Key,\n      dests = state.movable.dests.get(kingStartPos),\n      king = state.pieces.get(kingStartPos);\n    if (!dests || !king || king.role !== 'king') return;\n    state.movable.dests.set(\n      kingStartPos,\n      dests.filter(\n        d =>\n          !(d === 'a' + rank && dests.includes(('c' + rank) as cg.Key)) &&\n          !(d === 'h' + rank && dests.includes(('g' + rank) as cg.Key)),\n      ),\n    );\n  }\n}\n\nfunction deepMerge(base: any, extend: any): void {\n  for (const key in extend) {\n    if (key === '__proto__' || key === 'constructor' || !Object.prototype.hasOwnProperty.call(extend, key))\n      continue;\n    if (\n      Object.prototype.hasOwnProperty.call(base, key) &&\n      isPlainObject(base[key]) &&\n      isPlainObject(extend[key])\n    )\n      deepMerge(base[key], extend[key]);\n    else base[key] = extend[key];\n  }\n}\n\nfunction isPlainObject(o: unknown): boolean {\n  if (typeof o !== 'object' || o === null) return false;\n  const proto = Object.getPrototypeOf(o);\n  return proto === Object.prototype || proto === null;\n}\n", "import { State } from './state.js';\nimport * as util from './util.js';\nimport * as cg from './types.js';\n\nexport type Mutation<A> = (state: State) => A;\n\n// 0,1 animation goal\n// 2,3 animation current status\nexport type AnimVector = cg.NumberQuad;\n\nexport type AnimVectors = Map<cg.Key, AnimVector>;\n\nexport type AnimFadings = Map<cg.Key, cg.Piece>;\n\nexport interface AnimPlan {\n  anims: AnimVectors;\n  fadings: AnimFadings;\n}\n\nexport interface AnimCurrent {\n  start: DOMHighResTimeStamp;\n  frequency: cg.KHz;\n  plan: AnimPlan;\n}\n\nexport const anim = <A>(mutation: Mutation<A>, state: State): A =>\n  state.animation.enabled ? animate(mutation, state) : render(mutation, state);\n\nexport function render<A>(mutation: Mutation<A>, state: State): A {\n  const result = mutation(state);\n  state.dom.redraw();\n  return result;\n}\n\ninterface AnimPiece {\n  key: cg.Key;\n  pos: cg.Pos;\n  piece: cg.Piece;\n}\ntype AnimPieces = Map<cg.Key, AnimPiece>;\n\nconst makePiece = (key: cg.Key, piece: cg.Piece): AnimPiece => ({\n  key: key,\n  pos: util.key2pos(key),\n  piece: piece,\n});\n\nconst closer = (piece: AnimPiece, pieces: AnimPiece[]): AnimPiece | undefined =>\n  pieces.sort((p1, p2) => util.distanceSq(piece.pos, p1.pos) - util.distanceSq(piece.pos, p2.pos))[0];\n\nfunction computePlan(prevPieces: cg.Pieces, current: State): AnimPlan {\n  const anims: AnimVectors = new Map(),\n    animedOrigs: cg.Key[] = [],\n    fadings: AnimFadings = new Map(),\n    missings: AnimPiece[] = [],\n    news: AnimPiece[] = [],\n    prePieces: AnimPieces = new Map();\n  let curP: cg.Piece | undefined, preP: AnimPiece | undefined, vector: cg.NumberPair;\n  for (const [k, p] of prevPieces) {\n    prePieces.set(k, makePiece(k, p));\n  }\n  for (const key of util.allKeys) {\n    curP = current.pieces.get(key);\n    preP = prePieces.get(key);\n    if (curP) {\n      if (preP) {\n        if (!util.samePiece(curP, preP.piece)) {\n          missings.push(preP);\n          news.push(makePiece(key, curP));\n        }\n      } else news.push(makePiece(key, curP));\n    } else if (preP) missings.push(preP);\n  }\n  for (const newP of news) {\n    preP = closer(\n      newP,\n      missings.filter(p => util.samePiece(newP.piece, p.piece)),\n    );\n    if (preP) {\n      vector = [preP.pos[0] - newP.pos[0], preP.pos[1] - newP.pos[1]];\n      anims.set(newP.key, vector.concat(vector) as AnimVector);\n      animedOrigs.push(preP.key);\n    }\n  }\n  for (const p of missings) {\n    if (!animedOrigs.includes(p.key)) fadings.set(p.key, p.piece);\n  }\n\n  return {\n    anims: anims,\n    fadings: fadings,\n  };\n}\n\nfunction step(state: State, now: DOMHighResTimeStamp): void {\n  const cur = state.animation.current;\n  if (cur === undefined) {\n    // animation was canceled :(\n    if (!state.dom.destroyed) state.dom.redrawNow();\n    return;\n  }\n  const rest = 1 - (now - cur.start) * cur.frequency;\n  if (rest <= 0) {\n    state.animation.current = undefined;\n    state.dom.redrawNow();\n  } else {\n    const ease = easing(rest);\n    for (const cfg of cur.plan.anims.values()) {\n      cfg[2] = cfg[0] * ease;\n      cfg[3] = cfg[1] * ease;\n    }\n    state.dom.redrawNow(true); // optimisation: don't render SVG changes during animations\n    requestAnimationFrame((now = performance.now()) => step(state, now));\n  }\n}\n\nfunction animate<A>(mutation: Mutation<A>, state: State): A {\n  // clone state before mutating it\n  const prevPieces: cg.Pieces = new Map(state.pieces);\n\n  const result = mutation(state);\n  const plan = computePlan(prevPieces, state);\n  if (plan.anims.size || plan.fadings.size) {\n    const alreadyRunning = state.animation.current && state.animation.current.start;\n    state.animation.current = {\n      start: performance.now(),\n      frequency: 1 / state.animation.duration,\n      plan: plan,\n    };\n    if (!alreadyRunning) step(state, performance.now());\n  } else {\n    // don't animate, just render right away\n    state.dom.redraw();\n  }\n  return result;\n}\n\n// https://gist.github.com/gre/1650294\nconst easing = (t: number): number => (t < 0.5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1);\n", "import { State } from './state.js';\nimport { unselect, cancelMove, getKeyAtDomPos, getSnappedKeyAtDomPos, whitePov } from './board.js';\nimport { eventPosition, isRightButton } from './util.js';\nimport * as cg from './types.js';\n\nexport interface DrawShape {\n  orig: cg.Key;\n  dest?: cg.Key;\n  brush?: string; // if no brush, no shape. label moved to top right of square\n  modifiers?: DrawModifiers;\n  piece?: DrawShapePiece;\n  customSvg?: { html: string; center?: 'orig' | 'dest' | 'label' }; // midpoint location of 100 x 100 viewbox\n  label?: { text: string; fill?: string }; // '#rrggbb' or '#rgb'\n  below?: boolean; // render to board plane, default is false (above pieces)\n}\n\nexport interface DrawModifiers {\n  lineWidth?: number;\n  hilite?: string; // '#rrggbb'/'#rgb' - only implemented for arrows\n}\n\nexport interface DrawShapePiece {\n  role: cg.Role;\n  color: cg.Color;\n  scale?: number;\n}\n\nexport interface DrawBrush {\n  key: string;\n  color: string;\n  opacity: number;\n  lineWidth: number;\n}\n\nexport interface DrawBrushes {\n  green: DrawBrush;\n  red: DrawBrush;\n  blue: DrawBrush;\n  yellow: DrawBrush;\n  [color: string]: DrawBrush;\n}\n\nexport interface Drawable {\n  enabled: boolean; // can draw\n  visible: boolean; // can view\n  defaultSnapToValidMove: boolean;\n  eraseOnMovablePieceClick: boolean;\n  onChange?: (shapes: DrawShape[]) => void;\n  shapes: DrawShape[]; // user shapes\n  autoShapes: DrawShape[]; // computer shapes\n  current?: DrawCurrent;\n  brushes: DrawBrushes;\n  prevSvgHash: string;\n}\n\nexport interface DrawCurrent {\n  orig: cg.Key; // orig key of drawing\n  dest?: cg.Key; // shape dest, or undefined for circle\n  mouseSq?: cg.Key; // square being moused over\n  pos: cg.NumberPair; // relative current position\n  brush: cg.BrushColor; // brush name for shape\n  snapToValidMove: boolean; // whether to snap to valid piece moves\n}\n\nconst brushes: cg.BrushColor[] = ['green', 'red', 'blue', 'yellow'];\n\nexport function start(state: State, e: cg.MouchEvent): void {\n  // support one finger touch only\n  if (e.touches && e.touches.length > 1) return;\n  e.stopPropagation();\n  e.preventDefault();\n  e.ctrlKey ? unselect(state) : cancelMove(state);\n  const pos = eventPosition(e)!,\n    orig = getKeyAtDomPos(pos, whitePov(state), state.dom.bounds());\n  if (!orig) return;\n  state.drawable.current = {\n    orig,\n    pos,\n    brush: eventBrush(e),\n    snapToValidMove: state.drawable.defaultSnapToValidMove,\n  };\n\n  processDraw(state);\n}\n\nexport function processDraw(state: State): void {\n  requestAnimationFrame(() => {\n    const cur = state.drawable.current;\n    if (cur) {\n      const keyAtDomPos = getKeyAtDomPos(cur.pos, whitePov(state), state.dom.bounds());\n      if (!keyAtDomPos) {\n        cur.snapToValidMove = false;\n      }\n      const mouseSq = cur.snapToValidMove\n        ? getSnappedKeyAtDomPos(cur.orig, cur.pos, whitePov(state), state.dom.bounds())\n        : keyAtDomPos;\n      if (mouseSq !== cur.mouseSq) {\n        cur.mouseSq = mouseSq;\n        cur.dest = mouseSq !== cur.orig ? mouseSq : undefined;\n        state.dom.redrawNow();\n      }\n      processDraw(state);\n    }\n  });\n}\n\nexport function move(state: State, e: cg.MouchEvent): void {\n  if (state.drawable.current) state.drawable.current.pos = eventPosition(e)!;\n}\n\nexport function end(state: State): void {\n  const cur = state.drawable.current;\n  if (cur) {\n    if (cur.mouseSq) addShape(state.drawable, cur);\n    cancel(state);\n  }\n}\n\nexport function cancel(state: State): void {\n  if (state.drawable.current) {\n    state.drawable.current = undefined;\n    state.dom.redraw();\n  }\n}\n\nexport function clear(state: State): void {\n  if (state.drawable.shapes.length) {\n    state.drawable.shapes = [];\n    state.dom.redraw();\n    onChange(state.drawable);\n  }\n}\n\nexport const sameEndpoints = (s1: DrawShape, s2: DrawShape) => s1.orig === s2.orig && s1.dest === s2.dest;\n\nexport const sameColor = (s1: DrawShape, s2: DrawShape) => s1.brush === s2.brush;\n\nfunction eventBrush(e: cg.MouchEvent): cg.BrushColor {\n  const modA = (e.shiftKey || e.ctrlKey) && isRightButton(e);\n  const modB = e.altKey || e.metaKey || e.getModifierState?.('AltGraph');\n  return brushes[(modA ? 1 : 0) + (modB ? 2 : 0)];\n}\n\nfunction addShape(drawable: Drawable, cur: DrawCurrent): void {\n  const similar = drawable.shapes.find(s => sameEndpoints(s, cur));\n  if (similar) drawable.shapes = drawable.shapes.filter(s => !sameEndpoints(s, cur));\n  if (!similar || !sameColor(similar, cur))\n    drawable.shapes.push({\n      orig: cur.orig,\n      dest: cur.dest,\n      brush: cur.brush,\n    });\n  onChange(drawable);\n}\n\nfunction onChange(drawable: Drawable): void {\n  if (drawable.onChange) drawable.onChange(drawable.shapes);\n}\n", "import { State } from './state.js';\nimport * as board from './board.js';\nimport * as util from './util.js';\nimport { clear as drawClear } from './draw.js';\nimport * as cg from './types.js';\nimport { anim } from './anim.js';\n\nexport interface DragCurrent {\n  orig: cg.Key; // orig key of dragging piece\n  piece: cg.Piece;\n  origPos: cg.NumberPair; // first event position\n  pos: cg.NumberPair; // latest event position\n  started: boolean; // whether the drag has started; as per the distance setting\n  element: cg.PieceNode | (() => cg.PieceNode | undefined);\n  newPiece?: boolean; // it it a new piece from outside the board\n  force?: boolean; // can the new piece replace an existing one (editor)\n  previouslySelected?: cg.Key;\n  originTarget: EventTarget | null;\n  keyHasChanged: boolean; // whether the drag has left the orig key\n}\n\nexport function start(s: State, e: cg.MouchEvent): void {\n  if (!(s.trustAllEvents || e.isTrusted)) return; // only trust when trustAllEvents is enabled\n  if (e.buttons !== undefined && e.buttons > 1) return; // only touch or left click\n  if (e.touches && e.touches.length > 1) return; // support one finger touch only\n  const bounds = s.dom.bounds(),\n    position = util.eventPosition(e)!,\n    orig = board.getKeyAtDomPos(position, board.whitePov(s), bounds);\n  if (!orig) return;\n  const piece = s.pieces.get(orig);\n  const previouslySelected = s.selected;\n  if (\n    !previouslySelected &&\n    s.drawable.enabled &&\n    (s.drawable.eraseOnMovablePieceClick || !piece || piece.color !== s.turnColor)\n  )\n    drawClear(s);\n  // Prevent touch scroll and create no corresponding mouse event, if there\n  // is an intent to interact with the board.\n  if (\n    e.cancelable !== false &&\n    (!e.touches || s.blockTouchScroll || piece || previouslySelected || pieceCloseTo(s, position))\n  )\n    e.preventDefault();\n  else if (e.touches) return; // Handle only corresponding mouse event https://github.com/lichess-org/chessground/pull/268\n\n  const hadPremove = !!s.premovable.current;\n  const hadPredrop = !!s.predroppable.current;\n  s.stats.ctrlKey = e.ctrlKey;\n  if (s.selected && board.canMove(s, s.selected, orig)) {\n    anim(state => board.selectSquare(state, orig), s);\n  } else {\n    board.selectSquare(s, orig);\n  }\n  const stillSelected = s.selected === orig;\n  const element = pieceElementByKey(s, orig);\n  if (piece && element && stillSelected && board.isDraggable(s, orig)) {\n    s.draggable.current = {\n      orig,\n      piece,\n      origPos: position,\n      pos: position,\n      started: s.draggable.autoDistance && s.stats.dragged,\n      element,\n      previouslySelected,\n      originTarget: e.target,\n      keyHasChanged: false,\n    };\n    element.cgDragging = true;\n    element.classList.add('dragging');\n    // place ghost\n    const ghost = s.dom.elements.ghost;\n    if (ghost) {\n      ghost.className = `ghost ${piece.color} ${piece.role}`;\n      util.translate(ghost, util.posToTranslate(bounds)(util.key2pos(orig), board.whitePov(s)));\n      util.setVisible(ghost, true);\n    }\n    processDrag(s);\n  } else {\n    if (hadPremove) board.unsetPremove(s);\n    if (hadPredrop) board.unsetPredrop(s);\n  }\n  s.dom.redraw();\n}\n\nfunction pieceCloseTo(s: State, pos: cg.NumberPair): boolean {\n  const asWhite = board.whitePov(s),\n    bounds = s.dom.bounds(),\n    radiusSq = Math.pow((s.touchIgnoreRadius * bounds.width) / 16, 2) * 2;\n  for (const key of s.pieces.keys()) {\n    const center = util.computeSquareCenter(key, asWhite, bounds);\n    if (util.distanceSq(center, pos) <= radiusSq) return true;\n  }\n  return false;\n}\n\nexport function dragNewPiece(s: State, piece: cg.Piece, e: cg.MouchEvent, force?: boolean): void {\n  const key: cg.Key = 'a0';\n  s.pieces.set(key, piece);\n  s.dom.redraw();\n\n  const position = util.eventPosition(e)!;\n\n  s.draggable.current = {\n    orig: key,\n    piece,\n    origPos: position,\n    pos: position,\n    started: true,\n    element: () => pieceElementByKey(s, key),\n    originTarget: e.target,\n    newPiece: true,\n    force: !!force,\n    keyHasChanged: false,\n  };\n  processDrag(s);\n}\n\nfunction processDrag(s: State): void {\n  requestAnimationFrame(() => {\n    const cur = s.draggable.current;\n    if (!cur) return;\n    // cancel animations while dragging\n    if (s.animation.current?.plan.anims.has(cur.orig)) s.animation.current = undefined;\n    // if moving piece is gone, cancel\n    const origPiece = s.pieces.get(cur.orig);\n    if (!origPiece || !util.samePiece(origPiece, cur.piece)) cancel(s);\n    else {\n      if (!cur.started && util.distanceSq(cur.pos, cur.origPos) >= Math.pow(s.draggable.distance, 2))\n        cur.started = true;\n      if (cur.started) {\n        // support lazy elements\n        if (typeof cur.element === 'function') {\n          const found = cur.element();\n          if (!found) return;\n          found.cgDragging = true;\n          found.classList.add('dragging');\n          cur.element = found;\n        }\n\n        const bounds = s.dom.bounds();\n        util.translate(cur.element, [\n          cur.pos[0] - bounds.left - bounds.width / 16,\n          cur.pos[1] - bounds.top - bounds.height / 16,\n        ]);\n\n        cur.keyHasChanged ||= cur.orig !== board.getKeyAtDomPos(cur.pos, board.whitePov(s), bounds);\n      }\n    }\n    processDrag(s);\n  });\n}\n\nexport function move(s: State, e: cg.MouchEvent): void {\n  // support one finger touch only\n  if (s.draggable.current && (!e.touches || e.touches.length < 2)) {\n    s.draggable.current.pos = util.eventPosition(e)!;\n  }\n}\n\nexport function end(s: State, e: cg.MouchEvent): void {\n  const cur = s.draggable.current;\n  if (!cur) return;\n  // create no corresponding mouse event\n  if (e.type === 'touchend' && e.cancelable !== false) e.preventDefault();\n  // comparing with the origin target is an easy way to test that the end event\n  // has the same touch origin\n  if (e.type === 'touchend' && cur.originTarget !== e.target && !cur.newPiece) {\n    s.draggable.current = undefined;\n    return;\n  }\n  board.unsetPremove(s);\n  board.unsetPredrop(s);\n  // touchend has no position; so use the last touchmove position instead\n  const eventPos = util.eventPosition(e) || cur.pos;\n  const dest = board.getKeyAtDomPos(eventPos, board.whitePov(s), s.dom.bounds());\n  if (dest && cur.started && cur.orig !== dest) {\n    if (cur.newPiece) board.dropNewPiece(s, cur.orig, dest, cur.force);\n    else {\n      s.stats.ctrlKey = e.ctrlKey;\n      if (board.userMove(s, cur.orig, dest)) s.stats.dragged = true;\n    }\n  } else if (cur.newPiece) {\n    s.pieces.delete(cur.orig);\n  } else if (s.draggable.deleteOnDropOff && !dest) {\n    s.pieces.delete(cur.orig);\n    board.callUserFunction(s.events.change);\n  }\n  if ((cur.orig === cur.previouslySelected || cur.keyHasChanged) && (cur.orig === dest || !dest))\n    board.unselect(s);\n  else if (!s.selectable.enabled) board.unselect(s);\n\n  removeDragElements(s);\n\n  s.draggable.current = undefined;\n  s.dom.redraw();\n}\n\nexport function cancel(s: State): void {\n  const cur = s.draggable.current;\n  if (cur) {\n    if (cur.newPiece) s.pieces.delete(cur.orig);\n    s.draggable.current = undefined;\n    board.unselect(s);\n    removeDragElements(s);\n    s.dom.redraw();\n  }\n}\n\nfunction removeDragElements(s: State): void {\n  const e = s.dom.elements;\n  if (e.ghost) util.setVisible(e.ghost, false);\n}\n\nfunction pieceElementByKey(s: State, key: cg.Key): cg.PieceNode | undefined {\n  let el = s.dom.elements.board.firstChild;\n  while (el) {\n    if ((el as cg.KeyedNode).cgKey === key && (el as cg.KeyedNode).tagName === 'PIECE')\n      return el as cg.PieceNode;\n    el = el.nextSibling;\n  }\n  return;\n}\n", "import { State } from './state.js';\nimport { Key } from './types.js';\n\nexport function explosion(state: State, keys: Key[]): void {\n  state.exploding = { stage: 1, keys };\n  state.dom.redraw();\n  setTimeout(() => {\n    setStage(state, 2);\n    setTimeout(() => setStage(state, undefined), 120);\n  }, 120);\n}\n\nfunction setStage(state: State, stage: number | undefined): void {\n  if (state.exploding) {\n    if (stage) state.exploding.stage = stage;\n    else state.exploding = undefined;\n    state.dom.redraw();\n  }\n}\n", "import { State } from './state.js';\nimport * as board from './board.js';\nimport { write as fenWrite } from './fen.js';\nimport { Config, configure, applyAnimation } from './config.js';\nimport { anim, render } from './anim.js';\nimport { cancel as dragCancel, dragNewPiece } from './drag.js';\nimport { DrawShape } from './draw.js';\nimport { explosion } from './explosion.js';\nimport * as cg from './types.js';\n\nexport interface Api {\n  // reconfigure the instance. Accepts all config options, except for viewOnly & drawable.visible.\n  // board will be animated accordingly, if animations are enabled.\n  set(config: Config): void;\n\n  // read chessground state; write at your own risks.\n  state: State;\n\n  // get the position as a FEN string (only contains pieces, no flags)\n  // e.g. rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR\n  getFen(): cg.FEN;\n\n  // change the view angle\n  toggleOrientation(): void;\n\n  // perform a move programmatically\n  move(orig: cg.Key, dest: cg.Key): void;\n\n  // add and/or remove arbitrary pieces on the board\n  setPieces(pieces: cg.PiecesDiff): void;\n\n  // click a square programmatically\n  selectSquare(key: cg.Key | null, force?: boolean): void;\n\n  // put a new piece on the board\n  newPiece(piece: cg.Piece, key: cg.Key): void;\n\n  // play the current premove, if any; returns true if premove was played\n  playPremove(): boolean;\n\n  // cancel the current premove, if any\n  cancelPremove(): void;\n\n  // play the current predrop, if any; returns true if premove was played\n  playPredrop(validate: (drop: cg.Drop) => boolean): boolean;\n\n  // cancel the current predrop, if any\n  cancelPredrop(): void;\n\n  // cancel the current move being made\n  cancelMove(): void;\n\n  // cancel current move and prevent further ones\n  stop(): void;\n\n  // make squares explode (atomic chess)\n  explode(keys: cg.Key[]): void;\n\n  // programmatically draw user shapes\n  setShapes(shapes: DrawShape[]): void;\n\n  // programmatically draw auto shapes\n  setAutoShapes(shapes: DrawShape[]): void;\n\n  // square name at this DOM position (like \"e4\")\n  getKeyAtDomPos(pos: cg.NumberPair): cg.Key | undefined;\n\n  // only useful when CSS changes the board width/height ratio (for 3D)\n  redrawAll: cg.Redraw;\n\n  // for crazyhouse and board editors\n  dragNewPiece(piece: cg.Piece, event: cg.MouchEvent, force?: boolean): void;\n\n  // unbinds all events\n  // (important for document-wide events like scroll and mousemove)\n  destroy: cg.Unbind;\n}\n\n// see API types and documentations in dts/api.d.ts\nexport function start(state: State, redrawAll: cg.Redraw): Api {\n  function toggleOrientation(): void {\n    board.toggleOrientation(state);\n    redrawAll();\n  }\n\n  return {\n    set(config): void {\n      if (config.orientation && config.orientation !== state.orientation) toggleOrientation();\n      applyAnimation(state, config);\n      (config.fen ? anim : render)(state => configure(state, config), state);\n    },\n\n    state,\n\n    getFen: () => fenWrite(state.pieces),\n\n    toggleOrientation,\n\n    setPieces(pieces): void {\n      anim(state => board.setPieces(state, pieces), state);\n    },\n\n    selectSquare(key, force): void {\n      if (key) anim(state => board.selectSquare(state, key, force), state);\n      else if (state.selected) {\n        board.unselect(state);\n        state.dom.redraw();\n      }\n    },\n\n    move(orig, dest): void {\n      anim(state => board.baseMove(state, orig, dest), state);\n    },\n\n    newPiece(piece, key): void {\n      anim(state => board.baseNewPiece(state, piece, key), state);\n    },\n\n    playPremove(): boolean {\n      if (state.premovable.current) {\n        if (anim(board.playPremove, state)) return true;\n        // if the premove couldn't be played, redraw to clear it up\n        state.dom.redraw();\n      }\n      return false;\n    },\n\n    playPredrop(validate): boolean {\n      if (state.predroppable.current) {\n        const result = board.playPredrop(state, validate);\n        state.dom.redraw();\n        return result;\n      }\n      return false;\n    },\n\n    cancelPremove(): void {\n      render(board.unsetPremove, state);\n    },\n\n    cancelPredrop(): void {\n      render(board.unsetPredrop, state);\n    },\n\n    cancelMove(): void {\n      render(state => {\n        board.cancelMove(state);\n        dragCancel(state);\n      }, state);\n    },\n\n    stop(): void {\n      render(state => {\n        board.stop(state);\n        dragCancel(state);\n      }, state);\n    },\n\n    explode(keys: cg.Key[]): void {\n      explosion(state, keys);\n    },\n\n    setAutoShapes(shapes: DrawShape[]): void {\n      render(state => (state.drawable.autoShapes = shapes), state);\n    },\n\n    setShapes(shapes: DrawShape[]): void {\n      render(state => (state.drawable.shapes = shapes.slice()), state);\n    },\n\n    getKeyAtDomPos(pos): cg.Key | undefined {\n      return board.getKeyAtDomPos(pos, board.whitePov(state), state.dom.bounds());\n    },\n\n    redrawAll,\n\n    dragNewPiece(piece, event, force): void {\n      dragNewPiece(state, piece, event, force);\n    },\n\n    destroy(): void {\n      board.stop(state);\n      state.dom.unbind && state.dom.unbind();\n      state.dom.destroyed = true;\n    },\n  };\n}\n", "import * as fen from './fen.js';\nimport { AnimCurrent } from './anim.js';\nimport { DragCurrent } from './drag.js';\nimport { Drawable } from './draw.js';\nimport { timer } from './util.js';\nimport * as cg from './types.js';\n\nexport interface HeadlessState {\n  pieces: cg.Pieces;\n  orientation: cg.Color; // board orientation. white | black\n  turnColor: cg.Color; // turn to play. white | black\n  check?: cg.Key; // square currently in check \"a2\"\n  lastMove?: cg.Key[]; // squares part of the last move [\"c3\", \"c4\"]\n  selected?: cg.Key; // square currently selected \"a1\"\n  coordinates: boolean; // include coords attributes\n  coordinatesOnSquares: boolean; // include coords attributes on every square\n  ranksPosition: cg.RanksPosition; // position ranks on either side. left | right\n  autoCastle: boolean; // immediately complete the castle by moving the rook after king move\n  viewOnly: boolean; // don't bind events: the user will never be able to move pieces around\n  disableContextMenu: boolean; // because who needs a context menu on a chessboard\n  addPieceZIndex: boolean; // adds z-index values to pieces (for 3D)\n  addDimensionsCssVarsTo?: HTMLElement; // add ---cg-width and ---cg-height CSS vars containing the board's dimensions to this element\n  blockTouchScroll: boolean; // block scrolling via touch dragging on the board\n  touchIgnoreRadius: number; // ignore touches within a radius of an occupied square, in units of its circumradius\n  pieceKey: boolean; // add a data-key attribute to piece elements\n  trustAllEvents?: boolean; // disable checking for human only input (e.isTrusted)\n  highlight: {\n    lastMove: boolean; // add last-move class to squares\n    check: boolean; // add check class to squares\n    custom?: cg.SquareClasses; // add custom classes to custom squares\n  };\n  animation: {\n    enabled: boolean;\n    duration: number;\n    current?: AnimCurrent;\n  };\n  movable: {\n    free: boolean; // all moves are valid - board editor\n    color?: cg.Color | 'both'; // color that can move. white | black | both\n    dests?: cg.Dests; // valid moves. {\"a2\" [\"a3\" \"a4\"] \"b1\" [\"a3\" \"c3\"]}\n    showDests: boolean; // whether to add the move-dest class on squares\n    events: {\n      after?: (orig: cg.Key, dest: cg.Key, metadata: cg.MoveMetadata) => void; // called after the move has been played\n      afterNewPiece?: (role: cg.Role, key: cg.Key, metadata: cg.MoveMetadata) => void; // called after a new piece is dropped on the board\n    };\n    rookCastle: boolean; // castle by moving the king to the rook\n  };\n  premovable: {\n    enabled: boolean; // allow premoves for color that can not move\n    showDests: boolean; // whether to add the premove-dest class on squares\n    castle: boolean; // whether to allow king castle premoves\n    dests?: cg.Key[]; // premove destinations for the current selection\n    customDests?: cg.Dests; // use custom valid premoves. {\"a2\" [\"a3\" \"a4\"] \"b1\" [\"a3\" \"c3\"]}\n    current?: cg.KeyPair; // keys of the current saved premove [\"e2\" \"e4\"]\n    additionalPremoveRequirements: cg.Mobility;\n    events: {\n      set?: (orig: cg.Key, dest: cg.Key, metadata?: cg.SetPremoveMetadata) => void; // called after the premove has been set\n      unset?: () => void; // called after the premove has been unset\n    };\n  };\n  predroppable: {\n    enabled: boolean; // allow predrops for color that can not move\n    current?: {\n      // current saved predrop {role: 'knight'; key: 'e4'}\n      role: cg.Role;\n      key: cg.Key;\n    };\n    events: {\n      set?: (role: cg.Role, key: cg.Key) => void; // called after the predrop has been set\n      unset?: () => void; // called after the predrop has been unset\n    };\n  };\n  draggable: {\n    enabled: boolean; // allow moves & premoves to use drag'n drop\n    distance: number; // minimum distance to initiate a drag; in pixels\n    autoDistance: boolean; // lets chessground set distance to zero when user drags pieces\n    showGhost: boolean; // show ghost of piece being dragged\n    deleteOnDropOff: boolean; // delete a piece when it is dropped off the board\n    current?: DragCurrent;\n  };\n  dropmode: {\n    active: boolean;\n    piece?: cg.Piece;\n  };\n  selectable: {\n    // disable to enforce dragging over click-click move\n    enabled: boolean;\n  };\n  stats: {\n    // was last piece dragged or clicked?\n    // needs default to false for touch\n    dragged: boolean;\n    ctrlKey?: boolean;\n  };\n  events: {\n    change?: () => void; // called after the situation changes on the board\n    // called after a piece has been moved.\n    // capturedPiece is undefined or like {color: 'white'; 'role': 'queen'}\n    move?: (orig: cg.Key, dest: cg.Key, capturedPiece?: cg.Piece) => void;\n    dropNewPiece?: (piece: cg.Piece, key: cg.Key) => void;\n    select?: (key: cg.Key) => void; // called when a square is selected\n    insert?: (elements: cg.Elements) => void; // when the board DOM has been (re)inserted\n  };\n  drawable: Drawable;\n  exploding?: cg.Exploding;\n  hold: cg.Timer;\n}\n\nexport interface State extends HeadlessState {\n  dom: cg.Dom;\n}\n\nexport function defaults(): HeadlessState {\n  return {\n    pieces: fen.read(fen.initial),\n    orientation: 'white',\n    turnColor: 'white',\n    coordinates: true,\n    coordinatesOnSquares: false,\n    ranksPosition: 'right',\n    autoCastle: true,\n    viewOnly: false,\n    disableContextMenu: false,\n    addPieceZIndex: false,\n    blockTouchScroll: false,\n    touchIgnoreRadius: 1,\n    pieceKey: false,\n    trustAllEvents: false,\n    highlight: {\n      lastMove: true,\n      check: true,\n    },\n    animation: {\n      enabled: true,\n      duration: 200,\n    },\n    movable: {\n      free: true,\n      color: 'both',\n      showDests: true,\n      events: {},\n      rookCastle: true,\n    },\n    premovable: {\n      enabled: true,\n      showDests: true,\n      castle: true,\n      additionalPremoveRequirements: _ => true,\n      events: {},\n    },\n    predroppable: {\n      enabled: false,\n      events: {},\n    },\n    draggable: {\n      enabled: true,\n      distance: 3,\n      autoDistance: true,\n      showGhost: true,\n      deleteOnDropOff: false,\n    },\n    dropmode: {\n      active: false,\n    },\n    selectable: {\n      enabled: true,\n    },\n    stats: {\n      // on touchscreen, default to \"tap-tap\" moves\n      // instead of drag\n      dragged: !('ontouchstart' in window),\n    },\n    events: {},\n    drawable: {\n      enabled: true, // can draw\n      visible: true, // can view\n      defaultSnapToValidMove: true,\n      eraseOnMovablePieceClick: true,\n      shapes: [],\n      autoShapes: [],\n      brushes: {\n        green: { key: 'g', color: '#15781B', opacity: 1, lineWidth: 10 },\n        red: { key: 'r', color: '#882020', opacity: 1, lineWidth: 10 },\n        blue: { key: 'b', color: '#003088', opacity: 1, lineWidth: 10 },\n        yellow: { key: 'y', color: '#e68f00', opacity: 1, lineWidth: 10 },\n        paleBlue: { key: 'pb', color: '#003088', opacity: 0.4, lineWidth: 15 },\n        paleGreen: { key: 'pg', color: '#15781B', opacity: 0.4, lineWidth: 15 },\n        paleRed: { key: 'pr', color: '#882020', opacity: 0.4, lineWidth: 15 },\n        paleGrey: {\n          key: 'pgr',\n          color: '#4a4a4a',\n          opacity: 0.35,\n          lineWidth: 15,\n        },\n        purple: { key: 'purple', color: '#68217a', opacity: 0.65, lineWidth: 10 },\n        pink: { key: 'pink', color: '#ee2080', opacity: 0.5, lineWidth: 10 },\n        white: { key: 'white', color: 'white', opacity: 1, lineWidth: 10 },\n        paleWhite: { key: 'pwhite', color: 'white', opacity: 0.6, lineWidth: 10 },\n      },\n      prevSvgHash: '',\n    },\n    hold: timer(),\n  };\n}\n", "import { State } from './state.js';\nimport { key2pos } from './util.js';\nimport {\n  Drawable,\n  DrawShape,\n  DrawShapePiece,\n  DrawBrush,\n  DrawBrushes,\n  DrawModifiers,\n  sameEndpoints,\n  sameColor,\n} from './draw.js';\nimport { SyncableShape, Hash } from './sync.js';\nimport * as cg from './types.js';\n\n/*\n    -- DOM hierarchy --\n    <svg class=\"cg-shapes\">      (<= svg)\n      <defs>\n        ...(for brushes)...\n      </defs>\n      <g>\n        ...(for arrows and circles)...\n      </g>\n    </svg>\n    <svg class=\"cg-custom-svgs\"> (<= customSvg)\n      <g>\n        ...(for custom svgs)...\n      </g>\n    </svg>\n  */\n\ntype CustomBrushes = Map<string, DrawBrush>; // by hash\ntype Svg = { el: SVGElement; isCustom?: boolean };\nconst angleSlotVals = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15] as const;\ntype AngleSlot = (typeof angleSlotVals)[number];\ntype AngleSlots = Set<AngleSlot>; // arrow angle slots for label positioning\ntype ArrowDests = Map<cg.Key | undefined, AngleSlots>; // angle slots per dest\n\nexport { createElement, setAttributes };\n\nexport function createDefs(): Element {\n  const defs = createElement('defs');\n  const filter = setAttributes(createElement('filter'), { id: 'cg-filter-blur' });\n  filter.appendChild(setAttributes(createElement('feGaussianBlur'), { stdDeviation: '0.013' }));\n  defs.appendChild(filter);\n  return defs;\n}\n\nexport function renderSvg(state: State, els: cg.Elements): void {\n  const d = state.drawable,\n    curD = d.current,\n    cur = curD && curD.mouseSq ? (curD as DrawShape) : undefined,\n    dests: ArrowDests = new Map(),\n    bounds = state.dom.bounds(),\n    nonPieceAutoShapes = d.autoShapes.filter(autoShape => !autoShape.piece);\n\n  for (const s of d.shapes.concat(nonPieceAutoShapes).concat(cur ? [cur] : [])) {\n    if (!s.dest) continue;\n    const sources = dests.get(s.dest) ?? new Set(),\n      from = pos2user(orient(key2pos(s.orig), state.orientation), bounds),\n      to = pos2user(orient(key2pos(s.dest), state.orientation), bounds);\n    sources.add(angleToSlot(moveAngle(from, to)));\n    dests.set(s.dest, sources);\n  }\n  const shapes: SyncableShape[] = [];\n\n  const pendingEraseIdx = cur ? d.shapes.findIndex(s => sameEndpoints(s, cur) && sameColor(s, cur)) : -1;\n\n  for (const [idx, s] of d.shapes.concat(nonPieceAutoShapes).entries()) {\n    const isPendingErase = pendingEraseIdx !== -1 && pendingEraseIdx === idx;\n    shapes.push({\n      shape: s,\n      current: false,\n      pendingErase: isPendingErase,\n      hash: shapeHash(s, isShort(s.dest, dests), false, bounds, isPendingErase, angleCount(s.dest, dests)),\n    });\n  }\n  if (cur && pendingEraseIdx === -1)\n    shapes.push({\n      shape: cur,\n      current: true,\n      hash: shapeHash(cur, isShort(cur.dest, dests), true, bounds, false, angleCount(cur.dest, dests)),\n      pendingErase: false,\n    });\n\n  const fullHash = shapes.map(sc => sc.hash).join(';');\n  if (fullHash === state.drawable.prevSvgHash) return;\n\n  state.drawable.prevSvgHash = fullHash;\n  syncDefs(d, shapes, els);\n  syncShapes(shapes, els, s => renderShape(state, s, d.brushes, dests, bounds));\n}\n\n// append only. Don't try to update/remove.\nfunction syncDefs(d: Drawable, shapes: SyncableShape[], els: cg.Elements) {\n  for (const shapesEl of [els.shapes, els.shapesBelow]) {\n    const defsEl = shapesEl!.querySelector('defs') as SVGElement;\n    const thisPlane = shapes.filter(s => (shapesEl === els.shapesBelow) === !!s.shape.below);\n    const brushes: CustomBrushes = new Map();\n    for (const s of thisPlane.filter(s => s.shape.dest && s.shape.brush)) {\n      const brush = makeCustomBrush(d.brushes[s.shape.brush!], s.shape.modifiers);\n      const { key, color } = hiliteOf(s.shape);\n      if (key && color) brushes.set(key, { key, color, opacity: 1, lineWidth: 1 });\n      brushes.set(brush.key, brush);\n    }\n    const keysInDom = new Set();\n    let el: SVGElement | undefined = defsEl.firstElementChild as SVGElement;\n    while (el) {\n      keysInDom.add(el.getAttribute('cgKey'));\n      el = el.nextElementSibling as SVGElement | undefined;\n    }\n    for (const [key, brush] of brushes.entries()) {\n      if (!keysInDom.has(key)) defsEl.appendChild(renderMarker(brush));\n    }\n  }\n}\n\nfunction syncShapes(\n  shapes: SyncableShape[],\n  els: cg.Elements,\n  renderShape: (shape: SyncableShape) => Svg[],\n): void {\n  for (const [shapesEl, customEl] of [\n    [els.shapes, els.custom],\n    [els.shapesBelow, els.customBelow],\n  ]) {\n    const [shapesG, customG] = [shapesEl, customEl].map(el => el!.querySelector('g') as SVGElement);\n    const thisPlane = shapes.filter(s => (shapesEl === els.shapesBelow) === !!s.shape.below);\n    const hashesInDom = new Map();\n\n    for (const sc of thisPlane) hashesInDom.set(sc.hash, false);\n    for (const root of [shapesG, customG]) {\n      const toRemove: SVGElement[] = [];\n      let el: SVGElement | undefined = root.firstElementChild as SVGElement,\n        elHash: Hash | null;\n      while (el) {\n        elHash = el.getAttribute('cgHash') as Hash;\n        if (hashesInDom.has(elHash)) hashesInDom.set(elHash, true);\n        else toRemove.push(el);\n        el = el.nextElementSibling as SVGElement | undefined;\n      }\n      for (const el of toRemove) root.removeChild(el);\n    }\n    // insert shapes that are not yet in dom\n    for (const sc of thisPlane.filter(s => !hashesInDom.get(s.hash))) {\n      for (const svg of renderShape(sc)) {\n        if (svg.isCustom) customG.appendChild(svg.el);\n        else shapesG.appendChild(svg.el);\n      }\n    }\n  }\n}\n\nfunction shapeHash(\n  { orig, dest, brush, piece, modifiers, customSvg, label, below }: DrawShape,\n  shorten: boolean,\n  current: boolean,\n  bounds: DOMRectReadOnly,\n  pendingErase: boolean,\n  angleCountOfDest: number,\n): Hash {\n  // a shape and an overlay svg share a lifetime and have the same cgHash attribute\n  return [\n    bounds.width,\n    bounds.height,\n    current,\n    pendingErase && 'pendingErase',\n    angleCountOfDest,\n    orig,\n    dest,\n    brush,\n    shorten && '-',\n    piece && pieceHash(piece),\n    modifiers && modifiersHash(modifiers),\n    customSvg && `custom-${textHash(customSvg.html)},${customSvg.center?.[0] ?? 'o'}`,\n    label && `label-${textHash(label.text)}`,\n    below && 'below',\n  ]\n    .filter(x => x)\n    .join(',');\n}\n\nconst pieceHash = (piece: DrawShapePiece): Hash =>\n  [piece.color, piece.role, piece.scale].filter(x => x).join(',');\n\nconst modifiersHash = (m: DrawModifiers): Hash => [m.lineWidth, m.hilite].filter(x => x).join(',');\n\nfunction textHash(s: string): Hash {\n  // Rolling hash with base 31 (cf. https://stackoverflow.com/questions/7616461/generate-a-hash-from-string-in-javascript)\n  let h = 0;\n  for (let i = 0; i < s.length; i++) {\n    h = ((h << 5) - h + s.charCodeAt(i)) >>> 0;\n  }\n  return h.toString();\n}\n\nfunction renderShape(\n  state: State,\n  { shape, current, pendingErase, hash }: SyncableShape,\n  brushes: DrawBrushes,\n  dests: ArrowDests,\n  bounds: DOMRectReadOnly,\n): Svg[] {\n  const from = pos2user(orient(key2pos(shape.orig), state.orientation), bounds),\n    to = shape.dest ? pos2user(orient(key2pos(shape.dest), state.orientation), bounds) : from,\n    brush = shape.brush && makeCustomBrush(brushes[shape.brush], shape.modifiers),\n    slots = dests.get(shape.dest),\n    svgs: Svg[] = [];\n\n  if (brush) {\n    const el = setAttributes(createElement('g'), { cgHash: hash });\n    svgs.push({ el });\n\n    if (from[0] !== to[0] || from[1] !== to[1])\n      el.appendChild(renderArrow(shape, brush, from, to, current, isShort(shape.dest, dests), pendingErase));\n    else el.appendChild(renderCircle(brushes[shape.brush!], from, current, bounds, pendingErase));\n  }\n  if (shape.label) {\n    const label = shape.label;\n    label.fill ??= shape.brush && brushes[shape.brush].color;\n    const corner = shape.brush ? undefined : 'tr';\n    svgs.push({ el: renderLabel(label, hash, from, to, slots, corner), isCustom: true });\n  }\n  if (shape.customSvg) {\n    const on = shape.customSvg.center ?? 'orig';\n    const [x, y] =\n      on === 'label' ? labelCoords(from, to, slots).map(c => c - 0.5) : on === 'dest' ? to : from;\n    const el = setAttributes(createElement('g'), { transform: `translate(${x},${y})`, cgHash: hash });\n    el.innerHTML = `<svg width=\"1\" height=\"1\" viewBox=\"0 0 100 100\">${shape.customSvg.html}</svg>`;\n    svgs.push({ el, isCustom: true });\n  }\n  return svgs;\n}\n\nfunction renderCircle(\n  brush: DrawBrush,\n  at: cg.NumberPair,\n  current: boolean,\n  bounds: DOMRectReadOnly,\n  pendingErase: boolean,\n): SVGElement {\n  const widths = circleWidth(),\n    radius = (bounds.width + bounds.height) / (4 * Math.max(bounds.width, bounds.height));\n  return setAttributes(createElement('circle'), {\n    stroke: brush.color,\n    'stroke-width': widths[current ? 0 : 1],\n    fill: 'none',\n    opacity: opacity(brush, current, pendingErase),\n    cx: at[0],\n    cy: at[1],\n    r: radius - widths[1] / 2,\n  });\n}\n\nfunction renderArrow(\n  s: DrawShape,\n  brush: DrawBrush,\n  from: cg.NumberPair,\n  to: cg.NumberPair,\n  current: boolean,\n  shorten: boolean,\n  pendingErase: boolean,\n): SVGElement {\n  function renderLine(isHilite: boolean) {\n    const m = arrowMargin(shorten && !current),\n      dx = to[0] - from[0],\n      dy = to[1] - from[1],\n      angle = Math.atan2(dy, dx),\n      xo = Math.cos(angle) * m,\n      yo = Math.sin(angle) * m;\n    const hilite = hiliteOf(s);\n    return setAttributes(createElement('line'), {\n      stroke: isHilite ? hilite.color : brush.color,\n      'stroke-width': lineWidth(brush, current) * (isHilite ? 1.14 : 1),\n      'stroke-linecap': 'round',\n      'marker-end': `url(#arrowhead-${isHilite ? hilite.key : brush.key})`,\n      opacity: s.modifiers?.hilite && !pendingErase ? 1 : opacity(brush, current, pendingErase),\n      x1: from[0],\n      y1: from[1],\n      x2: to[0] - xo,\n      y2: to[1] - yo,\n    });\n  }\n  if (!s.modifiers?.hilite) return renderLine(false);\n\n  const g = setAttributes(createElement('g'), { opacity: brush.opacity });\n  const blurred = setAttributes(createElement('g'), { filter: 'url(#cg-filter-blur)' });\n  blurred.appendChild(filterBox(from, to));\n  blurred.appendChild(renderLine(true));\n  g.appendChild(blurred);\n  g.appendChild(renderLine(false));\n  return g;\n}\n\nfunction renderMarker(brush: DrawBrush): SVGElement {\n  const marker = setAttributes(createElement('marker'), {\n    id: 'arrowhead-' + brush.key,\n    orient: 'auto',\n    overflow: 'visible',\n    markerWidth: 4,\n    markerHeight: 4,\n    refX: brush.key.startsWith('hilite') ? 1.86 : 2.05,\n    refY: 2,\n  });\n  marker.appendChild(\n    setAttributes(createElement('path'), {\n      d: 'M0,0 V4 L3,2 Z',\n      fill: brush.color,\n    }),\n  );\n  marker.setAttribute('cgKey', brush.key);\n  return marker;\n}\n\nfunction renderLabel(\n  label: { text: string; fill?: string },\n  hash: string,\n  from: cg.NumberPair,\n  to: cg.NumberPair,\n  slots?: AngleSlots,\n  corner?: 'tr',\n): SVGElement {\n  const labelSize = 0.4,\n    fontSize = labelSize * 0.75 ** label.text.length,\n    at = labelCoords(from, to, slots),\n    cornerOff = corner === 'tr' ? 0.4 : 0,\n    g = setAttributes(createElement('g'), {\n      transform: `translate(${at[0] + cornerOff},${at[1] - cornerOff})`,\n      cgHash: hash,\n    });\n  g.appendChild(\n    setAttributes(createElement('circle'), {\n      r: labelSize / 2,\n      'fill-opacity': corner ? 1.0 : 0.8,\n      'stroke-opacity': corner ? 1.0 : 0.7,\n      'stroke-width': 0.03,\n      fill: label.fill ?? '#666',\n      stroke: 'white',\n    }),\n  );\n  const labelEl = setAttributes(createElement('text'), {\n    'font-size': fontSize,\n    'font-family': 'Noto Sans',\n    'text-anchor': 'middle',\n    fill: 'white',\n    y: 0.13 * 0.75 ** label.text.length,\n  });\n  labelEl.innerHTML = label.text;\n  g.appendChild(labelEl);\n  return g;\n}\n\nconst orient = (pos: cg.Pos, color: cg.Color): cg.Pos => (color === 'white' ? pos : [7 - pos[0], 7 - pos[1]]);\n\nconst mod = (n: number, m: number): number => ((n % m) + m) % m;\n\nconst rotateAngleSlot = (slot: AngleSlot, steps: number): AngleSlot => mod(slot + steps, 16) as AngleSlot;\n\nconst anyTwoCloserThan90Degrees = (slots: AngleSlots): boolean =>\n  [...slots].some(slot => [-3, -2, -1, 1, 2, 3].some(i => slots.has(rotateAngleSlot(slot, i))));\n\nconst isShort = (dest: cg.Key | undefined, dests: ArrowDests): boolean =>\n  !!dest && dests.has(dest) && anyTwoCloserThan90Degrees(dests.get(dest)!);\n\nconst createElement = (tagName: string): SVGElement =>\n  document.createElementNS('http://www.w3.org/2000/svg', tagName);\n\nconst angleCount = (dest: cg.Key | undefined, dests: ArrowDests): number =>\n  dest && dests.has(dest) ? dests.get(dest)!.size : 0;\n\nfunction setAttributes(el: SVGElement, attrs: { [key: string]: any }): SVGElement {\n  for (const key in attrs) {\n    if (Object.prototype.hasOwnProperty.call(attrs, key)) el.setAttribute(key, attrs[key]);\n  }\n  return el;\n}\n\nconst makeCustomBrush = (base: DrawBrush, modifiers: DrawModifiers | undefined): DrawBrush =>\n  !modifiers\n    ? base\n    : {\n        color: base.color,\n        opacity: Math.round(base.opacity * 10) / 10,\n        lineWidth: Math.round(modifiers.lineWidth || base.lineWidth),\n        key: [base.key, modifiers.lineWidth].filter(x => x).join(''),\n      };\n\nconst circleWidth = (): [number, number] => [3 / 64, 4 / 64];\n\nconst lineWidth = (brush: DrawBrush, current: boolean): number =>\n  ((brush.lineWidth || 10) * (current ? 0.85 : 1)) / 64;\n\nfunction hiliteOf(shape: DrawShape): { key?: string; color?: string } {\n  const hilite = shape.modifiers?.hilite;\n  return { key: hilite && `hilite-${hilite.replace('#', '')}`, color: hilite };\n}\n\nconst opacity = (brush: DrawBrush, current: boolean, pendingErase: boolean): number =>\n  (brush.opacity || 1) * (pendingErase ? 0.6 : current ? 0.9 : 1);\n\nconst arrowMargin = (shorten: boolean): number => (shorten ? 20 : 10) / 64;\n\nfunction pos2user(pos: cg.Pos, bounds: DOMRectReadOnly): cg.NumberPair {\n  const xScale = Math.min(1, bounds.width / bounds.height);\n  const yScale = Math.min(1, bounds.height / bounds.width);\n  return [(pos[0] - 3.5) * xScale, (3.5 - pos[1]) * yScale];\n}\n\nfunction filterBox(from: cg.NumberPair, to: cg.NumberPair): SVGElement {\n  // lines/arrows are considered to be one dimensional for the purposes of SVG filters,\n  // so we add a transparent bounding box to ensure they apply to the 2nd dimension\n  const box = {\n    from: [Math.floor(Math.min(from[0], to[0])), Math.floor(Math.min(from[1], to[1]))],\n    to: [Math.ceil(Math.max(from[0], to[0])), Math.ceil(Math.max(from[1], to[1]))],\n  };\n  return setAttributes(createElement('rect'), {\n    x: box.from[0],\n    y: box.from[1],\n    width: box.to[0] - box.from[0],\n    height: box.to[1] - box.from[1],\n    fill: 'none',\n    stroke: 'none',\n  });\n}\n\nconst angleToSlot = (angle: number): AngleSlot => mod(Math.round((angle * 8) / Math.PI), 16) as AngleSlot;\n\nconst moveAngle = (from: cg.NumberPair, to: cg.NumberPair): number =>\n  Math.atan2(to[1] - from[1], to[0] - from[0]) + Math.PI;\n\nconst dist = (from: cg.NumberPair, to: cg.NumberPair): number =>\n  Math.sqrt([from[0] - to[0], from[1] - to[1]].reduce((acc, x) => acc + x * x, 0));\n\n/*\n try to place label at the junction of the destination shaft and arrowhead. if there's more than\n 1 arrow pointing to a square, the arrow shortens by 10 / 64 units so the label must move as well. \n \n if the angle between two incoming arrows is pi / 8, such as when an adjacent knight and bishop\n attack the same square, the knight's label is slid further down the shaft by an amount equal to\n our label size to avoid collision\n*/\n\nfunction labelCoords(from: cg.NumberPair, to: cg.NumberPair, slots?: AngleSlots): cg.NumberPair {\n  let mag = dist(from, to);\n  //if (mag === 0) return [from[0], from[1]];\n  const angle = moveAngle(from, to);\n  if (slots) {\n    mag -= 33 / 64; // reduce by arrowhead length\n    if (anyTwoCloserThan90Degrees(slots)) {\n      mag -= 10 / 64; // reduce by shortening factor\n      const slot = angleToSlot(angle);\n      // reduce by label size for the knight if another arrow is within pi / 8:\n      if (slot & 1 && [-1, 1].some(s => slots.has(rotateAngleSlot(slot, s)))) mag -= 0.4;\n    }\n  }\n  return [from[0] - Math.cos(angle) * mag, from[1] - Math.sin(angle) * mag].map(\n    c => c + 0.5,\n  ) as cg.NumberPair;\n}\n", "import { HeadlessState } from './state.js';\nimport { setVisible, createEl, opposite } from './util.js';\nimport { colors, files, ranks, Elements, Color } from './types.js';\nimport { createElement as createSVG, setAttributes, createDefs } from './svg.js';\n\nexport function renderWrap(element: HTMLElement, s: HeadlessState): Elements {\n  // .cg-wrap (element passed to Chessground)\n  //   cg-container\n  //     cg-board\n  //     svg.cg-shapes\n  //       defs\n  //       g\n  //     svg.cg-custom-svgs\n  //       g\n  //     cg-auto-pieces\n  //     coords.ranks\n  //     coords.files\n  //     piece.ghost\n\n  element.innerHTML = '';\n\n  // ensure the cg-wrap class is set\n  // so bounds calculation can use the CSS width/height values\n  // add that class yourself to the element before calling chessground\n  // for a slight performance improvement! (avoids recomputing style)\n  element.classList.add('cg-wrap');\n\n  for (const c of colors) element.classList.toggle('orientation-' + c, s.orientation === c);\n  element.classList.toggle('manipulable', !s.viewOnly);\n\n  const container = createEl('cg-container');\n  element.appendChild(container);\n\n  const board = createEl('cg-board');\n  container.appendChild(board);\n\n  let shapesBelow: SVGElement | undefined;\n  let shapes: SVGElement | undefined;\n  let customBelow: SVGElement | undefined;\n  let custom: SVGElement | undefined;\n  let autoPieces: HTMLElement | undefined;\n\n  if (s.drawable.visible) {\n    [shapesBelow, shapes] = ['cg-shapes-below', 'cg-shapes'].map(cls => svgContainer(cls, true));\n    [customBelow, custom] = ['cg-custom-below', 'cg-custom-svgs'].map(cls => svgContainer(cls, false));\n\n    autoPieces = createEl('cg-auto-pieces');\n\n    container.appendChild(shapesBelow);\n    container.appendChild(customBelow);\n    container.appendChild(shapes);\n    container.appendChild(custom);\n    container.appendChild(autoPieces);\n  }\n\n  if (s.coordinates) {\n    const orientClass = s.orientation === 'black' ? ' black' : '';\n    const ranksPositionClass = s.ranksPosition === 'left' ? ' left' : '';\n\n    if (s.coordinatesOnSquares) {\n      const rankN: (i: number) => number = s.orientation === 'white' ? i => i + 1 : i => 8 - i;\n      files.forEach((f, i) =>\n        container.appendChild(\n          renderCoords(\n            ranks.map(r => f + r),\n            'squares rank' + rankN(i) + orientClass + ranksPositionClass,\n            i % 2 === 0 ? 'black' : 'white',\n          ),\n        ),\n      );\n    } else {\n      container.appendChild(\n        renderCoords(\n          ranks,\n          'ranks' + orientClass + ranksPositionClass,\n          (s.ranksPosition === 'right') === (s.orientation === 'white') ? 'white' : 'black',\n        ),\n      );\n      container.appendChild(renderCoords(files, 'files' + orientClass, opposite(s.orientation)));\n    }\n  }\n\n  let ghost: HTMLElement | undefined;\n  if (!s.viewOnly && s.draggable.enabled && s.draggable.showGhost) {\n    ghost = createEl('piece', 'ghost');\n    setVisible(ghost, false);\n    container.appendChild(ghost);\n  }\n\n  return { board, container, wrap: element, ghost, shapes, shapesBelow, custom, customBelow, autoPieces };\n}\n\nfunction svgContainer(cls: string, isShapes: boolean) {\n  const svg = setAttributes(createSVG('svg'), {\n    class: cls,\n    viewBox: isShapes ? '-4 -4 8 8' : '-3.5 -3.5 8 8',\n    preserveAspectRatio: 'xMidYMid slice',\n  });\n  if (isShapes) svg.appendChild(createDefs());\n  svg.appendChild(createSVG('g'));\n  return svg;\n}\n\nfunction renderCoords(elems: readonly string[], className: string, firstColor: Color): HTMLElement {\n  const el = createEl('coords', className);\n  let f: HTMLElement;\n  elems.forEach((elem, i) => {\n    const light = i % 2 === (firstColor === 'white' ? 0 : 1);\n    f = createEl('coord', `coord-${light ? 'light' : 'dark'}`);\n    f.textContent = elem;\n    el.appendChild(f);\n  });\n  return el;\n}\n", "import { State } from './state.js';\nimport * as cg from './types.js';\nimport * as board from './board.js';\nimport * as util from './util.js';\nimport { cancel as dragCancel } from './drag.js';\n\nexport function setDropMode(s: State, piece?: cg.Piece): void {\n  s.dropmode = {\n    active: true,\n    piece,\n  };\n  dragCancel(s);\n}\n\nexport function cancelDropMode(s: State): void {\n  s.dropmode = {\n    active: false,\n  };\n}\n\nexport function drop(s: State, e: cg.MouchEvent): void {\n  if (!s.dropmode.active) return;\n\n  board.unsetPremove(s);\n  board.unsetPredrop(s);\n\n  const piece = s.dropmode.piece;\n\n  if (piece) {\n    s.pieces.set('a0', piece);\n    const position = util.eventPosition(e);\n    const dest = position && board.getKeyAtDomPos(position, board.whitePov(s), s.dom.bounds());\n    if (dest) board.dropNewPiece(s, 'a0', dest);\n  }\n  s.dom.redraw();\n}\n", "import { State } from './state.js';\nimport * as drag from './drag.js';\nimport * as draw from './draw.js';\nimport { drop } from './drop.js';\nimport { isRightButton } from './util.js';\nimport * as cg from './types.js';\n\ntype MouchBind = (e: cg.MouchEvent) => void;\ntype StateMouchBind = (d: State, e: cg.MouchEvent) => void;\n\nexport function bindBoard(s: State, onResize: () => void): void {\n  const boardEl = s.dom.elements.board;\n\n  if ('ResizeObserver' in window) new ResizeObserver(onResize).observe(s.dom.elements.wrap);\n\n  if (s.disableContextMenu || s.drawable.enabled) {\n    boardEl.addEventListener('contextmenu', e => e.preventDefault());\n  }\n\n  if (s.viewOnly) return;\n\n  // Cannot be passive, because we prevent touch scrolling and dragging of\n  // selected elements.\n  const onStart = startDragOrDraw(s);\n  boardEl.addEventListener('touchstart', onStart as EventListener, {\n    passive: false,\n  });\n  boardEl.addEventListener('mousedown', onStart as EventListener, {\n    passive: false,\n  });\n}\n\n// returns the unbind function\nexport function bindDocument(s: State, onResize: () => void): cg.Unbind {\n  const unbinds: cg.Unbind[] = [];\n\n  // Old versions of Edge and Safari do not support ResizeObserver. Send\n  // chessground.resize if a user action has changed the bounds of the board.\n  if (!('ResizeObserver' in window)) unbinds.push(unbindable(document.body, 'chessground.resize', onResize));\n\n  if (!s.viewOnly) {\n    const onmove = dragOrDraw(s, drag.move, draw.move);\n    const onend = dragOrDraw(s, drag.end, draw.end);\n\n    for (const ev of ['touchmove', 'mousemove'])\n      unbinds.push(unbindable(document, ev, onmove as EventListener));\n    for (const ev of ['touchend', 'mouseup']) unbinds.push(unbindable(document, ev, onend as EventListener));\n\n    const onScroll = () => s.dom.bounds.clear();\n    unbinds.push(unbindable(document, 'scroll', onScroll, { capture: true, passive: true }));\n    unbinds.push(unbindable(window, 'resize', onScroll, { passive: true }));\n  }\n\n  return () => unbinds.forEach(f => f());\n}\n\nfunction unbindable(\n  el: EventTarget,\n  eventName: string,\n  callback: EventListener,\n  options?: AddEventListenerOptions,\n): cg.Unbind {\n  el.addEventListener(eventName, callback, options);\n  return () => el.removeEventListener(eventName, callback, options);\n}\n\nconst startDragOrDraw =\n  (s: State): MouchBind =>\n  e => {\n    if (s.draggable.current) drag.cancel(s);\n    else if (s.drawable.current) draw.cancel(s);\n    else if (e.shiftKey || isRightButton(e)) {\n      if (s.drawable.enabled) draw.start(s, e);\n    } else if (!s.viewOnly) {\n      if (s.dropmode.active) drop(s, e);\n      else drag.start(s, e);\n    }\n  };\n\nconst dragOrDraw =\n  (s: State, withDrag: StateMouchBind, withDraw: StateMouchBind): MouchBind =>\n  e => {\n    if (s.drawable.current) {\n      if (s.drawable.enabled) withDraw(s, e);\n    } else if (!s.viewOnly) withDrag(s, e);\n  };\n", "import { State } from './state.js';\nimport {\n  key2pos,\n  createEl,\n  posToTranslate as posToTranslateFromBounds,\n  translate,\n  setVisible,\n} from './util.js';\nimport * as util from './util.js';\nimport { whitePov } from './board.js';\nimport { AnimCurrent, AnimVectors, AnimVector, AnimFadings } from './anim.js';\nimport { DragCurrent } from './drag.js';\nimport * as cg from './types.js';\n\ntype PieceName = string; // `$color $role`\n\n// ported from https://github.com/lichess-org/lichobile/blob/master/src/chessground/render.ts\n// in case of bugs, blame @veloce\nexport function render(s: State): void {\n  const asWhite: boolean = whitePov(s),\n    posToTranslate = posToTranslateFromBounds(s.dom.bounds()),\n    boardEl: HTMLElement = s.dom.elements.board,\n    pieces: cg.Pieces = s.pieces,\n    curAnim: AnimCurrent | undefined = s.animation.current,\n    anims: AnimVectors = curAnim ? curAnim.plan.anims : new Map(),\n    fadings: AnimFadings = curAnim ? curAnim.plan.fadings : new Map(),\n    curDrag: DragCurrent | undefined = s.draggable.current,\n    samePieces: Set<cg.Key> = new Set(),\n    movedPieces: Map<PieceName, cg.PieceNode[]> = new Map(),\n    desiredSquares: cg.SquareClasses = computeSquareClasses(s),\n    availableSquares: Map<string, cg.SquareNode[]> = new Map(); // by class name\n  let k: cg.Key,\n    el: cg.PieceNode | cg.SquareNode | undefined,\n    pieceAtKey: cg.Piece | undefined,\n    elPieceName: PieceName,\n    anim: AnimVector | undefined,\n    fading: cg.Piece | undefined,\n    pMvdset: cg.PieceNode[] | undefined,\n    pMvd: cg.PieceNode | undefined,\n    sAvail: cg.SquareNode | undefined;\n\n  // walk over all board dom elements, apply animations and flag moved pieces\n  el = boardEl.firstChild as cg.PieceNode | cg.SquareNode | undefined;\n  while (el) {\n    k = el.cgKey;\n    if (isPieceNode(el)) {\n      pieceAtKey = pieces.get(k);\n      anim = anims.get(k);\n      fading = fadings.get(k);\n      elPieceName = el.cgPiece;\n      // if piece not being dragged anymore, remove dragging style\n      if (el.cgDragging && (!curDrag || curDrag.orig !== k)) {\n        el.classList.remove('dragging');\n        translate(el, posToTranslate(key2pos(k), asWhite));\n        el.cgDragging = false;\n      }\n      // remove fading class if it still remains\n      if (!fading && el.cgFading) {\n        el.cgFading = false;\n        el.classList.remove('fading');\n      }\n      // there is now a piece at this dom key\n      if (pieceAtKey) {\n        // continue animation if already animating and same piece\n        // (otherwise it could animate a captured piece)\n        if (anim && el.cgAnimating && elPieceName === pieceNameOf(pieceAtKey)) {\n          const pos = key2pos(k);\n          pos[0] += anim[2];\n          pos[1] += anim[3];\n          el.classList.add('anim');\n          translate(el, posToTranslate(pos, asWhite));\n        } else if (el.cgAnimating) {\n          el.cgAnimating = false;\n          el.classList.remove('anim');\n          translate(el, posToTranslate(key2pos(k), asWhite));\n          if (s.addPieceZIndex) el.style.zIndex = posZIndex(key2pos(k), asWhite);\n        }\n        // same piece: flag as same\n        if (elPieceName === pieceNameOf(pieceAtKey) && (!fading || !el.cgFading)) samePieces.add(k);\n        // different piece: flag as moved unless it is a fading piece\n        else if (fading && elPieceName === pieceNameOf(fading)) {\n          el.classList.add('fading');\n          el.cgFading = true;\n        } else appendValue(movedPieces, elPieceName, el);\n      }\n      // no piece: flag as moved\n      else appendValue(movedPieces, elPieceName, el);\n    } else if (isSquareNode(el)) {\n      const cls = el.className;\n      if (desiredSquares.get(k) === cls) {\n        setVisible(el, true);\n        desiredSquares.delete(k);\n      } else appendValue(availableSquares, cls, el);\n    }\n    el = el.nextSibling as cg.PieceNode | cg.SquareNode | undefined;\n  }\n\n  // walk over all squares in current set, apply dom changes to moved squares\n  // or append new squares\n  for (const [sk, className] of desiredSquares) {\n    sAvail = availableSquares.get(className)?.pop();\n    const translation = posToTranslate(key2pos(sk), asWhite);\n    if (sAvail) {\n      // repurpose an available square\n      sAvail.cgKey = sk;\n      translate(sAvail, translation);\n      setVisible(sAvail, true);\n    } else {\n      const squareNode = createEl('square', className) as cg.SquareNode;\n      squareNode.cgKey = sk;\n      translate(squareNode, translation);\n      boardEl.insertBefore(squareNode, boardEl.firstChild);\n    }\n  }\n\n  // hide remaining available, therefore unused, squares\n  for (const [_, nodes] of availableSquares.entries()) {\n    for (const node of nodes) setVisible(node, false);\n  }\n\n  // walk over all pieces in current set, apply dom changes to moved pieces\n  // or append new pieces\n  for (const [k, p] of pieces) {\n    anim = anims.get(k);\n    if (!samePieces.has(k)) {\n      pMvdset = movedPieces.get(pieceNameOf(p));\n      pMvd = pMvdset && pMvdset.pop();\n      // a same piece was moved\n      if (pMvd) {\n        // apply dom changes\n        pMvd.cgKey = k;\n        if (pMvd.cgFading) {\n          pMvd.classList.remove('fading');\n          pMvd.cgFading = false;\n        }\n        const pos = key2pos(k);\n        if (s.addPieceZIndex) pMvd.style.zIndex = posZIndex(pos, asWhite);\n        if (anim) {\n          pMvd.cgAnimating = true;\n          pMvd.classList.add('anim');\n          pos[0] += anim[2];\n          pos[1] += anim[3];\n        }\n        translate(pMvd, posToTranslate(pos, asWhite));\n      }\n      // no piece in moved obj: insert the new piece\n      // assumes the new piece is not being dragged\n      else {\n        const pieceName = pieceNameOf(p),\n          pieceNode = createEl('piece', pieceName) as cg.PieceNode,\n          pos = key2pos(k);\n\n        pieceNode.cgPiece = pieceName;\n        pieceNode.cgKey = k;\n        if (anim) {\n          pieceNode.cgAnimating = true;\n          pos[0] += anim[2];\n          pos[1] += anim[3];\n        }\n        translate(pieceNode, posToTranslate(pos, asWhite));\n\n        if (s.addPieceZIndex) pieceNode.style.zIndex = posZIndex(pos, asWhite);\n\n        boardEl.appendChild(pieceNode);\n      }\n    }\n  }\n\n  // remove any piece that remains in the moved sets\n  for (const nodes of movedPieces.values()) removeNodes(s, nodes);\n}\n\nexport function renderResized(s: State): void {\n  const asWhite: boolean = whitePov(s),\n    posToTranslate = posToTranslateFromBounds(s.dom.bounds());\n  let el = s.dom.elements.board.firstChild as cg.PieceNode | cg.SquareNode | undefined;\n  while (el) {\n    if ((isPieceNode(el) && !el.cgAnimating) || isSquareNode(el)) {\n      translate(el, posToTranslate(key2pos(el.cgKey), asWhite));\n    }\n    el = el.nextSibling as cg.PieceNode | cg.SquareNode | undefined;\n  }\n}\n\nexport function updateBounds(s: State): void {\n  const bounds = s.dom.elements.wrap.getBoundingClientRect();\n  const container = s.dom.elements.container;\n  const ratio = bounds.height / bounds.width;\n  const width = (Math.floor((bounds.width * window.devicePixelRatio) / 8) * 8) / window.devicePixelRatio;\n  const height = width * ratio;\n  container.style.width = width + 'px';\n  container.style.height = height + 'px';\n  s.dom.bounds.clear();\n\n  s.addDimensionsCssVarsTo?.style.setProperty('---cg-width', width + 'px');\n  s.addDimensionsCssVarsTo?.style.setProperty('---cg-height', height + 'px');\n}\n\nconst isPieceNode = (el: cg.PieceNode | cg.SquareNode): el is cg.PieceNode => el.tagName === 'PIECE';\nconst isSquareNode = (el: cg.PieceNode | cg.SquareNode): el is cg.SquareNode => el.tagName === 'SQUARE';\n\nfunction removeNodes(s: State, nodes: HTMLElement[]): void {\n  for (const node of nodes) s.dom.elements.board.removeChild(node);\n}\n\nfunction posZIndex(pos: cg.Pos, asWhite: boolean): string {\n  const minZ = 3;\n  const rank = pos[1];\n  const z = asWhite ? minZ + 7 - rank : minZ + rank;\n  return `${z}`;\n}\n\nconst pieceNameOf = (piece: cg.Piece): string => `${piece.color} ${piece.role}`;\n\nconst normalizeLastMoveStandardRookCastle = (s: State, k: cg.Key): cg.Key =>\n  !!s.lastMove?.[1] &&\n  !s.pieces.has(s.lastMove[1]) &&\n  s.lastMove[0][0] === 'e' &&\n  ['h', 'a'].includes(s.lastMove[1][0]) &&\n  s.lastMove[0][1] === s.lastMove[1][1] &&\n  util.squaresBetween(...key2pos(s.lastMove[0]), ...key2pos(s.lastMove[1])).some(sq => s.pieces.has(sq))\n    ? (((k > s.lastMove[0] ? 'g' : 'c') + k[1]) as cg.Key)\n    : k;\n\nfunction computeSquareClasses(s: State): cg.SquareClasses {\n  const squares: cg.SquareClasses = new Map();\n  if (s.lastMove && s.highlight.lastMove)\n    for (const [i, k] of s.lastMove.entries())\n      addSquare(squares, i === 1 ? normalizeLastMoveStandardRookCastle(s, k) : k, 'last-move');\n  if (s.check && s.highlight.check) addSquare(squares, s.check, 'check');\n  if (s.selected) {\n    addSquare(squares, s.selected, 'selected');\n    if (s.movable.showDests) {\n      for (const k of s.movable.dests?.get(s.selected) ?? [])\n        addSquare(squares, k, 'move-dest' + (s.pieces.has(k) ? ' oc' : ''));\n      for (const k of s.premovable.customDests?.get(s.selected) ?? s.premovable.dests ?? [])\n        addSquare(squares, k, 'premove-dest' + (s.pieces.has(k) ? ' oc' : ''));\n    }\n  }\n  const premove = s.premovable.current;\n  if (premove) for (const k of premove) addSquare(squares, k, 'current-premove');\n  else if (s.predroppable.current) addSquare(squares, s.predroppable.current.key, 'current-premove');\n\n  const o = s.exploding;\n  if (o) for (const k of o.keys) addSquare(squares, k, 'exploding' + o.stage);\n\n  if (s.highlight.custom) {\n    s.highlight.custom.forEach((v: string, k: cg.Key) => {\n      addSquare(squares, k, v);\n    });\n  }\n\n  return squares;\n}\n\nfunction addSquare(squares: cg.SquareClasses, key: cg.Key, klass: string): void {\n  const classes = squares.get(key);\n  if (classes) squares.set(key, `${classes} ${klass}`);\n  else squares.set(key, klass);\n}\n\nfunction appendValue<K, V>(map: Map<K, V[]>, key: K, value: V): void {\n  const arr = map.get(key);\n  if (arr) arr.push(value);\n  else map.set(key, [value]);\n}\n", "import { DrawShape } from './draw';\n\nexport interface SyncableShape {\n  shape: DrawShape;\n  current: boolean;\n  pendingErase: boolean;\n  hash: Hash;\n}\n\nexport type Hash = string;\n\n// append and remove only. No updates.\nexport function syncShapes(\n  shapes: SyncableShape[],\n  root: HTMLElement | SVGElement,\n  renderShape: (shape: SyncableShape) => HTMLElement | SVGElement,\n): void {\n  const hashesInDom = new Map(), // by hash\n    toRemove: SVGElement[] = [];\n  for (const sc of shapes) hashesInDom.set(sc.hash, false);\n  let el: SVGElement | undefined = root.firstElementChild as SVGElement,\n    elHash: Hash | null;\n  while (el) {\n    elHash = el.getAttribute('cgHash') as Hash;\n    // found a shape element that's here to stay\n    if (hashesInDom.has(elHash)) hashesInDom.set(elHash, true);\n    // or remove it\n    else toRemove.push(el);\n    el = el.nextElementSibling as SVGElement | undefined;\n  }\n  // remove old shapes\n  for (const el of toRemove) root.removeChild(el);\n  // insert shapes that are not yet in dom\n  for (const sc of shapes) {\n    if (!hashesInDom.get(sc.hash)) root.appendChild(renderShape(sc));\n  }\n}\n", "import { State } from './state.js';\nimport { key2pos, createEl, posToTranslate as posToTranslateFromBounds, translateAndScale } from './util.js';\nimport { whitePov } from './board.js';\nimport * as cg from './types.js';\nimport { DrawShape } from './draw.js';\nimport { SyncableShape, Hash, syncShapes } from './sync.js';\n\nexport function render(state: State, autoPieceEl: HTMLElement): void {\n  const autoPieces = state.drawable.autoShapes.filter(autoShape => autoShape.piece);\n  const autoPieceShapes: SyncableShape[] = autoPieces.map((s: DrawShape) => {\n    return {\n      shape: s,\n      hash: hash(s),\n      current: false,\n      pendingErase: false,\n    };\n  });\n\n  syncShapes(autoPieceShapes, autoPieceEl, shape => renderShape(state, shape, state.dom.bounds()));\n}\n\nexport function renderResized(state: State): void {\n  const asWhite: boolean = whitePov(state),\n    posToTranslate = posToTranslateFromBounds(state.dom.bounds());\n  let el = state.dom.elements.autoPieces?.firstChild as cg.PieceNode | undefined;\n  while (el) {\n    translateAndScale(el, posToTranslate(key2pos(el.cgKey), asWhite), el.cgScale);\n    el = el.nextSibling as cg.PieceNode | undefined;\n  }\n}\n\nfunction renderShape(state: State, { shape, hash }: SyncableShape, bounds: DOMRectReadOnly): cg.PieceNode {\n  const orig = shape.orig;\n  const role = shape.piece?.role;\n  const color = shape.piece?.color;\n  const scale = shape.piece?.scale;\n\n  const pieceEl = createEl('piece', `${role} ${color}`) as cg.PieceNode;\n  pieceEl.setAttribute('cgHash', hash);\n  pieceEl.cgKey = orig;\n  pieceEl.cgScale = scale;\n  translateAndScale(pieceEl, posToTranslateFromBounds(bounds)(key2pos(orig), whitePov(state)), scale);\n\n  return pieceEl;\n}\n\nconst hash = (autoPiece: DrawShape): Hash =>\n  [autoPiece.orig, autoPiece.piece?.role, autoPiece.piece?.color, autoPiece.piece?.scale].join(',');\n", "import { Api, start } from './api.js';\nimport { Config, configure } from './config.js';\nimport { HeadlessState, State, defaults } from './state.js';\n\nimport { renderWrap } from './wrap.js';\nimport * as events from './events.js';\nimport { render, renderResized, updateBounds } from './render.js';\nimport * as autoPieces from './autoPieces.js';\nimport * as svg from './svg.js';\nimport * as util from './util.js';\n\nexport function initModule({ el, config }: { el: HTMLElement; config?: Config }): Api {\n  return Chessground(el, config);\n}\n\nexport function Chessground(element: HTMLElement, config?: Config): Api {\n  const maybeState: State | HeadlessState = defaults();\n\n  configure(maybeState, config || {});\n\n  function redrawAll(): State {\n    const prevUnbind = 'dom' in maybeState ? maybeState.dom.unbind : undefined;\n    // compute bounds from existing board element if possible\n    // this allows non-square boards from CSS to be handled (for 3D)\n    const elements = renderWrap(element, maybeState),\n      bounds = util.memo(() => elements.board.getBoundingClientRect()),\n      redrawNow = (skipSvg?: boolean): void => {\n        render(state);\n        if (elements.autoPieces) autoPieces.render(state, elements.autoPieces);\n        if (!skipSvg && elements.shapes) svg.renderSvg(state, elements);\n      },\n      onResize = (): void => {\n        updateBounds(state);\n        renderResized(state);\n        if (elements.autoPieces) autoPieces.renderResized(state);\n      };\n    const state = maybeState as State;\n    state.dom = {\n      elements,\n      bounds,\n      redraw: debounceRedraw(redrawNow),\n      redrawNow,\n      unbind: prevUnbind,\n    };\n    state.drawable.prevSvgHash = '';\n    updateBounds(state);\n    redrawNow(false);\n    events.bindBoard(state, onResize);\n    if (!prevUnbind) state.dom.unbind = events.bindDocument(state, onResize);\n    state.events.insert && state.events.insert(elements);\n    return state;\n  }\n\n  return start(redrawAll(), redrawAll);\n}\n\nfunction debounceRedraw(redrawNow: (skipSvg?: boolean) => void): () => void {\n  let redrawing = false;\n  return () => {\n    if (redrawing) return;\n    redrawing = true;\n    requestAnimationFrame(() => {\n      redrawNow();\n      redrawing = false;\n    });\n  };\n}\n", "import { Chessground } from '@lichess-org/chessground';\nimport type { Api } from '@lichess-org/chessground/api';\n\nexport function mountBoard(\n  el: HTMLElement,\n  fen: string,\n  orientation: 'white' | 'black' = 'white',\n): Api {\n  return Chessground(el, {\n    fen,\n    orientation,\n    movable:    { free: false, color: undefined },\n    draggable:  { enabled: false },\n    selectable: { enabled: false },\n    animation:  { enabled: false },\n    coordinates: true,\n    drawable:   { enabled: true, visible: true },\n  });\n}\n", "// @generated by Peggy 4.2.0.\n//\n// https://peggyjs.org/\n\n\n\n  function rootNode(comment) {\n  \treturn comment !== null ? { comment, variations: [] } : { variations: []}\n  }\n\n  function node(move, suffix, nag, comment, variations) {\n  \tconst node = { move, variations }\n\n    if (suffix) {\n    \tnode.suffix = suffix\n    }\n\n    if (nag) {\n    \tnode.nag = nag\n    }\n\n    if (comment !== null) {\n    \tnode.comment = comment\n    }\n\n    return node\n  }\n\n  function lineToTree(...nodes) {\n  \tconst [root, ...rest] = nodes;\n\n    let parent = root\n\n    for (const child of rest) {\n    \tif (child !== null) {\n        \tparent.variations = [child, ...child.variations]\n            child.variations = []\n            parent = child\n        }\n    }\n\n  \treturn root\n  }\n\n  function pgn(headers, game) {\n  \tif (game.marker && game.marker.comment) {\n    \tlet node = game.root\n        while (true) {\n        \tconst next = node.variations[0]\n            if (!next) {\n            \tnode.comment = game.marker.comment\n            \tbreak\n            }\n            node = next\n        }\n    }\n\n  \treturn {\n    \theaders,\n        root: game.root,\n        result: (game.marker && game.marker.result) ?? undefined\n    }\n  }\n\nfunction peg$subclass(child, parent) {\n  function C() { this.constructor = child; }\n  C.prototype = parent.prototype;\n  child.prototype = new C();\n}\n\nfunction peg$SyntaxError(message, expected, found, location) {\n  var self = Error.call(this, message);\n  // istanbul ignore next Check is a necessary evil to support older environments\n  if (Object.setPrototypeOf) {\n    Object.setPrototypeOf(self, peg$SyntaxError.prototype);\n  }\n  self.expected = expected;\n  self.found = found;\n  self.location = location;\n  self.name = \"SyntaxError\";\n  return self;\n}\n\npeg$subclass(peg$SyntaxError, Error);\n\nfunction peg$padEnd(str, targetLength, padString) {\n  padString = padString || \" \";\n  if (str.length > targetLength) { return str; }\n  targetLength -= str.length;\n  padString += padString.repeat(targetLength);\n  return str + padString.slice(0, targetLength);\n}\n\npeg$SyntaxError.prototype.format = function(sources) {\n  var str = \"Error: \" + this.message;\n  if (this.location) {\n    var src = null;\n    var k;\n    for (k = 0; k < sources.length; k++) {\n      if (sources[k].source === this.location.source) {\n        src = sources[k].text.split(/\\r\\n|\\n|\\r/g);\n        break;\n      }\n    }\n    var s = this.location.start;\n    var offset_s = (this.location.source && (typeof this.location.source.offset === \"function\"))\n      ? this.location.source.offset(s)\n      : s;\n    var loc = this.location.source + \":\" + offset_s.line + \":\" + offset_s.column;\n    if (src) {\n      var e = this.location.end;\n      var filler = peg$padEnd(\"\", offset_s.line.toString().length, ' ');\n      var line = src[s.line - 1];\n      var last = s.line === e.line ? e.column : line.length + 1;\n      var hatLen = (last - s.column) || 1;\n      str += \"\\n --> \" + loc + \"\\n\"\n          + filler + \" |\\n\"\n          + offset_s.line + \" | \" + line + \"\\n\"\n          + filler + \" | \" + peg$padEnd(\"\", s.column - 1, ' ')\n          + peg$padEnd(\"\", hatLen, \"^\");\n    } else {\n      str += \"\\n at \" + loc;\n    }\n  }\n  return str;\n};\n\npeg$SyntaxError.buildMessage = function(expected, found) {\n  var DESCRIBE_EXPECTATION_FNS = {\n    literal: function(expectation) {\n      return \"\\\"\" + literalEscape(expectation.text) + \"\\\"\";\n    },\n\n    class: function(expectation) {\n      var escapedParts = expectation.parts.map(function(part) {\n        return Array.isArray(part)\n          ? classEscape(part[0]) + \"-\" + classEscape(part[1])\n          : classEscape(part);\n      });\n\n      return \"[\" + (expectation.inverted ? \"^\" : \"\") + escapedParts.join(\"\") + \"]\";\n    },\n\n    any: function() {\n      return \"any character\";\n    },\n\n    end: function() {\n      return \"end of input\";\n    },\n\n    other: function(expectation) {\n      return expectation.description;\n    }\n  };\n\n  function hex(ch) {\n    return ch.charCodeAt(0).toString(16).toUpperCase();\n  }\n\n  function literalEscape(s) {\n    return s\n      .replace(/\\\\/g, \"\\\\\\\\\")\n      .replace(/\"/g,  \"\\\\\\\"\")\n      .replace(/\\0/g, \"\\\\0\")\n      .replace(/\\t/g, \"\\\\t\")\n      .replace(/\\n/g, \"\\\\n\")\n      .replace(/\\r/g, \"\\\\r\")\n      .replace(/[\\x00-\\x0F]/g,          function(ch) { return \"\\\\x0\" + hex(ch); })\n      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return \"\\\\x\"  + hex(ch); });\n  }\n\n  function classEscape(s) {\n    return s\n      .replace(/\\\\/g, \"\\\\\\\\\")\n      .replace(/\\]/g, \"\\\\]\")\n      .replace(/\\^/g, \"\\\\^\")\n      .replace(/-/g,  \"\\\\-\")\n      .replace(/\\0/g, \"\\\\0\")\n      .replace(/\\t/g, \"\\\\t\")\n      .replace(/\\n/g, \"\\\\n\")\n      .replace(/\\r/g, \"\\\\r\")\n      .replace(/[\\x00-\\x0F]/g,          function(ch) { return \"\\\\x0\" + hex(ch); })\n      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return \"\\\\x\"  + hex(ch); });\n  }\n\n  function describeExpectation(expectation) {\n    return DESCRIBE_EXPECTATION_FNS[expectation.type](expectation);\n  }\n\n  function describeExpected(expected) {\n    var descriptions = expected.map(describeExpectation);\n    var i, j;\n\n    descriptions.sort();\n\n    if (descriptions.length > 0) {\n      for (i = 1, j = 1; i < descriptions.length; i++) {\n        if (descriptions[i - 1] !== descriptions[i]) {\n          descriptions[j] = descriptions[i];\n          j++;\n        }\n      }\n      descriptions.length = j;\n    }\n\n    switch (descriptions.length) {\n      case 1:\n        return descriptions[0];\n\n      case 2:\n        return descriptions[0] + \" or \" + descriptions[1];\n\n      default:\n        return descriptions.slice(0, -1).join(\", \")\n          + \", or \"\n          + descriptions[descriptions.length - 1];\n    }\n  }\n\n  function describeFound(found) {\n    return found ? \"\\\"\" + literalEscape(found) + \"\\\"\" : \"end of input\";\n  }\n\n  return \"Expected \" + describeExpected(expected) + \" but \" + describeFound(found) + \" found.\";\n};\n\nfunction peg$parse(input, options) {\n  options = options !== undefined ? options : {};\n\n  var peg$FAILED = {};\n  var peg$source = options.grammarSource;\n\n  var peg$startRuleFunctions = { pgn: peg$parsepgn };\n  var peg$startRuleFunction = peg$parsepgn;\n\n  var peg$c0 = \"[\";\n  var peg$c1 = \"\\\"\";\n  var peg$c2 = \"]\";\n  var peg$c3 = \".\";\n  var peg$c4 = \"O-O-O\";\n  var peg$c5 = \"O-O\";\n  var peg$c6 = \"0-0-0\";\n  var peg$c7 = \"0-0\";\n  var peg$c8 = \"$\";\n  var peg$c9 = \"{\";\n  var peg$c10 = \"}\";\n  var peg$c11 = \";\";\n  var peg$c12 = \"(\";\n  var peg$c13 = \")\";\n  var peg$c14 = \"1-0\";\n  var peg$c15 = \"0-1\";\n  var peg$c16 = \"1/2-1/2\";\n  var peg$c17 = \"*\";\n\n  var peg$r0 = /^[a-zA-Z]/;\n  var peg$r1 = /^[^\"]/;\n  var peg$r2 = /^[0-9]/;\n  var peg$r3 = /^[.]/;\n  var peg$r4 = /^[a-zA-Z1-8\\-=]/;\n  var peg$r5 = /^[+#]/;\n  var peg$r6 = /^[!?]/;\n  var peg$r7 = /^[^}]/;\n  var peg$r8 = /^[^\\r\\n]/;\n  var peg$r9 = /^[ \\t\\r\\n]/;\n\n  var peg$e0 = peg$otherExpectation(\"tag pair\");\n  var peg$e1 = peg$literalExpectation(\"[\", false);\n  var peg$e2 = peg$literalExpectation(\"\\\"\", false);\n  var peg$e3 = peg$literalExpectation(\"]\", false);\n  var peg$e4 = peg$otherExpectation(\"tag name\");\n  var peg$e5 = peg$classExpectation([[\"a\", \"z\"], [\"A\", \"Z\"]], false, false);\n  var peg$e6 = peg$otherExpectation(\"tag value\");\n  var peg$e7 = peg$classExpectation([\"\\\"\"], true, false);\n  var peg$e8 = peg$otherExpectation(\"move number\");\n  var peg$e9 = peg$classExpectation([[\"0\", \"9\"]], false, false);\n  var peg$e10 = peg$literalExpectation(\".\", false);\n  var peg$e11 = peg$classExpectation([\".\"], false, false);\n  var peg$e12 = peg$otherExpectation(\"standard algebraic notation\");\n  var peg$e13 = peg$literalExpectation(\"O-O-O\", false);\n  var peg$e14 = peg$literalExpectation(\"O-O\", false);\n  var peg$e15 = peg$literalExpectation(\"0-0-0\", false);\n  var peg$e16 = peg$literalExpectation(\"0-0\", false);\n  var peg$e17 = peg$classExpectation([[\"a\", \"z\"], [\"A\", \"Z\"], [\"1\", \"8\"], \"-\", \"=\"], false, false);\n  var peg$e18 = peg$classExpectation([\"+\", \"#\"], false, false);\n  var peg$e19 = peg$otherExpectation(\"suffix annotation\");\n  var peg$e20 = peg$classExpectation([\"!\", \"?\"], false, false);\n  var peg$e21 = peg$otherExpectation(\"NAG\");\n  var peg$e22 = peg$literalExpectation(\"$\", false);\n  var peg$e23 = peg$otherExpectation(\"brace comment\");\n  var peg$e24 = peg$literalExpectation(\"{\", false);\n  var peg$e25 = peg$classExpectation([\"}\"], true, false);\n  var peg$e26 = peg$literalExpectation(\"}\", false);\n  var peg$e27 = peg$otherExpectation(\"rest of line comment\");\n  var peg$e28 = peg$literalExpectation(\";\", false);\n  var peg$e29 = peg$classExpectation([\"\\r\", \"\\n\"], true, false);\n  var peg$e30 = peg$otherExpectation(\"variation\");\n  var peg$e31 = peg$literalExpectation(\"(\", false);\n  var peg$e32 = peg$literalExpectation(\")\", false);\n  var peg$e33 = peg$otherExpectation(\"game termination marker\");\n  var peg$e34 = peg$literalExpectation(\"1-0\", false);\n  var peg$e35 = peg$literalExpectation(\"0-1\", false);\n  var peg$e36 = peg$literalExpectation(\"1/2-1/2\", false);\n  var peg$e37 = peg$literalExpectation(\"*\", false);\n  var peg$e38 = peg$otherExpectation(\"whitespace\");\n  var peg$e39 = peg$classExpectation([\" \", \"\\t\", \"\\r\", \"\\n\"], false, false);\n\n  var peg$f0 = function(headers, game) { return pgn(headers, game) };\n  var peg$f1 = function(tagPairs) { return Object.fromEntries(tagPairs) };\n  var peg$f2 = function(tagName, tagValue) { return [tagName, tagValue] };\n  var peg$f3 = function(root, marker) { return { root, marker} };\n  var peg$f4 = function(comment, moves) { return lineToTree(rootNode(comment), ...moves.flat()) };\n  var peg$f5 = function(san, suffix, nag, comment, variations) { return node(san, suffix, nag, comment, variations) };\n  var peg$f6 = function(nag) { return nag };\n  var peg$f7 = function(comment) { return comment.replace(/[\\r\\n]+/g, \" \") };\n  var peg$f8 = function(comment) { return comment.trim() };\n  var peg$f9 = function(line) { return line };\n  var peg$f10 = function(result, comment) { return { result, comment } };\n  var peg$currPos = options.peg$currPos | 0;\n  var peg$savedPos = peg$currPos;\n  var peg$posDetailsCache = [{ line: 1, column: 1 }];\n  var peg$maxFailPos = peg$currPos;\n  var peg$maxFailExpected = options.peg$maxFailExpected || [];\n  var peg$silentFails = options.peg$silentFails | 0;\n\n  var peg$result;\n\n  if (options.startRule) {\n    if (!(options.startRule in peg$startRuleFunctions)) {\n      throw new Error(\"Can't start parsing from rule \\\"\" + options.startRule + \"\\\".\");\n    }\n\n    peg$startRuleFunction = peg$startRuleFunctions[options.startRule];\n  }\n\n  function text() {\n    return input.substring(peg$savedPos, peg$currPos);\n  }\n\n  function offset() {\n    return peg$savedPos;\n  }\n\n  function range() {\n    return {\n      source: peg$source,\n      start: peg$savedPos,\n      end: peg$currPos\n    };\n  }\n\n  function location() {\n    return peg$computeLocation(peg$savedPos, peg$currPos);\n  }\n\n  function expected(description, location) {\n    location = location !== undefined\n      ? location\n      : peg$computeLocation(peg$savedPos, peg$currPos);\n\n    throw peg$buildStructuredError(\n      [peg$otherExpectation(description)],\n      input.substring(peg$savedPos, peg$currPos),\n      location\n    );\n  }\n\n  function error(message, location) {\n    location = location !== undefined\n      ? location\n      : peg$computeLocation(peg$savedPos, peg$currPos);\n\n    throw peg$buildSimpleError(message, location);\n  }\n\n  function peg$literalExpectation(text, ignoreCase) {\n    return { type: \"literal\", text: text, ignoreCase: ignoreCase };\n  }\n\n  function peg$classExpectation(parts, inverted, ignoreCase) {\n    return { type: \"class\", parts: parts, inverted: inverted, ignoreCase: ignoreCase };\n  }\n\n  function peg$anyExpectation() {\n    return { type: \"any\" };\n  }\n\n  function peg$endExpectation() {\n    return { type: \"end\" };\n  }\n\n  function peg$otherExpectation(description) {\n    return { type: \"other\", description: description };\n  }\n\n  function peg$computePosDetails(pos) {\n    var details = peg$posDetailsCache[pos];\n    var p;\n\n    if (details) {\n      return details;\n    } else {\n      if (pos >= peg$posDetailsCache.length) {\n        p = peg$posDetailsCache.length - 1;\n      } else {\n        p = pos;\n        while (!peg$posDetailsCache[--p]) {}\n      }\n\n      details = peg$posDetailsCache[p];\n      details = {\n        line: details.line,\n        column: details.column\n      };\n\n      while (p < pos) {\n        if (input.charCodeAt(p) === 10) {\n          details.line++;\n          details.column = 1;\n        } else {\n          details.column++;\n        }\n\n        p++;\n      }\n\n      peg$posDetailsCache[pos] = details;\n\n      return details;\n    }\n  }\n\n  function peg$computeLocation(startPos, endPos, offset) {\n    var startPosDetails = peg$computePosDetails(startPos);\n    var endPosDetails = peg$computePosDetails(endPos);\n\n    var res = {\n      source: peg$source,\n      start: {\n        offset: startPos,\n        line: startPosDetails.line,\n        column: startPosDetails.column\n      },\n      end: {\n        offset: endPos,\n        line: endPosDetails.line,\n        column: endPosDetails.column\n      }\n    };\n    if (offset && peg$source && (typeof peg$source.offset === \"function\")) {\n      res.start = peg$source.offset(res.start);\n      res.end = peg$source.offset(res.end);\n    }\n    return res;\n  }\n\n  function peg$fail(expected) {\n    if (peg$currPos < peg$maxFailPos) { return; }\n\n    if (peg$currPos > peg$maxFailPos) {\n      peg$maxFailPos = peg$currPos;\n      peg$maxFailExpected = [];\n    }\n\n    peg$maxFailExpected.push(expected);\n  }\n\n  function peg$buildSimpleError(message, location) {\n    return new peg$SyntaxError(message, null, null, location);\n  }\n\n  function peg$buildStructuredError(expected, found, location) {\n    return new peg$SyntaxError(\n      peg$SyntaxError.buildMessage(expected, found),\n      expected,\n      found,\n      location\n    );\n  }\n\n  function peg$parsepgn() {\n    var s0, s1, s2;\n\n    s0 = peg$currPos;\n    s1 = peg$parsetagPairSection();\n    s2 = peg$parsemoveTextSection();\n    peg$savedPos = s0;\n    s0 = peg$f0(s1, s2);\n\n    return s0;\n  }\n\n  function peg$parsetagPairSection() {\n    var s0, s1, s2;\n\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = peg$parsetagPair();\n    while (s2 !== peg$FAILED) {\n      s1.push(s2);\n      s2 = peg$parsetagPair();\n    }\n    s2 = peg$parse_();\n    peg$savedPos = s0;\n    s0 = peg$f1(s1);\n\n    return s0;\n  }\n\n  function peg$parsetagPair() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8, s9, s10;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = peg$parse_();\n    if (input.charCodeAt(peg$currPos) === 91) {\n      s2 = peg$c0;\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e1); }\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = peg$parse_();\n      s4 = peg$parsetagName();\n      if (s4 !== peg$FAILED) {\n        s5 = peg$parse_();\n        if (input.charCodeAt(peg$currPos) === 34) {\n          s6 = peg$c1;\n          peg$currPos++;\n        } else {\n          s6 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e2); }\n        }\n        if (s6 !== peg$FAILED) {\n          s7 = peg$parsetagValue();\n          if (input.charCodeAt(peg$currPos) === 34) {\n            s8 = peg$c1;\n            peg$currPos++;\n          } else {\n            s8 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e2); }\n          }\n          if (s8 !== peg$FAILED) {\n            s9 = peg$parse_();\n            if (input.charCodeAt(peg$currPos) === 93) {\n              s10 = peg$c2;\n              peg$currPos++;\n            } else {\n              s10 = peg$FAILED;\n              if (peg$silentFails === 0) { peg$fail(peg$e3); }\n            }\n            if (s10 !== peg$FAILED) {\n              peg$savedPos = s0;\n              s0 = peg$f2(s4, s7);\n            } else {\n              peg$currPos = s0;\n              s0 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e0); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsetagName() {\n    var s0, s1, s2;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = input.charAt(peg$currPos);\n    if (peg$r0.test(s2)) {\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e5); }\n    }\n    if (s2 !== peg$FAILED) {\n      while (s2 !== peg$FAILED) {\n        s1.push(s2);\n        s2 = input.charAt(peg$currPos);\n        if (peg$r0.test(s2)) {\n          peg$currPos++;\n        } else {\n          s2 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e5); }\n        }\n      }\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s0 = input.substring(s0, peg$currPos);\n    } else {\n      s0 = s1;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e4); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsetagValue() {\n    var s0, s1, s2;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = input.charAt(peg$currPos);\n    if (peg$r1.test(s2)) {\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e7); }\n    }\n    while (s2 !== peg$FAILED) {\n      s1.push(s2);\n      s2 = input.charAt(peg$currPos);\n      if (peg$r1.test(s2)) {\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e7); }\n      }\n    }\n    s0 = input.substring(s0, peg$currPos);\n    peg$silentFails--;\n    s1 = peg$FAILED;\n    if (peg$silentFails === 0) { peg$fail(peg$e6); }\n\n    return s0;\n  }\n\n  function peg$parsemoveTextSection() {\n    var s0, s1, s2, s3, s4;\n\n    s0 = peg$currPos;\n    s1 = peg$parseline();\n    s2 = peg$parse_();\n    s3 = peg$parsegameTerminationMarker();\n    if (s3 === peg$FAILED) {\n      s3 = null;\n    }\n    s4 = peg$parse_();\n    peg$savedPos = s0;\n    s0 = peg$f3(s1, s3);\n\n    return s0;\n  }\n\n  function peg$parseline() {\n    var s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    s1 = peg$parsecomment();\n    if (s1 === peg$FAILED) {\n      s1 = null;\n    }\n    s2 = [];\n    s3 = peg$parsemove();\n    while (s3 !== peg$FAILED) {\n      s2.push(s3);\n      s3 = peg$parsemove();\n    }\n    peg$savedPos = s0;\n    s0 = peg$f4(s1, s2);\n\n    return s0;\n  }\n\n  function peg$parsemove() {\n    var s0, s1, s2, s3, s4, s5, s6, s7, s8, s9, s10;\n\n    s0 = peg$currPos;\n    s1 = peg$parse_();\n    s2 = peg$parsemoveNumber();\n    if (s2 === peg$FAILED) {\n      s2 = null;\n    }\n    s3 = peg$parse_();\n    s4 = peg$parsesan();\n    if (s4 !== peg$FAILED) {\n      s5 = peg$parsesuffixAnnotation();\n      if (s5 === peg$FAILED) {\n        s5 = null;\n      }\n      s6 = [];\n      s7 = peg$parsenag();\n      while (s7 !== peg$FAILED) {\n        s6.push(s7);\n        s7 = peg$parsenag();\n      }\n      s7 = peg$parse_();\n      s8 = peg$parsecomment();\n      if (s8 === peg$FAILED) {\n        s8 = null;\n      }\n      s9 = [];\n      s10 = peg$parsevariation();\n      while (s10 !== peg$FAILED) {\n        s9.push(s10);\n        s10 = peg$parsevariation();\n      }\n      peg$savedPos = s0;\n      s0 = peg$f5(s4, s5, s6, s8, s9);\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsemoveNumber() {\n    var s0, s1, s2, s3, s4, s5;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = input.charAt(peg$currPos);\n    if (peg$r2.test(s2)) {\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e9); }\n    }\n    while (s2 !== peg$FAILED) {\n      s1.push(s2);\n      s2 = input.charAt(peg$currPos);\n      if (peg$r2.test(s2)) {\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e9); }\n      }\n    }\n    if (input.charCodeAt(peg$currPos) === 46) {\n      s2 = peg$c3;\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e10); }\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = peg$parse_();\n      s4 = [];\n      s5 = input.charAt(peg$currPos);\n      if (peg$r3.test(s5)) {\n        peg$currPos++;\n      } else {\n        s5 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e11); }\n      }\n      while (s5 !== peg$FAILED) {\n        s4.push(s5);\n        s5 = input.charAt(peg$currPos);\n        if (peg$r3.test(s5)) {\n          peg$currPos++;\n        } else {\n          s5 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e11); }\n        }\n      }\n      s1 = [s1, s2, s3, s4];\n      s0 = s1;\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e8); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsesan() {\n    var s0, s1, s2, s3, s4, s5;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = peg$currPos;\n    if (input.substr(peg$currPos, 5) === peg$c4) {\n      s2 = peg$c4;\n      peg$currPos += 5;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e13); }\n    }\n    if (s2 === peg$FAILED) {\n      if (input.substr(peg$currPos, 3) === peg$c5) {\n        s2 = peg$c5;\n        peg$currPos += 3;\n      } else {\n        s2 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e14); }\n      }\n      if (s2 === peg$FAILED) {\n        if (input.substr(peg$currPos, 5) === peg$c6) {\n          s2 = peg$c6;\n          peg$currPos += 5;\n        } else {\n          s2 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e15); }\n        }\n        if (s2 === peg$FAILED) {\n          if (input.substr(peg$currPos, 3) === peg$c7) {\n            s2 = peg$c7;\n            peg$currPos += 3;\n          } else {\n            s2 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e16); }\n          }\n          if (s2 === peg$FAILED) {\n            s2 = peg$currPos;\n            s3 = input.charAt(peg$currPos);\n            if (peg$r0.test(s3)) {\n              peg$currPos++;\n            } else {\n              s3 = peg$FAILED;\n              if (peg$silentFails === 0) { peg$fail(peg$e5); }\n            }\n            if (s3 !== peg$FAILED) {\n              s4 = [];\n              s5 = input.charAt(peg$currPos);\n              if (peg$r4.test(s5)) {\n                peg$currPos++;\n              } else {\n                s5 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$e17); }\n              }\n              if (s5 !== peg$FAILED) {\n                while (s5 !== peg$FAILED) {\n                  s4.push(s5);\n                  s5 = input.charAt(peg$currPos);\n                  if (peg$r4.test(s5)) {\n                    peg$currPos++;\n                  } else {\n                    s5 = peg$FAILED;\n                    if (peg$silentFails === 0) { peg$fail(peg$e17); }\n                  }\n                }\n              } else {\n                s4 = peg$FAILED;\n              }\n              if (s4 !== peg$FAILED) {\n                s3 = [s3, s4];\n                s2 = s3;\n              } else {\n                peg$currPos = s2;\n                s2 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s2;\n              s2 = peg$FAILED;\n            }\n          }\n        }\n      }\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = input.charAt(peg$currPos);\n      if (peg$r5.test(s3)) {\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e18); }\n      }\n      if (s3 === peg$FAILED) {\n        s3 = null;\n      }\n      s2 = [s2, s3];\n      s1 = s2;\n    } else {\n      peg$currPos = s1;\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s0 = input.substring(s0, peg$currPos);\n    } else {\n      s0 = s1;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e12); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsesuffixAnnotation() {\n    var s0, s1, s2;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = [];\n    s2 = input.charAt(peg$currPos);\n    if (peg$r6.test(s2)) {\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e20); }\n    }\n    while (s2 !== peg$FAILED) {\n      s1.push(s2);\n      if (s1.length >= 2) {\n        s2 = peg$FAILED;\n      } else {\n        s2 = input.charAt(peg$currPos);\n        if (peg$r6.test(s2)) {\n          peg$currPos++;\n        } else {\n          s2 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e20); }\n        }\n      }\n    }\n    if (s1.length < 1) {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    } else {\n      s0 = s1;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e19); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsenag() {\n    var s0, s1, s2, s3, s4, s5;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = peg$parse_();\n    if (input.charCodeAt(peg$currPos) === 36) {\n      s2 = peg$c8;\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e22); }\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = peg$currPos;\n      s4 = [];\n      s5 = input.charAt(peg$currPos);\n      if (peg$r2.test(s5)) {\n        peg$currPos++;\n      } else {\n        s5 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e9); }\n      }\n      if (s5 !== peg$FAILED) {\n        while (s5 !== peg$FAILED) {\n          s4.push(s5);\n          s5 = input.charAt(peg$currPos);\n          if (peg$r2.test(s5)) {\n            peg$currPos++;\n          } else {\n            s5 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e9); }\n          }\n        }\n      } else {\n        s4 = peg$FAILED;\n      }\n      if (s4 !== peg$FAILED) {\n        s3 = input.substring(s3, peg$currPos);\n      } else {\n        s3 = s4;\n      }\n      if (s3 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f6(s3);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e21); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsecomment() {\n    var s0;\n\n    s0 = peg$parsebraceComment();\n    if (s0 === peg$FAILED) {\n      s0 = peg$parserestOfLineComment();\n    }\n\n    return s0;\n  }\n\n  function peg$parsebraceComment() {\n    var s0, s1, s2, s3, s4;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    if (input.charCodeAt(peg$currPos) === 123) {\n      s1 = peg$c9;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e24); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$currPos;\n      s3 = [];\n      s4 = input.charAt(peg$currPos);\n      if (peg$r7.test(s4)) {\n        peg$currPos++;\n      } else {\n        s4 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e25); }\n      }\n      while (s4 !== peg$FAILED) {\n        s3.push(s4);\n        s4 = input.charAt(peg$currPos);\n        if (peg$r7.test(s4)) {\n          peg$currPos++;\n        } else {\n          s4 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e25); }\n        }\n      }\n      s2 = input.substring(s2, peg$currPos);\n      if (input.charCodeAt(peg$currPos) === 125) {\n        s3 = peg$c10;\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e26); }\n      }\n      if (s3 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s0 = peg$f7(s2);\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e23); }\n    }\n\n    return s0;\n  }\n\n  function peg$parserestOfLineComment() {\n    var s0, s1, s2, s3, s4;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    if (input.charCodeAt(peg$currPos) === 59) {\n      s1 = peg$c11;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e28); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$currPos;\n      s3 = [];\n      s4 = input.charAt(peg$currPos);\n      if (peg$r8.test(s4)) {\n        peg$currPos++;\n      } else {\n        s4 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e29); }\n      }\n      while (s4 !== peg$FAILED) {\n        s3.push(s4);\n        s4 = input.charAt(peg$currPos);\n        if (peg$r8.test(s4)) {\n          peg$currPos++;\n        } else {\n          s4 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e29); }\n        }\n      }\n      s2 = input.substring(s2, peg$currPos);\n      peg$savedPos = s0;\n      s0 = peg$f8(s2);\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e27); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsevariation() {\n    var s0, s1, s2, s3, s4, s5;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    s1 = peg$parse_();\n    if (input.charCodeAt(peg$currPos) === 40) {\n      s2 = peg$c12;\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e31); }\n    }\n    if (s2 !== peg$FAILED) {\n      s3 = peg$parseline();\n      if (s3 !== peg$FAILED) {\n        s4 = peg$parse_();\n        if (input.charCodeAt(peg$currPos) === 41) {\n          s5 = peg$c13;\n          peg$currPos++;\n        } else {\n          s5 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e32); }\n        }\n        if (s5 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s0 = peg$f9(s3);\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e30); }\n    }\n\n    return s0;\n  }\n\n  function peg$parsegameTerminationMarker() {\n    var s0, s1, s2, s3;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    if (input.substr(peg$currPos, 3) === peg$c14) {\n      s1 = peg$c14;\n      peg$currPos += 3;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e34); }\n    }\n    if (s1 === peg$FAILED) {\n      if (input.substr(peg$currPos, 3) === peg$c15) {\n        s1 = peg$c15;\n        peg$currPos += 3;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e35); }\n      }\n      if (s1 === peg$FAILED) {\n        if (input.substr(peg$currPos, 7) === peg$c16) {\n          s1 = peg$c16;\n          peg$currPos += 7;\n        } else {\n          s1 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$e36); }\n        }\n        if (s1 === peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 42) {\n            s1 = peg$c17;\n            peg$currPos++;\n          } else {\n            s1 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$e37); }\n          }\n        }\n      }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parse_();\n      s3 = peg$parsecomment();\n      if (s3 === peg$FAILED) {\n        s3 = null;\n      }\n      peg$savedPos = s0;\n      s0 = peg$f10(s1, s3);\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e33); }\n    }\n\n    return s0;\n  }\n\n  function peg$parse_() {\n    var s0, s1;\n\n    peg$silentFails++;\n    s0 = [];\n    s1 = input.charAt(peg$currPos);\n    if (peg$r9.test(s1)) {\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$e39); }\n    }\n    while (s1 !== peg$FAILED) {\n      s0.push(s1);\n      s1 = input.charAt(peg$currPos);\n      if (peg$r9.test(s1)) {\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$e39); }\n      }\n    }\n    peg$silentFails--;\n    s1 = peg$FAILED;\n    if (peg$silentFails === 0) { peg$fail(peg$e38); }\n\n    return s0;\n  }\n\n  peg$result = peg$startRuleFunction();\n\n  if (options.peg$library) {\n    return /** @type {any} */ ({\n      peg$result,\n      peg$currPos,\n      peg$FAILED,\n      peg$maxFailExpected,\n      peg$maxFailPos\n    });\n  }\n  if (peg$result !== peg$FAILED && peg$currPos === input.length) {\n    return peg$result;\n  } else {\n    if (peg$result !== peg$FAILED && peg$currPos < input.length) {\n      peg$fail(peg$endExpectation());\n    }\n\n    throw peg$buildStructuredError(\n      peg$maxFailExpected,\n      peg$maxFailPos < input.length ? input.charAt(peg$maxFailPos) : null,\n      peg$maxFailPos < input.length\n        ? peg$computeLocation(peg$maxFailPos, peg$maxFailPos + 1)\n        : peg$computeLocation(peg$maxFailPos, peg$maxFailPos)\n    );\n  }\n}\n\nconst peg$allowedStartRules = [\n  \"pgn\"\n];\n\nexport {\n  peg$allowedStartRules as StartRules,\n  peg$SyntaxError as SyntaxError,\n  peg$parse as parse\n};\n", null, "import type { QuestionPack, CharacterSet, GameState, SaveSlot } from './types';\n\nconst PACKS_KEY     = 'clu_packs';\nconst CHAR_SETS_KEY = 'clu_character_sets';\nconst SAVES_KEY     = 'clu_saves';\n\n// \u2500\u2500 Question Packs \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport function loadPacks(): QuestionPack[] {\n  try {\n    const data = JSON.parse(localStorage.getItem(PACKS_KEY) ?? '[]');\n    if (!Array.isArray(data)) return [];\n    return data.filter(p =>\n      p && typeof p.title === 'string' &&\n      Array.isArray(p.questions) &&\n      typeof p.starsPerCorrect === 'number'\n    );\n  } catch { return []; }\n}\n\nexport function savePacks(packs: QuestionPack[]): void {\n  try { localStorage.setItem(PACKS_KEY, JSON.stringify(packs)); }\n  catch { alert('\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C: \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449\u0435 \u043F\u0435\u0440\u0435\u043F\u043E\u043B\u043D\u0435\u043D\u043E.'); }\n}\n\n// \u2500\u2500 Character Sets \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport function loadCharacterSets(): CharacterSet[] {\n  try {\n    const data = JSON.parse(localStorage.getItem(CHAR_SETS_KEY) ?? '[]');\n    if (!Array.isArray(data)) return [];\n    return data.filter(s =>\n      s && typeof s.title === 'string' &&\n      Array.isArray(s.characters)\n    );\n  } catch { return []; }\n}\n\nexport function saveCharacterSets(sets: CharacterSet[]): void {\n  try { localStorage.setItem(CHAR_SETS_KEY, JSON.stringify(sets)); }\n  catch { alert('\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C: \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449\u0435 \u043F\u0435\u0440\u0435\u043F\u043E\u043B\u043D\u0435\u043D\u043E.'); }\n}\n\n// \u2500\u2500 Save Slots \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport function loadSaves(): SaveSlot[] {\n  try {\n    const data = JSON.parse(localStorage.getItem(SAVES_KEY) ?? '[]');\n    if (!Array.isArray(data)) return [];\n    return data.filter(s =>\n      s && typeof s.id === 'string' &&\n      typeof s.playerName === 'string' &&\n      s.state != null\n    );\n  } catch { return []; }\n}\n\nexport function upsertSave(state: GameState): void {\n  const saves   = loadSaves();\n  const idx     = saves.findIndex(s => s.id === state.id);\n  const charName = state.unlockedUpTo >= 0\n    ? (state.characterSet.characters[state.unlockedUpTo]?.name ?? '')\n    : '';\n\n  const slot: SaveSlot = {\n    id:               state.id,\n    playerName:       state.playerName,\n    packTitle:        state.pack.title,\n    charName,\n    questionProgress: `${state.currentIndex + 1} / ${state.shuffledQuestions.length}`,\n    totalStars:       state.totalStars,\n    savedAt:          Date.now(),\n    state,\n  };\n\n  if (idx >= 0) saves[idx] = slot;\n  else saves.unshift(slot);\n\n  try { localStorage.setItem(SAVES_KEY, JSON.stringify(saves)); }\n  catch { alert('\u041D\u0435 \u0443\u0434\u0430\u043B\u043E\u0441\u044C \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u043F\u0440\u043E\u0433\u0440\u0435\u0441\u0441: \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449\u0435 \u043F\u0435\u0440\u0435\u043F\u043E\u043B\u043D\u0435\u043D\u043E.'); }\n}\n\nexport function deleteSave(id: string): void {\n  const filtered = loadSaves().filter(s => s.id !== id);\n  try { localStorage.setItem(SAVES_KEY, JSON.stringify(filtered)); }\n  catch { /* ignore \u2014 deletion is best-effort */ }\n}\n\n// \u2500\u2500 Builtin Data \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport async function loadBuiltinPacks(): Promise<QuestionPack[]> {\n  try {\n    const res = await fetch('packs/index.json');\n    const files: string[] = await res.json();\n    return Promise.all(files.map(f => fetch(`packs/${f}`).then(r => r.json())));\n  } catch { return []; }\n}\n\nexport async function loadBuiltinCharacterSets(): Promise<CharacterSet[]> {\n  try {\n    const res = await fetch('characters/index.json');\n    const files: string[] = await res.json();\n    return Promise.all(files.map(f => fetch(`characters/${f}`).then(r => r.json())));\n  } catch { return []; }\n}\n", "import type { GameState, QuestionPack, CharacterSet, Character, Screen } from './types';\nimport { escapeHtml, sanitizeImageUrl, showModal } from './utils';\nimport { mountBoard } from './board';\nimport type { Api } from '@lichess-org/chessground/api';\nimport type { Key } from '@lichess-org/chessground/types';\nimport { Chess } from 'chess.js';\nimport {\n  loadPacks, loadCharacterSets,\n  loadBuiltinPacks, loadBuiltinCharacterSets,\n  upsertSave, deleteSave, loadSaves,\n} from './storage';\n\n// \u2500\u2500 State \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nlet game: GameState | null = null;\nlet _nav: (s: Screen) => void = () => { /* no-op until app sets it */ };\nlet boardApi: Api | null = null;\nlet boardMoveIdx = 0;\nlet navChess: Chess | null = null;\nlet navKeyHandler: ((e: KeyboardEvent) => void) | null = null;\n\nlet builtinPacks: QuestionPack[] = [];\nlet builtinSets: CharacterSet[] = [];\n\n// \u2500\u2500 Init \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport function setNav(fn: (s: Screen) => void): void {\n  _nav = fn;\n}\n\nexport async function preload(): Promise<void> {\n  [builtinPacks, builtinSets] = await Promise.all([\n    loadBuiltinPacks(),\n    loadBuiltinCharacterSets(),\n  ]);\n}\n\nexport function hasActiveSave(): boolean {\n  return loadSaves().length > 0;\n}\n\nfunction allPacks(): QuestionPack[] {\n  return [...builtinPacks, ...loadPacks()];\n}\n\nfunction allSets(): CharacterSet[] {\n  return [...builtinSets, ...loadCharacterSets()];\n}\n\n// \u2500\u2500 Setup Screen \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nexport function renderSetup(el: HTMLElement): void {\n  const packs = allPacks();\n  const sets = allSets();\n  const canStart = packs.length > 0 && sets.length > 0;\n\n  el.innerHTML = `\n    <div class=\"min-h-screen flex flex-col items-center justify-center p-6 bg-gray-950\">\n      <h1 class=\"text-3xl font-bold mb-8\">\u041D\u043E\u0432\u0430\u044F \u0438\u0433\u0440\u0430</h1>\n\n      <div class=\"w-full max-w-md space-y-5\">\n\n        <div>\n          <label class=\"block text-xs text-gray-400 uppercase tracking-wider mb-1.5\">\u0418\u043C\u044F \u0438\u0433\u0440\u043E\u043A\u0430</label>\n          <input id=\"inp-name\" type=\"text\" maxlength=\"40\" placeholder=\"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0438\u043C\u044F...\"\n            class=\"w-full bg-gray-800 text-white rounded-xl px-4 py-3 border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n        </div>\n\n        <div>\n          <label class=\"block text-xs text-gray-400 uppercase tracking-wider mb-1.5\">\u041F\u0430\u043A\u0435\u0442 \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432</label>\n          ${packs.length > 0\n            ? `<select id=\"sel-pack\" class=\"w-full bg-gray-800 text-white rounded-xl px-4 py-3 border border-gray-700 focus:outline-none focus:border-indigo-500\">\n                ${packs.map((p, i) =>\n                  `<option value=\"${i}\">${escapeHtml(p.title)} (${p.questions.length} \u0432\u043E\u043F\u0440. \u00B7 ${p.starsPerCorrect}\u2605)</option>`\n                ).join('')}\n               </select>`\n            : `<div class=\"bg-gray-800 text-red-400 rounded-xl px-4 py-3 text-sm\">\u041D\u0435\u0442 \u043F\u0430\u043A\u0435\u0442\u043E\u0432. \u0421\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u0432 \u00AB\u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440\u0435 \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432\u00BB.</div>`}\n        </div>\n\n        <div>\n          <label class=\"block text-xs text-gray-400 uppercase tracking-wider mb-1.5\">\u041D\u0430\u0431\u043E\u0440 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0435\u0439</label>\n          ${sets.length > 0\n            ? `<select id=\"sel-chars\" class=\"w-full bg-gray-800 text-white rounded-xl px-4 py-3 border border-gray-700 focus:outline-none focus:border-indigo-500\">\n                ${sets.map((s, i) =>\n                  `<option value=\"${i}\">${escapeHtml(s.title)} (${s.characters.length} \u043F\u0435\u0440\u0441.)</option>`\n                ).join('')}\n               </select>`\n            : `<div class=\"bg-gray-800 text-red-400 rounded-xl px-4 py-3 text-sm\">\u041D\u0435\u0442 \u043D\u0430\u0431\u043E\u0440\u043E\u0432. \u0421\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u0432 \u00AB\u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440\u0435 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0435\u0439\u00BB.</div>`}\n          <div id=\"compat-warning\"></div>\n        </div>\n\n        <button id=\"btn-start\"\n          class=\"w-full py-4 rounded-xl font-bold text-lg transition\n            ${canStart\n              ? 'bg-indigo-600 hover:bg-indigo-500 text-white'\n              : 'bg-gray-700 text-gray-500 cursor-not-allowed'}\"\n          ${canStart ? '' : 'disabled'}>\n          \u041D\u0430\u0447\u0430\u0442\u044C \u0438\u0433\u0440\u0443\n        </button>\n\n        <button id=\"btn-back\"\n          class=\"w-full py-3 bg-gray-800 hover:bg-gray-700 text-white rounded-xl font-semibold transition\">\n          \u041D\u0430\u0437\u0430\u0434\n        </button>\n\n      </div>\n    </div>\n  `;\n\n  if (canStart) {\n    const selPack  = el.querySelector('#sel-pack')  as HTMLSelectElement;\n    const selChars = el.querySelector('#sel-chars') as HTMLSelectElement;\n\n    const updateCompat = () => {\n      const p       = packs[parseInt(selPack.value)];\n      const s       = sets[parseInt(selChars.value)];\n      const warning = el.querySelector('#compat-warning')!;\n      if (!p || !s) { warning.innerHTML = ''; return; }\n\n      const maxStars   = p.questions.length * p.starsPerCorrect;\n      const sorted     = [...s.characters].sort((a, b) => a.cost - b.cost);\n      const maxNeeded  = sorted[sorted.length - 1]?.cost ?? 0;\n      const unlockable = sorted.filter(c => c.cost <= maxStars).length;\n\n      const btnStart = el.querySelector('#btn-start') as HTMLButtonElement;\n      if (unlockable === 0) {\n        warning.innerHTML = `<div class=\"mt-2 px-3 py-2 bg-red-950 border border-red-800 rounded-xl text-red-300 text-xs\">\n          \u26D4 \u041D\u0435\u043B\u044C\u0437\u044F \u043E\u0442\u043A\u0440\u044B\u0442\u044C \u043D\u0438 \u043E\u0434\u043D\u043E\u0433\u043E \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0430 \u2014 \u043C\u0430\u043A\u0441. ${maxStars}\u2605, \u0430 \u0441\u0430\u043C\u044B\u0439 \u0434\u0435\u0448\u0451\u0432\u044B\u0439 \u0441\u0442\u043E\u0438\u0442 ${sorted[0]?.cost ?? 0}\u2605\n        </div>`;\n        btnStart.disabled = true;\n        btnStart.classList.add('opacity-50', 'cursor-not-allowed');\n      } else if (maxStars < maxNeeded) {\n        warning.innerHTML = `<div class=\"mt-2 px-3 py-2 bg-yellow-950 border border-yellow-800 rounded-xl text-yellow-300 text-xs\">\n          \u26A0 \u041C\u043E\u0436\u043D\u043E \u043E\u0442\u043A\u0440\u044B\u0442\u044C ${unlockable} \u0438\u0437 ${sorted.length} \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0435\u0439 (\u043C\u0430\u043A\u0441. ${maxStars}\u2605, \u043D\u0443\u0436\u043D\u043E ${maxNeeded}\u2605)\n        </div>`;\n        btnStart.disabled = false;\n        btnStart.classList.remove('opacity-50', 'cursor-not-allowed');\n      } else {\n        warning.innerHTML = `<div class=\"mt-2 px-3 py-2 bg-green-950 border border-green-800 rounded-xl text-green-400 text-xs\">\n          \u2713 \u0412\u0441\u0435 ${sorted.length} ${ruWord(sorted.length, '\u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436', '\u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0430', '\u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0435\u0439')} \u043E\u0442\u043A\u0440\u044B\u0432\u0430\u0435\u043C\u044B (\u043C\u0430\u043A\u0441. ${maxStars}\u2605 \u043F\u0440\u0438 \u043D\u0443\u0436\u043D\u044B\u0445 ${maxNeeded}\u2605)\n        </div>`;\n        btnStart.disabled = false;\n        btnStart.classList.remove('opacity-50', 'cursor-not-allowed');\n      }\n    };\n\n    selPack.addEventListener('change', updateCompat);\n    selChars.addEventListener('change', updateCompat);\n    updateCompat();\n\n    el.querySelector('#btn-start')?.addEventListener('click', () => {\n      const playerName = ((el.querySelector('#inp-name') as HTMLInputElement).value).trim().slice(0, 40);\n      const packIdx    = parseInt(selPack.value);\n      const setIdx     = parseInt(selChars.value);\n      startGame(packs[packIdx]!, sets[setIdx]!, playerName);\n    });\n  }\n\n  el.querySelector('#btn-back')?.addEventListener('click', () => _nav('home'));\n}\n\n// \u2500\u2500 Helpers \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction ruWord(n: number, one: string, few: string, many: string): string {\n  const m = n % 100;\n  if (m >= 11 && m <= 14) return many;\n  switch (n % 10) {\n    case 1:  return one;\n    case 2: case 3: case 4: return few;\n    default: return many;\n  }\n}\n\n// \u2500\u2500 Game Init \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction shuffle<T>(arr: T[]): T[] {\n  const a = [...arr];\n  for (let i = a.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [a[i], a[j]] = [a[j]!, a[i]!];\n  }\n  return a;\n}\n\nfunction startGame(pack: QuestionPack, characterSet: CharacterSet, playerName: string): void {\n  const sortedChars = [...characterSet.characters].sort((a, b) => a.cost - b.cost);\n  const allShuffled = shuffle(pack.questions);\n  const maxCost    = sortedChars.at(-1)?.cost ?? 0;\n  const minNeeded  = Math.ceil(maxCost / pack.starsPerCorrect);\n  const hasExtra   = pack.questions.length > sortedChars.length;\n  const questions  = hasExtra ? allShuffled.slice(0, minNeeded) : allShuffled;\n  const spares     = hasExtra ? allShuffled.slice(minNeeded)    : [];\n  game = {\n    id: Date.now().toString(36) + Math.random().toString(36).slice(2, 6),\n    playerName,\n    pack,\n    characterSet: { ...characterSet, characters: sortedChars },\n    shuffledQuestions: questions,\n    spareQuestions: spares,\n    currentIndex: 0,\n    totalStars: 0,\n    unlockedUpTo: -1,\n  };\n  upsertSave(game);\n  _nav('game');\n  renderGameScreen();\n}\n\nexport function resumeGame(id: string): void {\n  const slot = loadSaves().find(s => s.id === id);\n  if (!slot) return;\n  game = slot.state;\n  game.spareQuestions ??= [];\n  _nav('game');\n  renderGameScreen();\n}\n\n// \u2500\u2500 Game Screen \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction renderGameScreen(): void {\n  if (!game) return;\n\n  boardApi = null;\n  boardMoveIdx = 0;\n  navChess = null;\n  if (navKeyHandler) { document.removeEventListener('keydown', navKeyHandler); navKeyHandler = null; }\n\n  const el    = document.getElementById('screen-game')!;\n  const chars = game.characterSet.characters;\n  const cur   = game.unlockedUpTo >= 0 ? (chars[game.unlockedUpTo] ?? null) : null;\n  const next  = chars[game.unlockedUpTo + 1] ?? null;\n  const q     = game.shuffledQuestions[game.currentIndex]!;\n\n\n  const img = (url?: string, cls = '') => {\n    const safe = url ? sanitizeImageUrl(url) : '';\n    return safe ? `<img src=\"${safe}\" alt=\"\" class=\"${cls}\" />` : null;\n  };\n\n  // \u2500\u2500 helpers for character cards (used in both layouts) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n  const renderCharImg = (c: typeof cur, grayscale = false) => {\n    if (!c) return `<span class=\"text-5xl opacity-30\">\uD83D\uDD12</span>`;\n    const s = c.imageUrl ? sanitizeImageUrl(c.imageUrl) : '';\n    return s\n      ? `<img src=\"${s}\" alt=\"\" class=\"w-full h-full object-contain${grayscale ? ' grayscale' : ''}\" />`\n      : `<span class=\"text-5xl\">\uD83D\uDC64</span>`;\n  };\n  const renderCharMeta = (c: typeof cur, muted = false) =>\n    c ? `<div class=\"text-xs font-semibold text-center truncate w-full${muted ? ' text-gray-400' : ''}\">${escapeHtml(c.name)}</div>\n         <div class=\"text-yellow-400 text-xs${muted ? ' opacity-60' : ''}\">\u2605 ${c.cost}</div>`\n      : `<div class=\"text-xs text-gray-600 text-center\">\u2014</div>`;\n  // Container class: solid bg for real characters, dashed outline for locked\n  const charBoxCls = (c: typeof cur) => c\n    ? 'w-[160px] h-[160px] rounded-xl overflow-hidden bg-gray-800 flex items-center justify-center flex-shrink-0'\n    : 'w-[160px] h-[160px] rounded-xl border-2 border-dashed border-gray-700 flex items-center justify-center flex-shrink-0';\n\n  const bottomControls = (h: string) => `\n    <button id=\"btn-all-chars\"\n      class=\"w-full ${h} bg-gray-800 hover:bg-gray-700 text-white rounded-xl font-semibold transition border border-gray-700 hover:border-gray-500 flex items-center justify-center gap-2 text-sm\">\n      <span>\uD83C\uDFC5</span> \u0412\u0441\u0435 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0438\n    </button>\n    <div class=\"flex gap-2\">\n      <div class=\"relative flex-1 ${h} rounded-xl overflow-hidden bg-gray-800 border border-gray-700\">\n        <div class=\"absolute inset-0 bg-gradient-to-r from-indigo-600 to-violet-600 transition-all duration-500\"\n             style=\"width:${Math.round(((game!.currentIndex + 1) / game!.shuffledQuestions.length) * 100)}%\"></div>\n        <span class=\"absolute inset-0 flex items-center justify-center text-sm font-semibold text-white drop-shadow\">\n          ${game!.currentIndex + 1} / ${game!.shuffledQuestions.length}\n        </span>\n      </div>\n      <button id=\"btn-exit\"\n        class=\"${h} px-4 bg-gray-800 hover:bg-red-950 text-gray-300 hover:text-red-300 rounded-xl font-semibold text-sm transition border border-gray-700 hover:border-red-800 flex-shrink-0\">\n        \u0412\u044B\u0445\u043E\u0434\n      </button>\n    </div>`;\n\n  if (q.fen) {\n    // \u2500\u2500 CHESS LAYOUT: centered board + panel (CVT-style) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    el.innerHTML = `\n      <div class=\"h-screen flex items-center justify-center bg-gray-950 overflow-hidden\"\n           style=\"--sz:min(calc(100vh - 24px),calc(100vw - 400px),780px)\">\n        <div class=\"flex gap-4\">\n\n          <!-- Board -->\n          <div id=\"board-container\"\n               class=\"rounded-xl shadow-2xl overflow-hidden flex-shrink-0\"\n               style=\"width:var(--sz);height:var(--sz)\">\n          </div>\n\n          <!-- Panel: same height as board -->\n          <div class=\"w-[360px] flex-shrink-0 bg-gray-900 rounded-xl border border-gray-800 flex flex-col overflow-hidden\"\n               style=\"height:var(--sz)\">\n\n            <!-- Question text -->\n            <div class=\"px-4 py-4 border-b border-gray-800 flex-shrink-0\">\n              <div class=\"text-lg font-semibold text-center leading-snug\">\n                ${escapeHtml(q.text)}\n              </div>\n            </div>\n\n            <!-- Characters: column -->\n            <div class=\"flex-1 min-h-0 flex flex-col items-center justify-evenly px-6 py-2 overflow-hidden\">\n              <div class=\"flex flex-col items-center gap-1 w-full\">\n                <div class=\"${charBoxCls(cur)}\">\n                  ${renderCharImg(cur)}\n                </div>\n                ${renderCharMeta(cur)}\n              </div>\n              <div class=\"text-gray-600 text-base\">\u2193</div>\n              <div class=\"flex flex-col items-center gap-1 w-full\">\n                <div class=\"${charBoxCls(next)}\">\n                  ${next ? renderCharImg(next, true) : `<span class=\"text-3xl\">\uD83C\uDFC6</span>`}\n                </div>\n                ${next ? renderCharMeta(next, true) : `<div class=\"text-xs text-gray-500 text-center\">\u0424\u0438\u043D\u0430\u043B!</div>`}\n              </div>\n            </div>\n\n            <!-- Bottom: controls + nav -->\n            <div class=\"px-4 py-3 border-t border-gray-800 flex-shrink-0 space-y-2 relative\">\n              <div id=\"nav-lock-indicator\" class=\"hidden absolute -top-5 left-0 right-0 text-xs text-yellow-500 text-center\">\uD83D\uDD12 \u0417\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u043E</div>\n              <div class=\"flex items-center gap-1.5\">\n                ${q.solutionMovesUci && q.solutionMovesUci.length > 0 ? `\n                <button id=\"btn-nav-prev\" class=\"flex-1 h-12 bg-gray-800 hover:bg-gray-700 text-white rounded-xl text-2xl transition flex items-center justify-center disabled:opacity-30\">\u2039</button>\n                <button id=\"btn-nav-next\" class=\"flex-1 h-12 bg-gray-800 hover:bg-gray-700 text-white rounded-xl text-2xl transition flex items-center justify-center disabled:opacity-30\">\u203A</button>\n                ` : ''}\n                <button id=\"btn-correct\" class=\"flex-1 h-12 bg-gray-800 hover:bg-gray-700 text-green-400 rounded-xl text-2xl transition flex items-center justify-center disabled:opacity-30\">\u2714</button>\n                <button id=\"btn-wrong\"   class=\"flex-1 h-12 bg-gray-800 hover:bg-gray-700 text-red-400   rounded-xl text-2xl transition flex items-center justify-center disabled:opacity-30\">\u2715</button>\n              </div>\n              ${bottomControls('h-10')}\n            </div>\n\n          </div>\n        </div>\n      </div>`;\n\n  } else {\n    // \u2500\u2500 NON-CHESS LAYOUT: image + panel (mirrors chess layout) \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n    el.innerHTML = `\n      <div class=\"h-screen flex items-center justify-center bg-gray-950 overflow-hidden\"\n           style=\"--sz:min(calc(100vh - 24px),calc(100vw - 400px),780px)\">\n        <div class=\"flex gap-4\">\n\n          <!-- Image (mirrors board position) -->\n          <div class=\"rounded-xl shadow-2xl overflow-hidden flex-shrink-0 bg-gray-900 flex items-center justify-center\"\n               style=\"width:var(--sz);height:var(--sz)\">\n            ${img(q.imageUrl, 'max-w-full max-h-full object-contain')\n              ?? `<div class=\"text-center p-8 text-3xl font-bold text-white leading-snug\">${escapeHtml(q.text)}</div>`}\n          </div>\n\n          <!-- Panel: same structure as chess panel -->\n          <div class=\"w-[360px] flex-shrink-0 bg-gray-900 rounded-xl border border-gray-800 flex flex-col overflow-hidden\"\n               style=\"height:var(--sz)\">\n\n            <!-- Question text + show-answer / answer -->\n            <div class=\"px-4 py-4 border-b border-gray-800 flex-shrink-0 flex flex-col gap-3\">\n              <div class=\"text-lg font-semibold text-center leading-snug\">\n                ${escapeHtml(q.text)}\n              </div>\n              <button id=\"btn-show-answer\"\n                class=\"w-full py-2.5 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold text-sm transition\">\n                \u041F\u043E\u043A\u0430\u0437\u0430\u0442\u044C \u043E\u0442\u0432\u0435\u0442\n              </button>\n              <div id=\"answer-block\" class=\"hidden\">\n                <div class=\"bg-gray-800 border border-gray-700 rounded-xl p-3 text-center\">\n                  <div class=\"text-xs text-gray-400 uppercase tracking-wider mb-1\">\u041E\u0442\u0432\u0435\u0442</div>\n                  <div class=\"text-base font-bold text-green-400\">${escapeHtml(q.answer ?? '')}</div>\n                </div>\n              </div>\n            </div>\n\n            <!-- Characters: column -->\n            <div class=\"flex-1 min-h-0 flex flex-col items-center justify-evenly px-6 py-2 overflow-hidden\">\n              <div class=\"flex flex-col items-center gap-1 w-full\">\n                <div class=\"${charBoxCls(cur)}\">\n                  ${renderCharImg(cur)}\n                </div>\n                ${renderCharMeta(cur)}\n              </div>\n              <div class=\"text-gray-600 text-base\">\u2193</div>\n              <div class=\"flex flex-col items-center gap-1 w-full\">\n                <div class=\"${charBoxCls(next)}\">\n                  ${next ? renderCharImg(next, true) : `<span class=\"text-3xl\">\uD83C\uDFC6</span>`}\n                </div>\n                ${next ? renderCharMeta(next, true) : `<div class=\"text-xs text-gray-500 text-center\">\u0424\u0438\u043D\u0430\u043B!</div>`}\n              </div>\n            </div>\n\n            <!-- Bottom: controls -->\n            <div class=\"px-4 py-3 border-t border-gray-800 flex-shrink-0 space-y-2 relative\">\n              <div id=\"nav-lock-indicator\" class=\"hidden absolute -top-5 left-0 right-0 text-xs text-yellow-500 text-center\">\uD83D\uDD12 \u0417\u0430\u0431\u043B\u043E\u043A\u0438\u0440\u043E\u0432\u0430\u043D\u043E</div>\n              <div id=\"answer-buttons\" class=\"hidden items-center gap-1.5\">\n                <button id=\"btn-correct\" class=\"flex-1 h-12 bg-gray-800 hover:bg-gray-700 text-green-400 rounded-xl text-2xl transition flex items-center justify-center disabled:opacity-30\">\u2714</button>\n                <button id=\"btn-wrong\"   class=\"flex-1 h-12 bg-gray-800 hover:bg-gray-700 text-red-400   rounded-xl text-2xl transition flex items-center justify-center disabled:opacity-30\">\u2715</button>\n              </div>\n              ${bottomControls('h-10')}\n            </div>\n\n          </div>\n        </div>\n      </div>`;\n  }\n\n  // Mount chess board if question has FEN\n  if (q.fen) {\n    const container = el.querySelector('#board-container') as HTMLElement;\n    boardApi = mountBoard(container, q.fen, q.boardOrientation ?? 'white');\n    navChess = new Chess(q.fen);\n    if (navChess.inCheck()) {\n      boardApi.set({ check: navChess.turn() === 'w' ? 'white' : 'black' });\n    }\n  }\n\n  // Navigation helpers (solution replay via chess.js)\n  const totalPositions = (q.solutionMovesUci?.length ?? 0) + 1; // start + one per move\n\n  let navLocked = false;\n\n  const updateNavDisplay = () => {\n    const pos = el.querySelector('#nav-pos');\n    if (pos) pos.textContent = `${boardMoveIdx + 1} / ${totalPositions}`;\n    (el.querySelector('#btn-nav-prev') as HTMLButtonElement | null)?.toggleAttribute('disabled', navLocked || boardMoveIdx <= 0);\n    (el.querySelector('#btn-nav-next') as HTMLButtonElement | null)?.toggleAttribute('disabled', navLocked || boardMoveIdx >= totalPositions - 1);\n  };\n\n  const setNavLock = (locked: boolean) => {\n    navLocked = locked;\n    updateNavDisplay();\n    (el.querySelector('#btn-correct') as HTMLButtonElement | null)?.toggleAttribute('disabled', locked);\n    (el.querySelector('#btn-wrong')   as HTMLButtonElement | null)?.toggleAttribute('disabled', locked);\n    el.querySelector('#nav-lock-indicator')?.classList.toggle('hidden', !locked);\n  };\n\n  const applyBoardMove = (targetIdx: number) => {\n    if (!boardApi || !navChess || !q.solutionMovesUci) return;\n    targetIdx = Math.max(0, Math.min(targetIdx, q.solutionMovesUci.length));\n    if (targetIdx < boardMoveIdx) {\n      for (let i = boardMoveIdx; i > targetIdx; i--) navChess.undo();\n    } else {\n      for (let i = boardMoveIdx; i < targetIdx; i++) {\n        const uci = q.solutionMovesUci[i]!;\n        navChess.move({ from: uci.slice(0, 2), to: uci.slice(2, 4), promotion: uci[4] });\n      }\n    }\n    boardMoveIdx = targetIdx;\n    const lastUci = boardMoveIdx > 0 ? q.solutionMovesUci[boardMoveIdx - 1]! : null;\n    const lm: Key[] | undefined = lastUci\n      ? [lastUci.slice(0, 2) as Key, lastUci.slice(2, 4) as Key]\n      : undefined;\n    const inCheck = navChess.inCheck() ? (navChess.turn() === 'w' ? 'white' : 'black') : false;\n    boardApi.set({ fen: navChess.fen(), lastMove: lm, check: inCheck });\n    updateNavDisplay();\n  };\n\n  if (q.solutionMovesUci && q.solutionMovesUci.length > 0) {\n    el.querySelector('#btn-nav-prev')?.addEventListener('click', () => applyBoardMove(boardMoveIdx - 1));\n    el.querySelector('#btn-nav-next')?.addEventListener('click', () => applyBoardMove(boardMoveIdx + 1));\n  }\n\n  navKeyHandler = (e: KeyboardEvent) => {\n    if ((e.key === 'l' || e.key === 'L' || e.key === '\u0434' || e.key === '\u0414') && !e.ctrlKey && !e.metaKey && !e.altKey) {\n      setNavLock(!navLocked);\n    }\n  };\n  document.addEventListener('keydown', navKeyHandler);\n\n  // Events\n  el.querySelector('#btn-show-answer')?.addEventListener('click', () => {\n    el.querySelector('#btn-show-answer')?.classList.add('hidden');\n    el.querySelector('#answer-block')?.classList.remove('hidden');\n    const ab = el.querySelector('#answer-buttons') as HTMLElement | null;\n    if (ab) { ab.classList.remove('hidden'); ab.classList.add('flex'); }\n  });\n\n  el.querySelector('#btn-correct')?.addEventListener('click', () => handleAnswer(true));\n  el.querySelector('#btn-wrong')?.addEventListener('click', () => handleAnswer(false));\n\n  el.querySelector('#btn-all-chars')?.addEventListener('click', () => showAllCharactersOverlay());\n\n  el.querySelector('#btn-exit')?.addEventListener('click', () => {\n    showModal('\u0412\u044B\u0439\u0442\u0438 \u0438\u0437 \u0438\u0433\u0440\u044B? \u041F\u0440\u043E\u0433\u0440\u0435\u0441\u0441 \u0441\u043E\u0445\u0440\u0430\u043D\u0451\u043D.', () => {\n      if (navKeyHandler) { document.removeEventListener('keydown', navKeyHandler); navKeyHandler = null; }\n      _nav('home');\n    });\n  });\n\n}\n\n// \u2500\u2500 All Characters Overlay \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction showAllCharactersOverlay(): void {\n  if (!game) return;\n\n  document.getElementById('all-chars-overlay')?.remove();\n\n  const chars   = game.characterSet.characters;\n  const maxCost = chars[chars.length - 1]?.cost ?? 0;\n\n  const overlay = document.createElement('div');\n  overlay.id = 'all-chars-overlay';\n  overlay.className =\n    'fixed inset-0 bg-black/75 backdrop-blur-sm flex items-center justify-center z-50 p-4';\n\n  const imgTag = (url: string | undefined, unlocked: boolean) => {\n    const safe = url ? sanitizeImageUrl(url) : '';\n    const cls  = `w-24 h-24 object-contain rounded-xl mb-2 ${unlocked ? '' : 'grayscale opacity-30'}`;\n    const fallbackCls = `w-24 h-24 rounded-xl mb-2 flex items-center justify-center text-4xl\n      ${unlocked ? 'bg-gray-700' : 'bg-gray-800 opacity-30'}`;\n    return safe\n      ? `<img src=\"${safe}\" alt=\"\" class=\"${cls}\" />`\n      : `<div class=\"${fallbackCls}\">${unlocked ? '\uD83D\uDC64' : '\uD83D\uDD12'}</div>`;\n  };\n\n  overlay.innerHTML = `\n    <div class=\"bg-gray-900 border border-gray-800 rounded-2xl w-full max-w-4xl shadow-2xl flex flex-col max-h-[85vh]\">\n\n      <!-- Header -->\n      <div class=\"flex items-center justify-between px-5 py-4 border-b border-gray-800\">\n        <div>\n          <div class=\"font-bold text-lg\">\u0412\u0441\u0435 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0438</div>\n          <div class=\"text-xs text-gray-400 mt-0.5\">\n            \u041D\u0430\u0431\u0440\u0430\u043D\u043E: <span class=\"text-yellow-400 font-bold\">\u2605 ${game.totalStars}</span>\n            &nbsp;\u00B7&nbsp;\n            \u0414\u043B\u044F \u0432\u0441\u0435\u0445: <span class=\"text-gray-300 font-semibold\">\u2605 ${maxCost}</span>\n          </div>\n        </div>\n        <button id=\"btn-close-overlay\"\n          class=\"text-gray-400 hover:text-white text-2xl leading-none transition w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-800\">\n          \u00D7\n        </button>\n      </div>\n\n      <!-- Overall progress bar -->\n      <div class=\"px-5 py-3 border-b border-gray-800\">\n        <div class=\"flex justify-between text-xs text-gray-500 mb-1.5\">\n          <span>\u041E\u0431\u0449\u0438\u0439 \u043F\u0440\u043E\u0433\u0440\u0435\u0441\u0441</span>\n          <span>${Math.round(Math.min(100, (game.totalStars / (maxCost || 1)) * 100))}%</span>\n        </div>\n        <div class=\"w-full bg-gray-700 rounded-full h-2.5 overflow-hidden\">\n          <div class=\"bg-yellow-400 h-2.5 rounded-full transition-all\"\n            style=\"width:${Math.min(100, (game.totalStars / (maxCost || 1)) * 100)}%\"></div>\n        </div>\n      </div>\n\n      <!-- Characters grid -->\n      <div class=\"grid grid-cols-4 gap-4 p-5 overflow-y-auto flex-1\">\n        ${chars.map((c, i) => {\n          const unlocked = i <= game!.unlockedUpTo;\n          return `\n            <div class=\"flex flex-col items-center rounded-xl p-3\n              ${unlocked\n                ? 'bg-gray-800 border border-gray-700'\n                : 'bg-gray-900 border border-gray-800'}\">\n              ${imgTag(c.imageUrl, unlocked)}\n              <div class=\"text-xs font-semibold text-center leading-tight\n                ${unlocked ? 'text-white' : 'text-gray-600'}\">\n                ${escapeHtml(c.name)}\n              </div>\n              <div class=\"text-xs mt-1 ${unlocked ? 'text-yellow-400' : 'text-gray-700'}\">\n                ${unlocked ? '\u2713' : '\uD83D\uDD12'} \u2605 ${c.cost}\n              </div>\n            </div>\n          `;\n        }).join('')}\n      </div>\n\n    </div>\n  `;\n\n  document.body.appendChild(overlay);\n\n  const closeOverlay = () => { overlay.remove(); };\n  overlay.querySelector('#btn-close-overlay')?.addEventListener('click', closeOverlay);\n  overlay.addEventListener('click', e => { if (e.target === overlay) closeOverlay(); });\n}\n\n// \u2500\u2500 Timer \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n// \u2500\u2500 Answer Handling \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction handleAnswer(correct: boolean): void {\n  if (!game) return;\n  // Prevent double-click\n  (document.getElementById('btn-correct') as HTMLButtonElement | null)?.toggleAttribute('disabled', true);\n  (document.getElementById('btn-wrong')   as HTMLButtonElement | null)?.toggleAttribute('disabled', true);\n\n  if (correct) {\n    game.totalStars += game.pack.starsPerCorrect;\n\n    const chars = game.characterSet.characters;\n    let justUnlocked: Character | null = null;\n    while (\n      game.unlockedUpTo + 1 < chars.length &&\n      game.totalStars >= chars[game.unlockedUpTo + 1]!.cost\n    ) {\n      game.unlockedUpTo++;\n      justUnlocked = chars[game.unlockedUpTo]!;\n    }\n\n    upsertSave(game);\n\n    if (justUnlocked) {\n      const allUnlocked = game.unlockedUpTo >= chars.length - 1;\n      const onContinue  = allUnlocked\n        ? () => { game!.currentIndex++; deleteSave(game!.id); renderResults(); _nav('results'); }\n        : () => advanceQuestion();\n      showUnlockOverlay(justUnlocked, onContinue);\n      return;\n    }\n  }\n\n  advanceQuestion();\n}\n\nfunction showUnlockOverlay(char: Character, onContinue: () => void): void {\n  const overlay = document.createElement('div');\n  overlay.className =\n    'fixed inset-0 bg-black/85 backdrop-blur-md flex items-center justify-center z-50';\n\n  const safeUrl = char.imageUrl ? sanitizeImageUrl(char.imageUrl) : '';\n\n  overlay.innerHTML = `\n    <div class=\"text-center px-6\">\n      <div class=\"text-6xl mb-4\">\uD83C\uDF89</div>\n      <div class=\"text-yellow-400 text-3xl font-black mb-4\">\u041D\u043E\u0432\u044B\u0439 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436!</div>\n      ${safeUrl\n        ? `<img src=\"${safeUrl}\" alt=\"${escapeHtml(char.name)}\"\n             class=\"w-36 h-36 object-contain mx-auto mb-4 rounded-2xl\" />`\n        : `<div class=\"w-36 h-36 bg-gray-700 rounded-2xl mx-auto mb-4 flex items-center justify-center text-6xl\">\u2B50</div>`}\n      <div class=\"text-3xl font-bold text-white mb-1\">${escapeHtml(char.name)}</div>\n      <div class=\"text-gray-400 text-sm mb-8\">\u041E\u0442\u043A\u0440\u044B\u0442 \u0437\u0430 ${char.cost} \u0437\u0432\u0451\u0437\u0434</div>\n      <button id=\"btn-unlock-ok\"\n        class=\"py-3 px-12 bg-yellow-500 hover:bg-yellow-400 text-black font-bold rounded-2xl text-lg transition\">\n        \u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C\n      </button>\n    </div>\n  `;\n\n  document.body.appendChild(overlay);\n  overlay.querySelector('#btn-unlock-ok')?.addEventListener('click', () => {\n    overlay.remove();\n    onContinue();\n  });\n}\n\nfunction advanceQuestion(): void {\n  if (!game) return;\n  game.currentIndex++;\n\n  if (game.currentIndex >= game.shuffledQuestions.length) {\n    const allUnlocked = game.unlockedUpTo >= game.characterSet.characters.length - 1;\n    if (!allUnlocked && game.spareQuestions.length > 0) {\n      // \u0414\u043E\u0431\u0438\u0440\u0430\u0435\u043C \u043E\u0434\u043D\u0443 \u0441\u043B\u0443\u0447\u0430\u0439\u043D\u0443\u044E \u0437\u0430\u0434\u0430\u0447\u0443 \u0438\u0437 \u0437\u0430\u043F\u0430\u0441\u043D\u043E\u0433\u043E \u043F\u0443\u043B\u0430\n      const spare = game.spareQuestions.shift();\n      if (spare) game.shuffledQuestions.push(spare);\n    } else {\n      deleteSave(game.id);\n      renderResults();\n      _nav('results');\n      return;\n    }\n  }\n\n  upsertSave(game);\n  renderGameScreen();\n}\n\n// \u2500\u2500 Results Screen \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction renderResults(): void {\n  if (!game) return;\n  if (navKeyHandler) { document.removeEventListener('keydown', navKeyHandler); navKeyHandler = null; }\n\n  const el        = document.getElementById('screen-results')!;\n  const chars     = game.characterSet.characters;\n  const unlocked  = game.unlockedUpTo >= 0 ? chars.slice(0, game.unlockedUpTo + 1) : [];\n  const finalChar = game.unlockedUpTo >= 0 ? (chars[game.unlockedUpTo] ?? null) : null;\n\n  const imgTag = (url: string | undefined, cls: string) => {\n    const safe = url ? sanitizeImageUrl(url) : '';\n    return safe\n      ? `<img src=\"${safe}\" alt=\"\" class=\"${cls}\" />`\n      : `<div class=\"${cls} bg-gray-700 flex items-center justify-center text-4xl\">\u2B50</div>`;\n  };\n\n  el.innerHTML = `\n    <div class=\"min-h-screen flex flex-col items-center justify-center p-6 bg-gray-950\">\n      <div class=\"text-6xl mb-3\">\uD83C\uDFC6</div>\n      <h1 class=\"text-3xl font-black text-yellow-400 mb-1\">\u0418\u0433\u0440\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043D\u0430!</h1>\n      <div class=\"text-gray-400 mb-8 text-sm\">\n        ${game.currentIndex} / ${game.shuffledQuestions.length} \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432 \u00B7 ${game.totalStars} \u0437\u0432\u0451\u0437\u0434 \u043D\u0430\u0431\u0440\u0430\u043D\u043E\n      </div>\n\n      <div class=\"bg-gray-900 border border-gray-800 rounded-2xl p-6 text-center w-full max-w-xs mb-6\">\n        <div class=\"text-xs text-gray-400 uppercase tracking-wider mb-3\">\u0424\u0438\u043D\u0430\u043B\u044C\u043D\u044B\u0439 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436</div>\n        ${finalChar\n          ? `${imgTag(finalChar.imageUrl, 'w-32 h-32 object-contain mx-auto mb-3 rounded-xl')}\n             <div class=\"text-2xl font-bold\">${escapeHtml(finalChar.name)}</div>`\n          : `<div class=\"w-32 h-32 bg-gray-800 rounded-xl mx-auto mb-3 flex items-center justify-center text-5xl\">\uD83D\uDE14</div>\n             <div class=\"text-xl font-bold text-gray-500\">\u041D\u0438 \u043E\u0434\u043D\u043E\u0433\u043E \u043D\u0435 \u043E\u0442\u043A\u0440\u044B\u0442\u043E</div>`}\n        <div class=\"text-yellow-400 mt-1 text-sm\">\u2605 ${game.totalStars}</div>\n      </div>\n\n      ${unlocked.length > 1 ? `\n        <div class=\"w-full max-w-md mb-8\">\n          <div class=\"text-xs text-gray-500 uppercase tracking-wider text-center mb-3\">\n            \u041E\u0442\u043A\u0440\u044B\u0442\u043E: ${unlocked.length} / ${chars.length}\n          </div>\n          <div class=\"flex flex-wrap gap-2 justify-center\">\n            ${unlocked.map(c => `\n              <div class=\"flex flex-col items-center bg-gray-900 border border-gray-800 rounded-xl p-2 w-20\">\n                ${imgTag(c.imageUrl, 'w-12 h-12 object-contain rounded-lg')}\n                <div class=\"text-xs text-center text-gray-300 mt-1 leading-tight\">${escapeHtml(c.name)}</div>\n              </div>\n            `).join('')}\n          </div>\n        </div>\n      ` : ''}\n\n      <button id=\"btn-home\"\n        class=\"py-3 px-10 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl font-bold text-lg transition\">\n        \u041D\u0430 \u0433\u043B\u0430\u0432\u043D\u0443\u044E\n      </button>\n    </div>\n  `;\n\n  el.querySelector('#btn-home')?.addEventListener('click', () => {\n    game = null;\n    _nav('home');\n  });\n}\n", "import type { QuestionPack, Question, CharacterSet, Character, Screen } from './types';\nimport { escapeHtml, sanitizeImageUrl, showModal, downloadJson } from './utils';\nimport { loadPacks, savePacks, loadCharacterSets, saveCharacterSets } from './storage';\n\nlet _nav: (s: Screen) => void = () => { /* no-op */ };\n\nexport function setNav(fn: (s: Screen) => void): void {\n  _nav = fn;\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// PACK EDITOR\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\ninterface PackState {\n  packs: QuestionPack[];\n  view: 'list' | 'edit';\n  editIdx: number;       // -1 = new\n  pack: QuestionPack;\n  expandedQ: number;     // -1 = none\n}\n\nlet ps: PackState = newPackState();\n\nfunction newPackState(): PackState {\n  return {\n    packs: [],\n    view: 'list',\n    editIdx: -1,\n    pack: { title: '', questions: [], starsPerCorrect: 3 },\n    expandedQ: -1,\n  };\n}\n\nexport function renderPackEditor(el: HTMLElement): void {\n  ps = newPackState();\n  ps.packs = loadPacks();\n  drawPack(el);\n}\n\nfunction drawPack(el: HTMLElement): void {\n  if (ps.view === 'list') drawPackList(el);\n  else drawPackEdit(el);\n}\n\n// \u2500\u2500 Pack List \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction drawPackList(el: HTMLElement): void {\n  el.innerHTML = `\n    <div class=\"min-h-screen flex flex-col bg-gray-950\">\n\n      <div class=\"flex items-center gap-3 px-5 py-4 bg-gray-900 border-b border-gray-800\">\n        <button id=\"pe-back\" class=\"text-gray-400 hover:text-white transition text-sm\">\u2190 \u041D\u0430\u0437\u0430\u0434</button>\n        <h1 class=\"text-xl font-bold flex-1\">\u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432</h1>\n        <label class=\"cursor-pointer text-sm text-indigo-400 hover:text-indigo-300 transition\">\n          \u0418\u043C\u043F\u043E\u0440\u0442\n          <input id=\"pe-import\" type=\"file\" accept=\".json\" class=\"hidden\" />\n        </label>\n        <button id=\"pe-new\" class=\"py-2 px-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl text-sm font-semibold transition\">\n          + \u041D\u043E\u0432\u044B\u0439 \u043F\u0430\u043A\u0435\u0442\n        </button>\n      </div>\n\n      <div class=\"flex-1 p-4 max-w-2xl mx-auto w-full\">\n        ${ps.packs.length === 0\n          ? `<div class=\"text-gray-500 text-center mt-20 text-sm\">\u041D\u0435\u0442 \u043F\u0430\u043A\u0435\u0442\u043E\u0432. \u0421\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u043F\u0435\u0440\u0432\u044B\u0439!</div>`\n          : ps.packs.map((p, i) => `\n            <div class=\"bg-gray-900 border border-gray-800 rounded-xl px-4 py-3 flex items-center gap-3 mb-2\">\n              <div class=\"flex-1 min-w-0\">\n                <div class=\"font-semibold truncate\">${escapeHtml(p.title)}</div>\n                <div class=\"text-xs text-gray-400\">${p.questions.length} \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432 \u00B7 ${p.starsPerCorrect}\u2605 \u0437\u0430 \u043E\u0442\u0432\u0435\u0442</div>\n              </div>\n              <button data-edit=\"${i}\" class=\"text-sm text-indigo-400 hover:text-indigo-300 transition\">\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C</button>\n              <button data-copy=\"${i}\" class=\"text-sm text-green-400 hover:text-green-300 transition\">\u041A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u0442\u044C</button>\n              <button data-export=\"${i}\" class=\"text-sm text-gray-400 hover:text-gray-300 transition\">\u042D\u043A\u0441\u043F\u043E\u0440\u0442</button>\n              <button data-del=\"${i}\" class=\"text-sm text-red-400 hover:text-red-300 transition\">\u0423\u0434\u0430\u043B\u0438\u0442\u044C</button>\n            </div>\n          `).join('')}\n      </div>\n\n    </div>\n  `;\n\n  el.querySelector('#pe-back')?.addEventListener('click', () => _nav('home'));\n\n  el.querySelector('#pe-new')?.addEventListener('click', () => {\n    ps.editIdx = -1;\n    ps.pack = { title: '', questions: [], starsPerCorrect: 3 };\n    ps.view = 'edit';\n    ps.expandedQ = -1;\n    drawPack(el);\n  });\n\n  el.querySelector('#pe-import')?.addEventListener('change', e => {\n    const file = (e.target as HTMLInputElement).files?.[0];\n    if (!file) return;\n    const reader = new FileReader();\n    reader.onload = ev => {\n      try {\n        const data = JSON.parse(ev.target?.result as string);\n        if (\n          !data.title ||\n          !Array.isArray(data.questions) ||\n          typeof data.starsPerCorrect !== 'number' ||\n          !data.questions.every((q: unknown) => {\n            const qq = q as Record<string, unknown>;\n            return qq && typeof qq['text'] === 'string' &&\n              (qq['answer'] === undefined || typeof qq['answer'] === 'string');\n          })\n        ) throw new Error();\n        ps.packs.push(data as QuestionPack);\n        savePacks(ps.packs);\n        drawPackList(el);\n      } catch {\n        showModal('\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0444\u043E\u0440\u043C\u0430\u0442 \u0444\u0430\u0439\u043B\u0430');\n      }\n    };\n    reader.readAsText(file);\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-edit]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const i = parseInt(btn.dataset['edit']!);\n      ps.editIdx = i;\n      ps.pack = structuredClone(ps.packs[i]);\n      ps.view = 'edit';\n      ps.expandedQ = -1;\n      drawPack(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-export]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const i = parseInt(btn.dataset['export']!);\n      downloadJson(ps.packs[i]!, `${ps.packs[i]!.title || 'pack'}.json`);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-del]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const i = parseInt(btn.dataset['del']!);\n      showModal(`\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0430\u043A\u0435\u0442 \u00AB${escapeHtml(ps.packs[i]!.title)}\u00BB?`, () => {\n        ps.packs.splice(i, 1);\n        savePacks(ps.packs);\n        drawPackList(el);\n      });\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-copy]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const i = parseInt(btn.dataset['copy']!);\n      const copy: QuestionPack = structuredClone(ps.packs[i]);\n      copy.title += ' (\u043A\u043E\u043F\u0438\u044F)';\n      ps.packs.push(copy);\n      savePacks(ps.packs);\n      drawPackList(el);\n    });\n  });\n}\n\n// \u2500\u2500 Pack Edit \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction drawPackEdit(el: HTMLElement): void {\n  const p = ps.pack;\n  el.innerHTML = `\n    <div class=\"min-h-screen flex flex-col bg-gray-950\">\n\n      <div class=\"flex items-center gap-3 px-5 py-4 bg-gray-900 border-b border-gray-800\">\n        <button id=\"pe-edit-back\" class=\"text-gray-400 hover:text-white transition text-sm\">\u2190 \u041D\u0430\u0437\u0430\u0434</button>\n        <h1 class=\"text-xl font-bold flex-1\">${ps.editIdx === -1 ? '\u041D\u043E\u0432\u044B\u0439 \u043F\u0430\u043A\u0435\u0442' : '\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043F\u0430\u043A\u0435\u0442'}</h1>\n        <button id=\"pe-save\" class=\"py-2 px-4 bg-green-700 hover:bg-green-600 text-white rounded-xl text-sm font-semibold transition\">\n          \u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C\n        </button>\n      </div>\n\n      <div class=\"flex-1 p-4 max-w-2xl mx-auto w-full space-y-4\">\n\n        <div class=\"bg-gray-900 border border-gray-800 rounded-xl p-4 space-y-3\">\n          <div>\n            <label class=\"text-xs text-gray-400 uppercase tracking-wider\">\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0430\u043A\u0435\u0442\u0430</label>\n            <input id=\"pe-title\" type=\"text\" value=\"${escapeHtml(p.title)}\" placeholder=\"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435...\"\n              class=\"w-full bg-gray-800 text-white rounded-xl px-4 py-2 mt-1 border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n          </div>\n          <div>\n            <label class=\"text-xs text-gray-400 uppercase tracking-wider\">\u0417\u0432\u0451\u0437\u0434 \u0437\u0430 \u043F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u044B\u0439 \u043E\u0442\u0432\u0435\u0442</label>\n            <input id=\"pe-stars\" type=\"number\" min=\"1\" max=\"100\" value=\"${p.starsPerCorrect}\"\n              class=\"w-full bg-gray-800 text-white rounded-xl px-4 py-2 mt-1 border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n          </div>\n        </div>\n\n        <div class=\"flex items-center justify-between\">\n          <div class=\"text-sm text-gray-400 uppercase tracking-wider font-semibold\">\u0412\u043E\u043F\u0440\u043E\u0441\u044B (${p.questions.length})</div>\n          <button id=\"pe-add-q\" class=\"py-1.5 px-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-sm font-semibold transition\">\n            + \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C\n          </button>\n        </div>\n\n        <div id=\"pe-qlist\">${renderQList(p.questions)}</div>\n\n        ${ps.editIdx !== -1 ? `\n          <button id=\"pe-del-pack\"\n            class=\"w-full py-3 rounded-xl font-semibold transition text-red-400 hover:text-red-300 border border-red-900 hover:bg-red-900/20\">\n            \u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0430\u043A\u0435\u0442\n          </button>\n        ` : ''}\n\n      </div>\n    </div>\n  `;\n\n  const titleEl = el.querySelector('#pe-title') as HTMLInputElement;\n  const starsEl = el.querySelector('#pe-stars') as HTMLInputElement;\n  titleEl.addEventListener('input', () => { ps.pack.title = titleEl.value; });\n  starsEl.addEventListener('input', () => { ps.pack.starsPerCorrect = Math.max(1, parseInt(starsEl.value) || 1); });\n\n  el.querySelector('#pe-edit-back')?.addEventListener('click', () => {\n    ps.view = 'list';\n    ps.packs = loadPacks();\n    drawPack(el);\n  });\n\n  el.querySelector('#pe-save')?.addEventListener('click', () => {\n    if (!ps.pack.title.trim()) { showModal('\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043F\u0430\u043A\u0435\u0442\u0430'); return; }\n    if (ps.editIdx === -1) ps.packs.push(ps.pack);\n    else ps.packs[ps.editIdx] = ps.pack;\n    savePacks(ps.packs);\n    ps.view = 'list';\n    drawPack(el);\n  });\n\n  el.querySelector('#pe-del-pack')?.addEventListener('click', () => {\n    showModal(`\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0430\u043A\u0435\u0442 \u00AB${escapeHtml(ps.pack.title)}\u00BB?`, () => {\n      ps.packs.splice(ps.editIdx, 1);\n      savePacks(ps.packs);\n      ps.view = 'list';\n      drawPack(el);\n    });\n  });\n\n  el.querySelector('#pe-add-q')?.addEventListener('click', () => {\n    ps.pack.questions.push({ text: '', answer: '' });\n    ps.expandedQ = ps.pack.questions.length - 1;\n    refreshQList(el);\n    setTimeout(() => {\n      el.querySelector(`[data-qrow=\"${ps.expandedQ}\"]`)?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n    }, 50);\n  });\n\n  bindQEvents(el);\n}\n\nfunction renderQList(questions: Question[]): string {\n  if (questions.length === 0)\n    return `<div class=\"text-gray-500 text-center py-8 text-sm\">\u041D\u0435\u0442 \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432. \u041D\u0430\u0436\u043C\u0438\u0442\u0435 \u00AB+ \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C\u00BB.</div>`;\n\n  return questions.map((q, i) => {\n    const open = ps.expandedQ === i;\n    return `\n      <div data-qrow=\"${i}\" class=\"bg-gray-900 border border-gray-800 rounded-xl mb-2 overflow-hidden\">\n        <div class=\"flex items-center gap-3 px-4 py-3 cursor-pointer select-none\" data-qtoggle=\"${i}\">\n          <div class=\"flex-1 min-w-0\">\n            <div class=\"text-sm font-medium truncate ${q.text ? 'text-white' : 'text-gray-500 italic'}\">\n              ${q.text ? escapeHtml(q.text) : '\u0411\u0435\u0437 \u0442\u0435\u043A\u0441\u0442\u0430'}\n            </div>\n            <div class=\"text-xs text-gray-400 truncate\">${q.answer ? escapeHtml(q.answer) : '\u0411\u0435\u0437 \u043E\u0442\u0432\u0435\u0442\u0430'}</div>\n          </div>\n          <div class=\"flex gap-0.5 flex-shrink-0\">\n            <button data-qup=\"${i}\" class=\"text-gray-400 hover:text-white transition px-2 py-1 text-sm\" title=\"\u0412\u0432\u0435\u0440\u0445\">\u2191</button>\n            <button data-qdn=\"${i}\" class=\"text-gray-400 hover:text-white transition px-2 py-1 text-sm\" title=\"\u0412\u043D\u0438\u0437\">\u2193</button>\n            <button data-qdel=\"${i}\" class=\"text-red-400 hover:text-red-300 text-sm transition px-2 py-1\">\u2715</button>\n          </div>\n          <span class=\"text-gray-600 text-sm flex-shrink-0\">${open ? '\u25B2' : '\u25BC'}</span>\n        </div>\n        ${open ? `\n          <div class=\"px-4 pb-4 pt-3 space-y-2 border-t border-gray-800\">\n            <div>\n              <label class=\"text-xs text-gray-400\">\u0412\u043E\u043F\u0440\u043E\u0441</label>\n              <textarea data-qtext=\"${i}\" rows=\"2\" placeholder=\"\u0422\u0435\u043A\u0441\u0442 \u0432\u043E\u043F\u0440\u043E\u0441\u0430...\"\n                class=\"w-full bg-gray-800 text-white rounded-lg px-3 py-2 mt-1 text-sm border border-gray-700 focus:outline-none focus:border-indigo-500 resize-none\">${escapeHtml(q.text)}</textarea>\n            </div>\n            <div>\n              <label class=\"text-xs text-gray-400\">\u041E\u0442\u0432\u0435\u0442</label>\n              <input data-qans=\"${i}\" type=\"text\" value=\"${escapeHtml(q.answer ?? '')}\" placeholder=\"\u041F\u0440\u0430\u0432\u0438\u043B\u044C\u043D\u044B\u0439 \u043E\u0442\u0432\u0435\u0442...\"\n                class=\"w-full bg-gray-800 text-white rounded-lg px-3 py-2 mt-1 text-sm border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n            </div>\n            <div>\n              <label class=\"text-xs text-gray-400\">\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 (URL, \u043D\u0435\u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E)</label>\n              <input data-qimg=\"${i}\" type=\"text\" value=\"${escapeHtml(q.imageUrl ?? '')}\" placeholder=\"https://...\"\n                class=\"w-full bg-gray-800 text-white rounded-lg px-3 py-2 mt-1 text-sm border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n            </div>\n            <div>\n              <label class=\"text-xs text-gray-400\">FEN \u043F\u043E\u0437\u0438\u0446\u0438\u044F (\u043D\u0435\u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E, \u0434\u043B\u044F \u0448\u0430\u0445\u043C\u0430\u0442)</label>\n              <input data-qfen=\"${i}\" type=\"text\" value=\"${escapeHtml(q.fen ?? '')}\" placeholder=\"rnbqkbnr/pppppppp/8/8/4P3/8/PPPP1PPP/RNBQKBNR b KQkq e3 0 1\"\n                class=\"w-full bg-gray-800 text-white rounded-lg px-3 py-2 mt-1 text-sm border border-gray-700 focus:outline-none focus:border-indigo-500 font-mono text-xs\" />\n            </div>\n            <div>\n              <label class=\"text-xs text-gray-400\">\u041E\u0440\u0438\u0435\u043D\u0442\u0430\u0446\u0438\u044F \u0434\u043E\u0441\u043A\u0438</label>\n              <select data-qorient=\"${i}\"\n                class=\"w-full bg-gray-800 text-white rounded-lg px-3 py-2 mt-1 text-sm border border-gray-700 focus:outline-none focus:border-indigo-500\">\n                <option value=\"\" ${!q.boardOrientation ? 'selected' : ''}>\u0410\u0432\u0442\u043E (\u0431\u0435\u043B\u044B\u0435 \u0441\u043D\u0438\u0437\u0443)</option>\n                <option value=\"white\" ${q.boardOrientation === 'white' ? 'selected' : ''}>\u0411\u0435\u043B\u044B\u0435 \u0441\u043D\u0438\u0437\u0443</option>\n                <option value=\"black\" ${q.boardOrientation === 'black' ? 'selected' : ''}>\u0427\u0451\u0440\u043D\u044B\u0435 \u0441\u043D\u0438\u0437\u0443</option>\n              </select>\n            </div>\n          </div>\n        ` : ''}\n      </div>\n    `;\n  }).join('');\n}\n\nfunction refreshQList(el: HTMLElement): void {\n  const list = el.querySelector('#pe-qlist');\n  if (list) list.innerHTML = renderQList(ps.pack.questions);\n  bindQEvents(el);\n}\n\nfunction bindQEvents(el: HTMLElement): void {\n  el.querySelectorAll<HTMLElement>('[data-qtoggle]').forEach(row => {\n    row.addEventListener('click', e => {\n      const t = e.target as HTMLElement;\n      if (t.hasAttribute('data-qdel') || t.hasAttribute('data-qup') || t.hasAttribute('data-qdn')) return;\n      const i = parseInt(row.dataset['qtoggle']!);\n      ps.expandedQ = ps.expandedQ === i ? -1 : i;\n      refreshQList(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-qdel]').forEach(btn => {\n    btn.addEventListener('click', e => {\n      e.stopPropagation();\n      const i = parseInt(btn.dataset['qdel']!);\n      ps.pack.questions.splice(i, 1);\n      if (ps.expandedQ === i) ps.expandedQ = -1;\n      else if (ps.expandedQ > i) ps.expandedQ--;\n      refreshQList(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-qup]').forEach(btn => {\n    btn.addEventListener('click', e => {\n      e.stopPropagation();\n      const i = parseInt(btn.dataset['qup']!);\n      if (i === 0) return;\n      [ps.pack.questions[i - 1], ps.pack.questions[i]] = [ps.pack.questions[i]!, ps.pack.questions[i - 1]!];\n      if      (ps.expandedQ === i)     ps.expandedQ = i - 1;\n      else if (ps.expandedQ === i - 1) ps.expandedQ = i;\n      refreshQList(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-qdn]').forEach(btn => {\n    btn.addEventListener('click', e => {\n      e.stopPropagation();\n      const i = parseInt(btn.dataset['qdn']!);\n      if (i >= ps.pack.questions.length - 1) return;\n      [ps.pack.questions[i + 1], ps.pack.questions[i]] = [ps.pack.questions[i]!, ps.pack.questions[i + 1]!];\n      if      (ps.expandedQ === i)     ps.expandedQ = i + 1;\n      else if (ps.expandedQ === i + 1) ps.expandedQ = i;\n      refreshQList(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLTextAreaElement>('[data-qtext]').forEach(ta => {\n    ta.addEventListener('input', () => {\n      ps.pack.questions[parseInt(ta.dataset['qtext']!)]!.text = ta.value;\n    });\n  });\n\n  el.querySelectorAll<HTMLInputElement>('[data-qans]').forEach(inp => {\n    inp.addEventListener('input', () => {\n      ps.pack.questions[parseInt(inp.dataset['qans']!)]!.answer = inp.value || undefined;\n    });\n  });\n\n  el.querySelectorAll<HTMLInputElement>('[data-qimg]').forEach(inp => {\n    inp.addEventListener('input', () => {\n      ps.pack.questions[parseInt(inp.dataset['qimg']!)]!.imageUrl = inp.value || undefined;\n    });\n  });\n\n  el.querySelectorAll<HTMLInputElement>('[data-qfen]').forEach(inp => {\n    inp.addEventListener('input', () => {\n      ps.pack.questions[parseInt(inp.dataset['qfen']!)]!.fen = inp.value || undefined;\n    });\n  });\n\n  el.querySelectorAll<HTMLSelectElement>('[data-qorient]').forEach(sel => {\n    sel.addEventListener('change', () => {\n      const v = sel.value as 'white' | 'black' | '';\n      ps.pack.questions[parseInt(sel.dataset['qorient']!)]!.boardOrientation = v || undefined;\n    });\n  });\n}\n\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n// CHARACTER EDITOR\n// \u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\ninterface CharState {\n  sets: CharacterSet[];\n  view: 'list' | 'edit';\n  editIdx: number;\n  set: CharacterSet;\n  expandedC: number;\n}\n\nlet cs: CharState = newCharState();\n\nfunction newCharState(): CharState {\n  return {\n    sets: [],\n    view: 'list',\n    editIdx: -1,\n    set: { title: '', characters: [] },\n    expandedC: -1,\n  };\n}\n\nexport function renderCharacterEditor(el: HTMLElement): void {\n  cs = newCharState();\n  cs.sets = loadCharacterSets();\n  drawChar(el);\n}\n\nfunction drawChar(el: HTMLElement): void {\n  if (cs.view === 'list') drawCharList(el);\n  else drawCharEdit(el);\n}\n\n// \u2500\u2500 Character Set List \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction drawCharList(el: HTMLElement): void {\n  el.innerHTML = `\n    <div class=\"min-h-screen flex flex-col bg-gray-950\">\n\n      <div class=\"flex items-center gap-3 px-5 py-4 bg-gray-900 border-b border-gray-800\">\n        <button id=\"ce-back\" class=\"text-gray-400 hover:text-white transition text-sm\">\u2190 \u041D\u0430\u0437\u0430\u0434</button>\n        <h1 class=\"text-xl font-bold flex-1\">\u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0435\u0439</h1>\n        <label class=\"cursor-pointer text-sm text-indigo-400 hover:text-indigo-300 transition\">\n          \u0418\u043C\u043F\u043E\u0440\u0442\n          <input id=\"ce-import\" type=\"file\" accept=\".json\" class=\"hidden\" />\n        </label>\n        <button id=\"ce-new\" class=\"py-2 px-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-xl text-sm font-semibold transition\">\n          + \u041D\u043E\u0432\u044B\u0439 \u043D\u0430\u0431\u043E\u0440\n        </button>\n      </div>\n\n      <div class=\"flex-1 p-4 max-w-2xl mx-auto w-full\">\n        ${cs.sets.length === 0\n          ? `<div class=\"text-gray-500 text-center mt-20 text-sm\">\u041D\u0435\u0442 \u043D\u0430\u0431\u043E\u0440\u043E\u0432. \u0421\u043E\u0437\u0434\u0430\u0439\u0442\u0435 \u043F\u0435\u0440\u0432\u044B\u0439!</div>`\n          : cs.sets.map((s, i) => `\n            <div class=\"bg-gray-900 border border-gray-800 rounded-xl px-4 py-3 flex items-center gap-3 mb-2\">\n              <div class=\"flex-1 min-w-0\">\n                <div class=\"font-semibold truncate\">${escapeHtml(s.title)}</div>\n                <div class=\"text-xs text-gray-400\">${s.characters.length} \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0435\u0439</div>\n              </div>\n              <button data-edit=\"${i}\" class=\"text-sm text-indigo-400 hover:text-indigo-300 transition\">\u0418\u0437\u043C\u0435\u043D\u0438\u0442\u044C</button>\n              <button data-copy=\"${i}\" class=\"text-sm text-green-400 hover:text-green-300 transition\">\u041A\u043E\u043F\u0438\u0440\u043E\u0432\u0430\u0442\u044C</button>\n              <button data-export=\"${i}\" class=\"text-sm text-gray-400 hover:text-gray-300 transition\">\u042D\u043A\u0441\u043F\u043E\u0440\u0442</button>\n              <button data-del=\"${i}\" class=\"text-sm text-red-400 hover:text-red-300 transition\">\u0423\u0434\u0430\u043B\u0438\u0442\u044C</button>\n            </div>\n          `).join('')}\n      </div>\n\n    </div>\n  `;\n\n  el.querySelector('#ce-back')?.addEventListener('click', () => _nav('home'));\n\n  el.querySelector('#ce-new')?.addEventListener('click', () => {\n    cs.editIdx = -1;\n    cs.set = { title: '', characters: [] };\n    cs.view = 'edit';\n    cs.expandedC = -1;\n    drawChar(el);\n  });\n\n  el.querySelector('#ce-import')?.addEventListener('change', e => {\n    const file = (e.target as HTMLInputElement).files?.[0];\n    if (!file) return;\n    const reader = new FileReader();\n    reader.onload = ev => {\n      try {\n        const data = JSON.parse(ev.target?.result as string);\n        if (\n          !data.title ||\n          !Array.isArray(data.characters) ||\n          !data.characters.every((c: unknown) => {\n            const cc = c as Record<string, unknown>;\n            return cc && typeof cc['name'] === 'string' && typeof cc['cost'] === 'number';\n          })\n        ) throw new Error();\n        cs.sets.push(data as CharacterSet);\n        saveCharacterSets(cs.sets);\n        drawCharList(el);\n      } catch {\n        showModal('\u041D\u0435\u0432\u0435\u0440\u043D\u044B\u0439 \u0444\u043E\u0440\u043C\u0430\u0442 \u0444\u0430\u0439\u043B\u0430');\n      }\n    };\n    reader.readAsText(file);\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-edit]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const i = parseInt(btn.dataset['edit']!);\n      cs.editIdx = i;\n      cs.set = structuredClone(cs.sets[i]);\n      cs.view = 'edit';\n      cs.expandedC = -1;\n      drawChar(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-export]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const i = parseInt(btn.dataset['export']!);\n      downloadJson(cs.sets[i]!, `${cs.sets[i]!.title || 'characters'}.json`);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-del]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const i = parseInt(btn.dataset['del']!);\n      showModal(`\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043D\u0430\u0431\u043E\u0440 \u00AB${escapeHtml(cs.sets[i]!.title)}\u00BB?`, () => {\n        cs.sets.splice(i, 1);\n        saveCharacterSets(cs.sets);\n        drawCharList(el);\n      });\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-copy]').forEach(btn => {\n    btn.addEventListener('click', () => {\n      const i = parseInt(btn.dataset['copy']!);\n      const copy: CharacterSet = structuredClone(cs.sets[i]);\n      copy.title += ' (\u043A\u043E\u043F\u0438\u044F)';\n      cs.sets.push(copy);\n      saveCharacterSets(cs.sets);\n      drawCharList(el);\n    });\n  });\n}\n\n// \u2500\u2500 Character Set Edit \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction drawCharEdit(el: HTMLElement): void {\n  const s = cs.set;\n  el.innerHTML = `\n    <div class=\"min-h-screen flex flex-col bg-gray-950\">\n\n      <div class=\"flex items-center gap-3 px-5 py-4 bg-gray-900 border-b border-gray-800\">\n        <button id=\"ce-edit-back\" class=\"text-gray-400 hover:text-white transition text-sm\">\u2190 \u041D\u0430\u0437\u0430\u0434</button>\n        <h1 class=\"text-xl font-bold flex-1\">${cs.editIdx === -1 ? '\u041D\u043E\u0432\u044B\u0439 \u043D\u0430\u0431\u043E\u0440' : '\u0420\u0435\u0434\u0430\u043A\u0442\u0438\u0440\u043E\u0432\u0430\u0442\u044C \u043D\u0430\u0431\u043E\u0440'}</h1>\n        <button id=\"ce-save\" class=\"py-2 px-4 bg-green-700 hover:bg-green-600 text-white rounded-xl text-sm font-semibold transition\">\n          \u0421\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C\n        </button>\n      </div>\n\n      <div class=\"flex-1 p-4 max-w-2xl mx-auto w-full space-y-4\">\n\n        <div class=\"bg-gray-900 border border-gray-800 rounded-xl p-4\">\n          <label class=\"text-xs text-gray-400 uppercase tracking-wider\">\u041D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043D\u0430\u0431\u043E\u0440\u0430</label>\n          <input id=\"ce-title\" type=\"text\" value=\"${escapeHtml(s.title)}\" placeholder=\"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435...\"\n            class=\"w-full bg-gray-800 text-white rounded-xl px-4 py-2 mt-1 border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n        </div>\n\n        <div class=\"text-xs text-gray-500 px-1\">\n          \uD83D\uDCA1 \u041F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0438 \u0441\u043E\u0440\u0442\u0438\u0440\u0443\u044E\u0442\u0441\u044F \u043F\u043E \u0441\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u0438 \u0430\u0432\u0442\u043E\u043C\u0430\u0442\u0438\u0447\u0435\u0441\u043A\u0438. \u0427\u0435\u043C \u0432\u044B\u0448\u0435 \u0441\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C, \u0442\u0435\u043C \u043F\u043E\u0437\u0436\u0435 \u043E\u0442\u043A\u0440\u044B\u0432\u0430\u0435\u0442\u0441\u044F \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436.\n        </div>\n\n        <div class=\"flex items-center justify-between\">\n          <div class=\"text-sm text-gray-400 uppercase tracking-wider font-semibold\">\u041F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0438 (${s.characters.length})</div>\n          <button id=\"ce-add-c\" class=\"py-1.5 px-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-sm font-semibold transition\">\n            + \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C\n          </button>\n        </div>\n\n        <div id=\"ce-clist\">${renderCList(s.characters)}</div>\n\n        ${cs.editIdx !== -1 ? `\n          <button id=\"ce-del-set\"\n            class=\"w-full py-3 rounded-xl font-semibold transition text-red-400 hover:text-red-300 border border-red-900 hover:bg-red-900/20\">\n            \u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043D\u0430\u0431\u043E\u0440\n          </button>\n        ` : ''}\n\n      </div>\n    </div>\n  `;\n\n  const titleEl = el.querySelector('#ce-title') as HTMLInputElement;\n  titleEl.addEventListener('input', () => { cs.set.title = titleEl.value; });\n\n  el.querySelector('#ce-edit-back')?.addEventListener('click', () => {\n    cs.view = 'list';\n    cs.sets = loadCharacterSets();\n    drawChar(el);\n  });\n\n  el.querySelector('#ce-save')?.addEventListener('click', () => {\n    if (!cs.set.title.trim()) { showModal('\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u043D\u0430\u0437\u0432\u0430\u043D\u0438\u0435 \u043D\u0430\u0431\u043E\u0440\u0430'); return; }\n    if (cs.editIdx === -1) cs.sets.push(cs.set);\n    else cs.sets[cs.editIdx] = cs.set;\n    saveCharacterSets(cs.sets);\n    cs.view = 'list';\n    drawChar(el);\n  });\n\n  el.querySelector('#ce-del-set')?.addEventListener('click', () => {\n    showModal(`\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u043D\u0430\u0431\u043E\u0440 \u00AB${escapeHtml(cs.set.title)}\u00BB?`, () => {\n      cs.sets.splice(cs.editIdx, 1);\n      saveCharacterSets(cs.sets);\n      cs.view = 'list';\n      drawChar(el);\n    });\n  });\n\n  el.querySelector('#ce-add-c')?.addEventListener('click', () => {\n    cs.set.characters.push({ name: '', cost: 3 });\n    cs.expandedC = cs.set.characters.length - 1;\n    refreshCList(el);\n    setTimeout(() => {\n      el.querySelector(`[data-crow=\"${cs.expandedC}\"]`)?.scrollIntoView({ behavior: 'smooth', block: 'center' });\n    }, 50);\n  });\n\n  bindCEvents(el);\n}\n\nfunction renderCList(chars: Character[]): string {\n  if (chars.length === 0)\n    return `<div class=\"text-gray-500 text-center py-8 text-sm\">\u041D\u0435\u0442 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0435\u0439. \u041D\u0430\u0436\u043C\u0438\u0442\u0435 \u00AB+ \u0414\u043E\u0431\u0430\u0432\u0438\u0442\u044C\u00BB.</div>`;\n\n  return chars.map((c, i) => {\n    const open    = cs.expandedC === i;\n    const safeImg = c.imageUrl ? sanitizeImageUrl(c.imageUrl) : '';\n    return `\n      <div data-crow=\"${i}\" class=\"bg-gray-900 border border-gray-800 rounded-xl mb-2 overflow-hidden\">\n        <div class=\"flex items-center gap-3 px-4 py-3 cursor-pointer select-none\" data-ctoggle=\"${i}\">\n          ${safeImg\n            ? `<img src=\"${safeImg}\" class=\"w-8 h-8 object-contain rounded flex-shrink-0\" />`\n            : `<div class=\"w-8 h-8 bg-gray-700 rounded flex-shrink-0 flex items-center justify-center text-sm\">\uD83D\uDC64</div>`}\n          <div class=\"flex-1 min-w-0\">\n            <div class=\"text-sm font-medium ${c.name ? 'text-white' : 'text-gray-500 italic'}\">\n              ${c.name ? escapeHtml(c.name) : '\u0411\u0435\u0437 \u0438\u043C\u0435\u043D\u0438'}\n            </div>\n            <div class=\"text-xs text-yellow-400\">\u2605 ${c.cost}</div>\n          </div>\n          <div class=\"flex gap-0.5 flex-shrink-0\">\n            <button data-cup=\"${i}\" class=\"text-gray-400 hover:text-white transition px-2 py-1 text-sm\" title=\"\u0412\u0432\u0435\u0440\u0445\">\u2191</button>\n            <button data-cdn=\"${i}\" class=\"text-gray-400 hover:text-white transition px-2 py-1 text-sm\" title=\"\u0412\u043D\u0438\u0437\">\u2193</button>\n            <button data-cdel=\"${i}\" class=\"text-red-400 hover:text-red-300 text-sm transition px-2 py-1\">\u2715</button>\n          </div>\n          <span class=\"text-gray-600 text-sm flex-shrink-0\">${open ? '\u25B2' : '\u25BC'}</span>\n        </div>\n        ${open ? `\n          <div class=\"px-4 pb-4 pt-3 space-y-2 border-t border-gray-800\">\n            <div>\n              <label class=\"text-xs text-gray-400\">\u0418\u043C\u044F \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0430</label>\n              <input data-cname=\"${i}\" type=\"text\" value=\"${escapeHtml(c.name)}\" placeholder=\"\u0418\u043C\u044F...\"\n                class=\"w-full bg-gray-800 text-white rounded-lg px-3 py-2 mt-1 text-sm border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n            </div>\n            <div>\n              <label class=\"text-xs text-gray-400\">\u0421\u0442\u043E\u0438\u043C\u043E\u0441\u0442\u044C (\u2605 \u0434\u043B\u044F \u043E\u0442\u043A\u0440\u044B\u0442\u0438\u044F)</label>\n              <input data-ccost=\"${i}\" type=\"number\" min=\"1\" value=\"${c.cost}\"\n                class=\"w-full bg-gray-800 text-white rounded-lg px-3 py-2 mt-1 text-sm border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n            </div>\n            <div>\n              <label class=\"text-xs text-gray-400\">\u0418\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435 (URL, \u043D\u0435\u043E\u0431\u044F\u0437\u0430\u0442\u0435\u043B\u044C\u043D\u043E)</label>\n              <input data-cimg=\"${i}\" type=\"text\" value=\"${escapeHtml(c.imageUrl ?? '')}\" placeholder=\"https://...\"\n                class=\"w-full bg-gray-800 text-white rounded-lg px-3 py-2 mt-1 text-sm border border-gray-700 focus:outline-none focus:border-indigo-500\" />\n            </div>\n            ${safeImg ? `\n              <div>\n                <div class=\"text-xs text-gray-400 mb-1\">\u041F\u0440\u0435\u0434\u043F\u0440\u043E\u0441\u043C\u043E\u0442\u0440</div>\n                <img src=\"${safeImg}\" class=\"h-16 object-contain rounded\" onerror=\"this.style.display='none'\" />\n              </div>\n            ` : ''}\n          </div>\n        ` : ''}\n      </div>\n    `;\n  }).join('');\n}\n\nfunction refreshCList(el: HTMLElement): void {\n  const list = el.querySelector('#ce-clist');\n  if (list) list.innerHTML = renderCList(cs.set.characters);\n  bindCEvents(el);\n}\n\nfunction bindCEvents(el: HTMLElement): void {\n  el.querySelectorAll<HTMLElement>('[data-ctoggle]').forEach(row => {\n    row.addEventListener('click', e => {\n      const t = e.target as HTMLElement;\n      if (t.hasAttribute('data-cup') || t.hasAttribute('data-cdn') || t.hasAttribute('data-cdel')) return;\n      const i = parseInt(row.dataset['ctoggle']!);\n      cs.expandedC = cs.expandedC === i ? -1 : i;\n      refreshCList(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-cdel]').forEach(btn => {\n    btn.addEventListener('click', e => {\n      e.stopPropagation();\n      const i = parseInt(btn.dataset['cdel']!);\n      cs.set.characters.splice(i, 1);\n      if (cs.expandedC === i) cs.expandedC = -1;\n      else if (cs.expandedC > i) cs.expandedC--;\n      refreshCList(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-cup]').forEach(btn => {\n    btn.addEventListener('click', e => {\n      e.stopPropagation();\n      const i = parseInt(btn.dataset['cup']!);\n      if (i === 0) return;\n      [cs.set.characters[i - 1], cs.set.characters[i]] = [cs.set.characters[i]!, cs.set.characters[i - 1]!];\n      if      (cs.expandedC === i)     cs.expandedC = i - 1;\n      else if (cs.expandedC === i - 1) cs.expandedC = i;\n      refreshCList(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLElement>('[data-cdn]').forEach(btn => {\n    btn.addEventListener('click', e => {\n      e.stopPropagation();\n      const i = parseInt(btn.dataset['cdn']!);\n      if (i >= cs.set.characters.length - 1) return;\n      [cs.set.characters[i + 1], cs.set.characters[i]] = [cs.set.characters[i]!, cs.set.characters[i + 1]!];\n      if      (cs.expandedC === i)     cs.expandedC = i + 1;\n      else if (cs.expandedC === i + 1) cs.expandedC = i;\n      refreshCList(el);\n    });\n  });\n\n  el.querySelectorAll<HTMLInputElement>('[data-cname]').forEach(inp => {\n    inp.addEventListener('input', () => {\n      cs.set.characters[parseInt(inp.dataset['cname']!)]!.name = inp.value;\n    });\n  });\n\n  el.querySelectorAll<HTMLInputElement>('[data-ccost]').forEach(inp => {\n    inp.addEventListener('input', () => {\n      cs.set.characters[parseInt(inp.dataset['ccost']!)]!.cost = Math.max(1, parseInt(inp.value) || 1);\n    });\n  });\n\n  el.querySelectorAll<HTMLInputElement>('[data-cimg]').forEach(inp => {\n    inp.addEventListener('input', () => {\n      cs.set.characters[parseInt(inp.dataset['cimg']!)]!.imageUrl = inp.value || undefined;\n      // Refresh to show/hide preview\n      refreshCList(el);\n    });\n  });\n}\n", "import type { Screen } from './types';\nimport {\n  setNav as gameSetNav,\n  renderSetup, resumeGame, hasActiveSave, preload,\n} from './game';\nimport {\n  setNav as editorSetNav,\n  renderPackEditor, renderCharacterEditor,\n} from './editor';\nimport { loadSaves, deleteSave } from './storage';\nimport { escapeHtml, formatTime, showModal } from './utils';\n\n// \u2500\u2500 Navigation \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nconst ALL_SCREENS: Screen[] = [\n  'home', 'setup', 'game', 'results', 'pack-editor', 'character-editor',\n];\n\nfunction getEl(screen: Screen): HTMLElement {\n  return document.getElementById(`screen-${screen}`)!;\n}\n\nfunction navigateTo(screen: Screen): void {\n  ALL_SCREENS.forEach(s => getEl(s).classList.add('hidden'));\n  getEl(screen).classList.remove('hidden');\n\n  if      (screen === 'home')             renderHome();\n  else if (screen === 'setup')            renderSetup(getEl('setup'));\n  else if (screen === 'pack-editor')      renderPackEditor(getEl('pack-editor'));\n  else if (screen === 'character-editor') renderCharacterEditor(getEl('character-editor'));\n}\n\n// \u2500\u2500 Home Screen \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction renderHome(): void {\n  const el      = getEl('home');\n  const hasSave = hasActiveSave();\n\n  el.innerHTML = `\n    <div class=\"min-h-screen flex flex-col items-center justify-center p-6 bg-gray-950\">\n\n      <div class=\"text-8xl mb-4 select-none\">\uD83C\uDFAF</div>\n      <h1 class=\"text-5xl font-black tracking-tight mb-2\">Level Up</h1>\n      <p class=\"text-gray-400 mb-12 text-center text-sm\">\n        \u041E\u0442\u0432\u0435\u0447\u0430\u0439 \u043D\u0430 \u0432\u043E\u043F\u0440\u043E\u0441\u044B \u2014 \u043E\u0442\u043A\u0440\u044B\u0432\u0430\u0439 \u043D\u043E\u0432\u044B\u0445 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0435\u0439!\n      </p>\n\n      <div class=\"w-full max-w-xs space-y-3\">\n\n        <button id=\"btn-new\"\n          class=\"w-full py-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-2xl font-bold text-xl transition shadow-lg shadow-indigo-900/30\">\n          \u041D\u043E\u0432\u0430\u044F \u0438\u0433\u0440\u0430\n        </button>\n\n        ${hasSave ? `\n          <button id=\"btn-continue\"\n            class=\"w-full py-4 bg-yellow-500 hover:bg-yellow-400 text-black rounded-2xl font-bold text-xl transition shadow-lg shadow-yellow-900/30\">\n            \u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C\n          </button>\n        ` : ''}\n\n        <button id=\"btn-pack-ed\"\n          class=\"w-full py-3 bg-gray-800 hover:bg-gray-700 text-white rounded-2xl font-semibold transition\">\n          \u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u0432\u043E\u043F\u0440\u043E\u0441\u043E\u0432\n        </button>\n\n        <button id=\"btn-char-ed\"\n          class=\"w-full py-3 bg-gray-800 hover:bg-gray-700 text-white rounded-2xl font-semibold transition\">\n          \u0420\u0435\u0434\u0430\u043A\u0442\u043E\u0440 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u0436\u0435\u0439\n        </button>\n\n      </div>\n    </div>\n  `;\n\n  el.querySelector('#btn-new')?.addEventListener('click', () => navigateTo('setup'));\n  el.querySelector('#btn-continue')?.addEventListener('click', () => showSavePicker());\n  el.querySelector('#btn-pack-ed')?.addEventListener('click', () => navigateTo('pack-editor'));\n  el.querySelector('#btn-char-ed')?.addEventListener('click', () => navigateTo('character-editor'));\n}\n\n// \u2500\u2500 Save Picker \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nfunction showSavePicker(): void {\n  document.getElementById('save-picker-overlay')?.remove();\n\n  const saves = loadSaves();\n  if (saves.length === 0) { renderHome(); return; }\n\n  const overlay = document.createElement('div');\n  overlay.id = 'save-picker-overlay';\n  overlay.className =\n    'fixed inset-0 bg-black/75 backdrop-blur-sm flex items-center justify-center z-50 p-4';\n\n  const renderList = () => {\n    const current = loadSaves();\n    return current.length === 0\n      ? `<div class=\"text-gray-500 text-center py-8 text-sm\">\u041D\u0435\u0442 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0439</div>`\n      : current.map(s => `\n          <div class=\"bg-gray-800 border border-gray-700 rounded-xl p-4 flex items-start gap-4\">\n            <div class=\"flex-1 min-w-0\">\n              <div class=\"font-semibold text-white truncate\">${escapeHtml(s.playerName || '\u0411\u0435\u0437 \u0438\u043C\u0435\u043D\u0438')}</div>\n              <div class=\"text-sm text-gray-400 mt-0.5\">${escapeHtml(s.packTitle)}</div>\n              <div class=\"text-xs text-gray-500 mt-0.5\">\n                ${s.charName ? escapeHtml(s.charName) + ' \u00B7 ' : ''}\u0412\u043E\u043F\u0440\u043E\u0441 ${escapeHtml(s.questionProgress)}\n              </div>\n              <div class=\"flex items-center gap-3 mt-1.5 text-xs text-gray-500\">\n                <span class=\"text-yellow-400\">\u2605 ${s.totalStars}</span>\n                <span>${formatTime(s.savedAt)}</span>\n              </div>\n            </div>\n            <div class=\"flex flex-col gap-2 flex-shrink-0\">\n              <button data-resume=\"${s.id}\"\n                class=\"py-1.5 px-4 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg text-sm font-semibold transition\">\n                \u25B6 \u0418\u0433\u0440\u0430\u0442\u044C\n              </button>\n              <button data-delete=\"${s.id}\"\n                class=\"py-1.5 px-4 bg-gray-700 hover:bg-red-800 text-gray-300 hover:text-white rounded-lg text-sm transition\">\n                \u0423\u0434\u0430\u043B\u0438\u0442\u044C\n              </button>\n            </div>\n          </div>\n        `).join('');\n  };\n\n  overlay.innerHTML = `\n    <div class=\"bg-gray-900 border border-gray-800 rounded-2xl w-full max-w-md shadow-2xl overflow-hidden\">\n      <div class=\"flex items-center justify-between px-5 py-4 border-b border-gray-800\">\n        <h2 class=\"text-lg font-bold\">\u041F\u0440\u043E\u0434\u043E\u043B\u0436\u0438\u0442\u044C \u0438\u0433\u0440\u0443</h2>\n        <button id=\"sp-close\"\n          class=\"text-gray-400 hover:text-white text-2xl w-8 h-8 flex items-center justify-center rounded-lg hover:bg-gray-800 transition\">\n          \u00D7\n        </button>\n      </div>\n      <div id=\"sp-list\" class=\"p-4 space-y-3 max-h-96 overflow-y-auto\">\n        ${renderList()}\n      </div>\n    </div>\n  `;\n\n  const bindEvents = () => {\n    overlay.querySelectorAll<HTMLElement>('[data-resume]').forEach(btn => {\n      btn.addEventListener('click', () => {\n        overlay.remove();\n        resumeGame(btn.dataset['resume']!);\n      });\n    });\n\n    overlay.querySelectorAll<HTMLElement>('[data-delete]').forEach(btn => {\n      btn.addEventListener('click', () => {\n        showModal('\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u044D\u0442\u043E \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D\u0438\u0435?', () => {\n          deleteSave(btn.dataset['delete']!);\n          const list = overlay.querySelector('#sp-list');\n          if (list) list.innerHTML = renderList();\n          bindEvents();\n          if (loadSaves().length === 0) { overlay.remove(); renderHome(); }\n        });\n      });\n    });\n  };\n\n  bindEvents();\n\n  overlay.querySelector('#sp-close')?.addEventListener('click', () => overlay.remove());\n  overlay.addEventListener('click', e => { if (e.target === overlay) overlay.remove(); });\n\n  document.body.appendChild(overlay);\n}\n\n// \u2500\u2500 Init \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\nasync function init(): Promise<void> {\n  gameSetNav(navigateTo);\n  editorSetNav(navigateTo);\n  await preload();\n  navigateTo('home');\n}\n\ndocument.addEventListener('DOMContentLoaded', () => { void init(); });\n"],
  "mappings": "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",
  "names": ["escapeHtml", "str", "sanitizeImageUrl", "url", "parsed", "showModal", "message", "onConfirm", "overlay", "box", "msg", "btns", "cancel", "confirm", "ok", "e", "formatTime", "timestamp", "mins", "hours", "downloadJson", "data", "filename", "blob", "a", "colors", "files", "ranks", "invRanks", "ranks", "allKeys", "files", "f", "r", "pos2key", "pos", "x", "pos2keyUnsafe", "key2pos", "k", "allPos", "allKeys", "key2pos", "allPosAndKey", "key", "i", "memo", "f", "v", "ret", "timer", "startAt", "time", "opposite", "c", "distanceSq", "pos1", "pos2", "samePiece", "p1", "p2", "samePos", "posToTranslate", "bounds", "pos", "asWhite", "translate", "el", "translateAndScale", "scale", "setVisible", "eventPosition", "isFireMac", "x", "isRightButton", "createEl", "tagName", "className", "computeSquareCenter", "diff", "a", "b", "knightDir", "x1", "y1", "x2", "y2", "rookDir", "bishopDir", "queenDir", "kingDirNonCastling", "pawnDirAdvance", "x1", "y1", "x2", "y2", "isDirectionUp", "step", "squaresBetween", "dx", "dy", "stepX", "stepY", "squares", "x", "y", "pos2key", "k", "pawn", "ctx", "diff", "pawnDirAdvance", "knight", "knightDir", "bishop", "bishopDir", "rook", "rookDir", "queen", "king", "kingDirNonCastling", "mobilityByRole", "premove", "state", "key", "pieces", "piece", "color", "friendlies", "_", "enemies", "opposite", "orig", "key2pos", "mobility", "partialCtx", "k", "allPosAndKey", "dest", "pk", "callUserFunction", "f", "args", "toggleOrientation", "state", "opposite", "setPieces", "state", "pieces", "key", "piece", "setCheck", "color", "k", "p", "setPremove", "orig", "dest", "meta", "unsetPredrop", "callUserFunction", "unsetPremove", "setPredrop", "role", "pd", "tryAutoCastle", "king", "origPos", "key2pos", "destPos", "pos2keyUnsafe", "rook", "baseMove", "origPiece", "destPiece", "captured", "unselect", "baseNewPiece", "force", "opposite", "baseUserMove", "result", "userMove", "canMove", "holdTime", "metadata", "canPremove", "dropNewPiece", "canDrop", "canPredrop", "selectSquare", "isMovable", "isPremovable", "setSelected", "premove", "isDraggable", "playPremove", "move", "success", "playPredrop", "validate", "drop", "cancelMove", "stop", "getKeyAtDomPos", "pos", "asWhite", "bounds", "file", "rank", "pos2key", "getSnappedKeyAtDomPos", "validSnapPos", "allPos", "pos2", "samePos", "queenDir", "knightDir", "validSnapDistances", "computeSquareCenter", "distanceSq", "closestSnapIndex", "a", "b", "index", "whitePov", "s", "initial", "roles", "letters", "read", "fen", "pieces", "row", "col", "c", "k", "pos2key", "piece", "nb", "role", "key", "write", "invRanks", "y", "files", "x", "p", "s", "applyAnimation", "state", "config", "deepMerge", "configure", "read", "setCheck", "setSelected", "rank", "kingStartPos", "dests", "king", "d", "base", "extend", "key", "isPlainObject", "o", "proto", "anim", "mutation", "state", "animate", "render", "result", "makePiece", "key", "piece", "key2pos", "closer", "pieces", "p1", "p2", "distanceSq", "computePlan", "prevPieces", "current", "anims", "animedOrigs", "fadings", "missings", "news", "prePieces", "curP", "preP", "vector", "k", "p", "allKeys", "samePiece", "newP", "step", "now", "cur", "rest", "ease", "easing", "cfg", "plan", "alreadyRunning", "t", "brushes", "start", "state", "e", "unselect", "cancelMove", "pos", "eventPosition", "orig", "getKeyAtDomPos", "whitePov", "eventBrush", "processDraw", "cur", "keyAtDomPos", "mouseSq", "getSnappedKeyAtDomPos", "move", "end", "addShape", "cancel", "clear", "onChange", "sameEndpoints", "s1", "s2", "sameColor", "modA", "isRightButton", "modB", "drawable", "similar", "s", "start", "s", "e", "bounds", "position", "eventPosition", "orig", "getKeyAtDomPos", "whitePov", "piece", "previouslySelected", "clear", "pieceCloseTo", "hadPremove", "hadPredrop", "canMove", "anim", "state", "selectSquare", "stillSelected", "element", "pieceElementByKey", "isDraggable", "ghost", "translate", "posToTranslate", "key2pos", "setVisible", "processDrag", "unsetPremove", "unsetPredrop", "pos", "asWhite", "radiusSq", "key", "center", "computeSquareCenter", "distanceSq", "dragNewPiece", "force", "cur", "origPiece", "samePiece", "cancel", "found", "move", "end", "eventPos", "dest", "dropNewPiece", "userMove", "callUserFunction", "unselect", "removeDragElements", "el", "explosion", "state", "keys", "setStage", "stage", "start", "state", "redrawAll", "toggleOrientation", "config", "applyAnimation", "anim", "render", "configure", "write", "pieces", "setPieces", "key", "force", "selectSquare", "unselect", "orig", "dest", "baseMove", "piece", "baseNewPiece", "playPremove", "validate", "result", "playPredrop", "unsetPremove", "unsetPredrop", "cancelMove", "cancel", "stop", "keys", "explosion", "shapes", "pos", "getKeyAtDomPos", "whitePov", "event", "dragNewPiece", "defaults", "read", "initial", "_", "timer", "createDefs", "defs", "createElement", "filter", "setAttributes", "renderSvg", "state", "els", "d", "curD", "cur", "dests", "bounds", "nonPieceAutoShapes", "autoShape", "s", "sources", "from", "pos2user", "orient", "key2pos", "to", "angleToSlot", "moveAngle", "shapes", "pendingEraseIdx", "sameEndpoints", "sameColor", "idx", "isPendingErase", "shapeHash", "isShort", "angleCount", "fullHash", "sc", "syncDefs", "syncShapes", "renderShape", "shapesEl", "defsEl", "thisPlane", "brushes", "brush", "makeCustomBrush", "key", "color", "hiliteOf", "keysInDom", "el", "renderMarker", "customEl", "shapesG", "customG", "hashesInDom", "root", "toRemove", "elHash", "svg", "orig", "dest", "piece", "modifiers", "customSvg", "label", "below", "shorten", "current", "pendingErase", "angleCountOfDest", "pieceHash", "modifiersHash", "textHash", "x", "m", "h", "i", "shape", "hash", "slots", "svgs", "renderArrow", "renderCircle", "corner", "renderLabel", "on", "y", "labelCoords", "c", "at", "widths", "circleWidth", "radius", "opacity", "renderLine", "isHilite", "arrowMargin", "dx", "dy", "angle", "xo", "yo", "hilite", "lineWidth", "g", "blurred", "filterBox", "marker", "fontSize", "cornerOff", "labelEl", "pos", "mod", "n", "rotateAngleSlot", "slot", "steps", "anyTwoCloserThan90Degrees", "tagName", "attrs", "base", "xScale", "yScale", "box", "dist", "acc", "mag", "renderWrap", "element", "s", "c", "colors", "container", "createEl", "board", "shapesBelow", "shapes", "customBelow", "custom", "autoPieces", "cls", "svgContainer", "orientClass", "ranksPositionClass", "rankN", "i", "files", "f", "renderCoords", "ranks", "r", "opposite", "ghost", "setVisible", "isShapes", "svg", "setAttributes", "createElement", "createDefs", "elems", "className", "firstColor", "el", "elem", "light", "drop", "s", "e", "unsetPremove", "unsetPredrop", "piece", "position", "eventPosition", "dest", "getKeyAtDomPos", "whitePov", "dropNewPiece", "bindBoard", "s", "onResize", "boardEl", "e", "onStart", "startDragOrDraw", "bindDocument", "unbinds", "unbindable", "onmove", "dragOrDraw", "move", "onend", "end", "ev", "onScroll", "f", "el", "eventName", "callback", "options", "cancel", "isRightButton", "start", "drop", "withDrag", "withDraw", "render", "s", "asWhite", "whitePov", "posToTranslate", "boardEl", "pieces", "curAnim", "anims", "fadings", "curDrag", "samePieces", "movedPieces", "desiredSquares", "computeSquareClasses", "availableSquares", "k", "el", "pieceAtKey", "elPieceName", "anim", "fading", "pMvdset", "pMvd", "sAvail", "isPieceNode", "translate", "key2pos", "pieceNameOf", "pos", "posZIndex", "appendValue", "isSquareNode", "cls", "setVisible", "sk", "className", "translation", "squareNode", "createEl", "_", "nodes", "node", "p", "pieceName", "pieceNode", "removeNodes", "renderResized", "updateBounds", "bounds", "container", "ratio", "width", "height", "rank", "piece", "normalizeLastMoveStandardRookCastle", "squaresBetween", "sq", "squares", "i", "addSquare", "premove", "o", "v", "key", "klass", "classes", "map", "value", "arr", "syncShapes", "shapes", "root", "renderShape", "hashesInDom", "toRemove", "sc", "el", "elHash", "render", "state", "autoPieceEl", "autoPieceShapes", "autoShape", "s", "hash", "syncShapes", "shape", "renderShape", "renderResized", "asWhite", "whitePov", "posToTranslate", "el", "translateAndScale", "key2pos", "bounds", "orig", "role", "color", "scale", "pieceEl", "createEl", "autoPiece", "Chessground", "element", "config", "maybeState", "defaults", "configure", "redrawAll", "prevUnbind", "elements", "renderWrap", "bounds", "memo", "redrawNow", "skipSvg", "render", "state", "renderSvg", "onResize", "updateBounds", "renderResized", "debounceRedraw", "bindBoard", "bindDocument", "start", "redrawing", "mountBoard", "el", "fen", "orientation", "Chessground", "rootNode", "comment", "node", "move", "suffix", "nag", "variations", "lineToTree", "nodes", "root", "rest", "parent", "child", "pgn", "headers", "game", "next", "peg$subclass", "C", "peg$SyntaxError", "message", "expected", "found", "location", "self", "peg$padEnd", "str", "targetLength", "padString", "sources", "src", "k", "s", "offset_s", "loc", "e", "filler", "line", "last", "hatLen", "DESCRIBE_EXPECTATION_FNS", "expectation", "literalEscape", "escapedParts", "part", "classEscape", "hex", "ch", "describeExpectation", "describeExpected", "descriptions", "i", "j", "describeFound", "peg$parse", "input", "options", "peg$FAILED", "peg$source", "peg$startRuleFunctions", "peg$parsepgn", "peg$startRuleFunction", "peg$c0", "peg$c1", "peg$c2", "peg$c3", "peg$c4", "peg$c5", "peg$c6", "peg$c7", "peg$c8", "peg$c9", "peg$c10", "peg$c11", "peg$c12", "peg$c13", "peg$c14", "peg$c15", "peg$c16", "peg$c17", "peg$r0", "peg$r1", "peg$r2", "peg$r3", "peg$r4", "peg$r5", "peg$r6", "peg$r7", "peg$r8", "peg$r9", "peg$e0", "peg$otherExpectation", "peg$e1", "peg$literalExpectation", "peg$e2", "peg$e3", "peg$e4", "peg$e5", "peg$classExpectation", "peg$e6", "peg$e7", "peg$e8", "peg$e9", "peg$e10", "peg$e11", "peg$e12", "peg$e13", "peg$e14", "peg$e15", "peg$e16", "peg$e17", "peg$e18", "peg$e19", "peg$e20", "peg$e21", "peg$e22", "peg$e23", "peg$e24", "peg$e25", "peg$e26", "peg$e27", "peg$e28", "peg$e29", "peg$e30", "peg$e31", "peg$e32", "peg$e33", "peg$e34", "peg$e35", "peg$e36", "peg$e37", "peg$e38", "peg$e39", "peg$f0", "peg$f1", "tagPairs", "peg$f2", "tagName", "tagValue", "peg$f3", "marker", "peg$f4", "moves", "peg$f5", "san", "peg$f6", "peg$f7", "peg$f8", "peg$f9", "peg$f10", "result", "peg$currPos", "peg$posDetailsCache", "peg$maxFailPos", "peg$maxFailExpected", "peg$silentFails", "peg$result", "text", "ignoreCase", "parts", "inverted", "peg$endExpectation", "description", "peg$computePosDetails", "pos", "details", "p", "peg$computeLocation", "startPos", "endPos", "offset", "startPosDetails", "endPosDetails", "res", "peg$fail", "peg$buildStructuredError", "s0", "s1", "s2", "peg$parsetagPairSection", "peg$parsemoveTextSection", "peg$parsetagPair", "peg$parse_", "s4", "s6", "s7", "s8", "s10", "peg$parsetagName", "peg$parsetagValue", "s3", "peg$parseline", "peg$parsegameTerminationMarker", "peg$parsecomment", "peg$parsemove", "s5", "s9", "peg$parsemoveNumber", "peg$parsesan", "peg$parsesuffixAnnotation", "peg$parsenag", "peg$parsevariation", "peg$parsebraceComment", "peg$parserestOfLineComment", "MASK64", "rotl", "x", "wrappingMul", "y", "xoroshiro128", "state", "rand", "PIECE_KEYS", "EP_KEYS", "CASTLING_KEYS", "SIDE_KEY", "WHITE", "BLACK", "PAWN", "KNIGHT", "BISHOP", "ROOK", "QUEEN", "KING", "DEFAULT_POSITION", "Move", "chess", "internal", "color", "piece", "from", "to", "flags", "captured", "promotion", "fromAlgebraic", "algebraic", "toAlgebraic", "flag", "BITS", "FLAGS", "EMPTY", "BITS", "SEVEN_TAG_ROSTER", "SUPLEMENTAL_TAGS", "HEADER_TEMPLATE", "Ox88", "PAWN_OFFSETS", "PIECE_OFFSETS", "ATTACKS", "RAYS", "PIECE_MASKS", "SYMBOLS", "PROMOTIONS", "KNIGHT", "BISHOP", "ROOK", "QUEEN", "RANK_1", "RANK_2", "RANK_7", "RANK_8", "SIDES", "KING", "ROOKS", "SECOND_RANK", "SAN_NULLMOVE", "rank", "square", "file", "isDigit", "c", "algebraic", "f", "swapColor", "color", "WHITE", "BLACK", "validateFen", "fen", "tokens", "moveNumber", "halfMoves", "rows", "i", "sumFields", "previousWasNumber", "k", "kings", "regex", "char", "getDisambiguator", "move", "moves", "from", "to", "piece", "ambiguities", "sameRank", "sameFile", "len", "ambigFrom", "ambigTo", "ambigPiece", "addMove", "captured", "flags", "r", "PAWN", "promotion", "inferPieceType", "san", "pieceType", "strippedSan", "Chess", "EMPTY", "DEFAULT_POSITION", "skipValidation", "preserveHeaders", "adjustments", "ok", "error", "position", "forceEnpassantSquare", "empty", "castling", "epSquare", "bigPawnSquare", "squares", "isLegal", "type", "colorIndex", "typeIndex", "PIECE_KEYS", "EP_KEYS", "index", "CASTLING_KEYS", "hash", "SIDE_KEY", "sq", "currentPieceOnSquare", "whiteKingInPlace", "blackKingInPlace", "startSquare", "currentSquare", "attackers", "canCapture", "verbose", "difference", "offset", "j", "blocked", "attackedBy", "pieces", "bishops", "numPieces", "squareColor", "sum", "Move", "legal", "forSquare", "forPiece", "us", "them", "firstSquare", "lastSquare", "singleSquare", "castlingFrom", "castlingTo", "legalMoves", "strict", "moveObj", "prettyMove", "old", "newline", "maxWidth", "result", "headerExists", "appendComment", "moveString", "comment", "delimiter", "reversedHistory", "prefix", "strip", "wrapComment", "width", "token", "currentWidth", "args", "key", "value", "nonNullHeaders", "pgn", "newlineChar", "parsedPgn", "parse", "headers", "node", "output", "disambiguator", "cleanMove", "matches", "overlyDisambiguated", "s", "symbol", "depth", "nodes", "row", "moveHistory", "currentCount", "currentComments", "copyComment", "rights", "side", "PACKS_KEY", "CHAR_SETS_KEY", "SAVES_KEY", "loadPacks", "data", "p", "savePacks", "packs", "loadCharacterSets", "s", "saveCharacterSets", "sets", "loadSaves", "upsertSave", "state", "saves", "idx", "charName", "slot", "deleteSave", "id", "filtered", "loadBuiltinPacks", "files", "f", "r", "loadBuiltinCharacterSets", "game", "_nav", "boardApi", "boardMoveIdx", "navChess", "navKeyHandler", "builtinPacks", "builtinSets", "setNav", "fn", "preload", "loadBuiltinPacks", "loadBuiltinCharacterSets", "hasActiveSave", "loadSaves", "allPacks", "loadPacks", "allSets", "loadCharacterSets", "renderSetup", "el", "packs", "sets", "canStart", "p", "escapeHtml", "s", "selPack", "selChars", "updateCompat", "warning", "maxStars", "sorted", "a", "b", "maxNeeded", "unlockable", "c", "btnStart", "ruWord", "playerName", "packIdx", "setIdx", "startGame", "n", "one", "few", "many", "m", "shuffle", "arr", "i", "j", "pack", "characterSet", "sortedChars", "allShuffled", "maxCost", "minNeeded", "hasExtra", "questions", "spares", "upsertSave", "renderGameScreen", "resumeGame", "id", "slot", "chars", "cur", "next", "q", "img", "url", "cls", "safe", "sanitizeImageUrl", "renderCharImg", "grayscale", "renderCharMeta", "muted", "charBoxCls", "bottomControls", "h", "container", "mountBoard", "Chess", "totalPositions", "navLocked", "updateNavDisplay", "pos", "setNavLock", "locked", "applyBoardMove", "targetIdx", "uci", "lastUci", "lm", "inCheck", "e", "ab", "handleAnswer", "showAllCharactersOverlay", "showModal", "overlay", "imgTag", "unlocked", "closeOverlay", "correct", "justUnlocked", "onContinue", "deleteSave", "renderResults", "advanceQuestion", "showUnlockOverlay", "char", "safeUrl", "spare", "finalChar", "_nav", "setNav", "fn", "ps", "newPackState", "renderPackEditor", "el", "loadPacks", "drawPack", "drawPackList", "drawPackEdit", "p", "i", "escapeHtml", "e", "file", "reader", "ev", "data", "q", "qq", "savePacks", "showModal", "btn", "downloadJson", "copy", "renderQList", "titleEl", "starsEl", "refreshQList", "bindQEvents", "questions", "open", "list", "row", "t", "ta", "inp", "sel", "v", "cs", "newCharState", "renderCharacterEditor", "loadCharacterSets", "drawChar", "drawCharList", "drawCharEdit", "s", "c", "cc", "saveCharacterSets", "renderCList", "refreshCList", "bindCEvents", "chars", "safeImg", "sanitizeImageUrl", "ALL_SCREENS", "getEl", "screen", "navigateTo", "s", "renderHome", "renderSetup", "renderPackEditor", "renderCharacterEditor", "el", "hasSave", "hasActiveSave", "showSavePicker", "loadSaves", "overlay", "renderList", "current", "escapeHtml", "formatTime", "bindEvents", "btn", "resumeGame", "showModal", "deleteSave", "list", "e", "init", "setNav", "preload"]
}
